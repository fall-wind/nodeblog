
var Mohawk={version:'0.1',UI:{selection:false,selectables:[]},Utils:{},DOM:{},url:URL.js,XHR:function(){var XHR=null;if(window.XMLHttpRequest){XHR=new XMLHttpRequest();}else if(window.ActiveXObject){XHR=new ActiveXObject('Microsoft.XMLHTTP');}else{alert('XMLHttpRequest is disabled in your browser');return false;}
return XHR;}};var IE=typeof(window.ActiveXObject)!='undefined';var FF=navigator.userAgent.match('Gecko')!=null;var OPERA=typeof(window.opera)!='undefined';var WEBKIT=navigator.userAgent.match('WebKit')!=null;if(WEBKIT){FF=false;}
var BTN_LEFT=IE?1:0;var BTN_MIDDLE=IE?4:1;var BTN_RIGHT=2;function extend(target,source,directly){if(target.prototype&&!directly){extend(target.prototype,source);}else{for(var i in source){target[i]=source[i];}}};Function.prototype.parse=function(){var source=this.toSource instanceof Function?this.toSource():this.toString();var regex=new RegExp('\\(?\\s*function\\s*([a-z$_][a-z$_0-9]*)?\\s*\\(\\s*([^\\)]*)\\s*\\)\\s*\\{([^\x01]*)\\}\\s*\\)?\\s*','img');var m=null;if(m=regex.exec(source)){return{name:m[1],params:m[2].split(new RegExp('\\s*,\\s*')),body:m[3]};}else{return null;}};function foreach(iterable,action){if(!action||!action.call){return;}
if(iterable instanceof Array||(typeof(iterable.length)=='number'&&(IE||typeof(iterable.item)=='function'))){for(var i=0;i<iterable.length;i++){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}else if(iterable instanceof Object){for(var i in iterable){if(typeof(Object.prototype[i])=='undefined'){var value=action.call(iterable[i],i,iterable[i]);if(value===false){break;}}}}}
var ObjectInterface={combine:function(keys,values){var obj={};for(var i=0;i<keys.length;i++){obj[keys[i]]=values[i];}
return obj;},find:function(object,value){for(var i in object){if(value==object[i]){return i;}}
return false;},keys:function(object){var keys=[];for(var i in object){if(typeof(Object.prototype[i])=='undefined'){keys.push(i);}}
return keys;},values:function(object){var values=[];foreach(object,function(){values.push(this);});return values;},clone:function(object){var clone={};foreach(object,function(key){clone[key]=object[key];});return clone;}};var ArrayInterface={remove:function(array,value){var index=Array.find(array,value);if(index!==false){array.splice(index,1);}},find:function(array,value){for(var i=0;i<array.length;i++){if(value==array[i]){return i;}}
return false;},intersect:function(array1,array2,sorted){if(!sorted){array1.sort();array2.sort();}
var i=0,j=0;var unique=[];while(i<array1.length&&j<array2.length){if(array1[i]<array2[j]){i++;}else if(array1[i]>array2[j]){j++;}else{unique.push(array1[i]);i++;j++;}}
return unique;}};extend(Object,ObjectInterface,true);extend(Array,ArrayInterface,true);Math._round=Math.round;var MathInterface={sign:function(x){return x==0?0:(x>0?1:-1);},rand:function(min,max){if(!max){min=0;max=min;}
return Math.round(Math.random()*(max-min))+min;},round:function(num,precision){if(!precision||precision<0){return Math._round(num);}else{var base=Math.pow(10,precision);return Math._round(num*base)/base;}}};extend(Math,MathInterface);var NumberInterface={toHex:function(){if(this==0){return'0';}
var hex='';var digits=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'];var d=this;var pow=Math.floor(Math.log(d)/Math.log(16));var base=Math.pow(16,pow);for(var i=pow;i>=0;i--){var q=Math.floor(d/base);d-=q*base;hex+=digits[q];base/=16;}
return hex;}};extend(Number,NumberInterface);RegExp.quote=function(str){var regexp=new RegExp('([\\<\\>\\/\\?\\.\\$\\^\\[\\]\\*\\+\\\\])','g');return str.replace(regexp,'\\$1');};var Class=function(object){return this.extend(object);};var Singletone=function(object){var class_interface=new Class(object);var instance=new class_interface();return instance;};Class.prototype={self:null,parent:null,extend:function(descendant){var child=Class.method(descendant.__construct||(this.prototype&&this.prototype.__construct?this.prototype.__construct:function(){}),'Class.setSelf(this); var self = this.self; var parent = this.parent; this.static = arguments.callee; var static = this.static; ');var methods=Object.keys(descendant);child.prototype.parent={};for(var i in this.prototype){if(this.prototype[i]instanceof Function){child.prototype.parent[i]=Class.method(this.prototype[i]);}else{child.prototype.parent[i]=this.prototype[i];}
if(i!='parent'){if(this.prototype[i]instanceof Function){child.prototype[i]=Class.method(this.prototype[i],Array.find(methods,i)===false?'if (parent && parent.parent) {parent = parent.parent};'+Class.label:'');}else{child.prototype[i]=this.prototype[i];}}}
if(typeof(child.base)=='undefined'){child.base={};}
for(var i in this){if(typeof(child[i])=='undefined'){child[i]=this[i];}}
for(var i in descendant){if(descendant[i]instanceof Function){child.prototype[i]=Class.method(descendant[i],'var __function__ = "'+i+'"; var self = this.self; var parent = this.parent; var static = this.static; '+Class.label+'if (self) {try {parent.self = self} catch (e) {}}');}else{child.prototype[i]=descendant[i];}}
child.extend=this.extend;return child;}};Class.extend=Class.prototype.extend;Class.label='Class.here();';Class.here=function(){};Class.method=function(action,add){var source=action.parse();var f=function(){};if(source){if(source.body.indexOf(Class.label)>0){source.body=source.body.replace(Class.label,add||'');}else{source.body=(add||'')+source.body;}
var str='f = function ('+source.params.join(',')+') {'+source.body+'};';eval(str);}else{f=false;}
return f;};Class.setSelf=function(object){var base=object;do{object.self=base;object=object.parent;}while(object&&object.parent);};document.loaders=[];document.callLoaders=function(){if(document.loaded){while(document.loaders.length){var loader=document.loaders.shift();if(loader instanceof Function){loader.call(document);}}}};if(FF){document.addEventListener('DOMContentLoaded',function(){document.loaded=true;document.callLoaders.call(document);},false);}else if(WEBKIT){function callLoaders(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders.call(document);}else{setTimeout(callLoaders,0);}}
setTimeout(callLoaders,0);}else{document.onreadystatechange=function(){if(Array.find(['loaded','complete'],document.readyState)!==false){document.loaded=true;document.callLoaders();}};}
document.addLoader=function(action){if(document.loaded){action.call(document);}else{if(Array.find(document.loaders,action)===false){document.loaders.push(action);}}};Mohawk.included=[];function include(path){var first=path.substr(0,path.indexOf('.'));var url=Mohawk.url;if(typeof(URL[first])!='undefined'){url=URL[first];path=path.substr(path.indexOf('.')+1);}
var include_path=url+path.replace(new RegExp('\\.','g'),'/')+'.js';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.setRequestHeader('Pragma','no-cache');XHR.setRequestHeader('Expires','-1');XHR.send(null);eval(XHR.responseText);Mohawk.included.push(include_path);delete(XHR);}}
window.Pixel=new Class({x:0,y:0,__construct:function(x,y){if(typeof x!='undefined'){if(typeof y!='undefined'){self.x=x||0;self.y=y||0;}else{self.x=x.x;self.y=x.y;}}},inside:function(rect){return self.x>=rect.start.x&&self.x<=rect.end.x&&self.y>=rect.start.y&&self.y<=rect.end.y;},toString:function(){return[self.x,self.y].toString();}});window.Rect=new Class({start:null,end:null,__construct:function(start,end){if(start&&end){self.start=start;self.end=end;}else{self.start=new Pixel;self.end=new Pixel;}},toString:function(){return[self.start.toString(),self.end.toString()].toString();}});Rect.fromNode=function(node){var start=node.coordinates();return new Rect(start,new Pixel(start.x+node.offsetWidth,start.y+node.offsetHeight));}
Mohawk.Template=new Singletone({vars:{},keywords:['end','else'],assign:function(name,value){if(Array.find(self.keywords,name)!==false){alert(name+' is a keyword');}
self.vars[name]=value;},transform:function(text){var init='';foreach(self.vars,function(name){init+='var '+name+' = self.vars["'+name+'"];';});var variable='[a-z_][a-z_0-9]*(?:\\[[^\\]]*\\]|\\.[a-z_][a-z_0-9]*)*';var modifier='[a-z_][a-z_0-9]*(?:\\.[a-z_][a-z_0-9]*)*';var condition='[^\\}]+';text=text.replace(new RegExp('\"','g'),'\\\"');text=text.replace(new RegExp('\\n','g'),'\\n');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\}','gmi'),'"; for (var __k__ in $2) {'+'if (typeof Object.prototype[__k__] != \'undefined\' || typeof Array.prototype[__k__] != \'undefined\') continue; var $1 = $2[__k__]; __s__ += "');text=text.replace(new RegExp('\\{%for\\s+('+variable+') in ('+variable+')\\s+=>\\s+('+variable+')\\}','gmi'),'"; for (var $3 in $2) {'+'if (typeof Object.prototype[$3] != \'undefined\' || typeof Array.prototype[$3] != \'undefined\') continue; var $1 = $2[$3]; __s__ += "');text=text.replace(new RegExp('\\{%if\\s+('+condition+')\\}','gmi'),'"; if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%elseif\\s+('+condition+')\\}','gmi'),'"; } else if ($1) {__s__ += "');text=text.replace(new RegExp('\\{%else\\}','gmi'),'"; } else { __s__ += "');text=text.replace(new RegExp('\\{%end\\}','gmi'),'"; } __s__ += "');text=text.replace(new RegExp('\\{%('+variable+')\\|('+modifier+')\\}','gmi'),'" + $2($1) + "');text=text.replace(new RegExp('\\{%('+variable+')\\}','gmi'),'" + $1 + "');eval(init+'__s__ = "'+text+'"');return __s__;}});Mohawk.NodeEffectInterface={show:function(effect){if(this.style.visibility=='hidden'){this.style.visibility='visible';if(effect instanceof Function){effect.call(this,this,this.show);}}},hide:function(effect){if(this.style.visibility!='hidden'){if(effect instanceof Function){effect.call(this,this,this.hide);}else{this.style.visibility='hidden';}}},display:function(effect,display){this.style.display=display?display:(this._display?this._display:'block');if(effect instanceof Function){effect.call(this,this,this.display);}},collapse:function(effect){if(this.style.display!='none'){if(effect instanceof Function){effect.call(this,this,this.collapse);}else{this._display=this.style.display;this.style.display='none';}}},toggleDisplay:function(effect){if(e.offsetWidth==0){this.display(effect);}else{this.collapse(effect);}},remove:function(effect){if(this.parentNode){if(effect instanceof Function){effect(this,this.remove);}else{this.parentNode.removeChild(this);}}},setOpacity:function(opacity){if(IE){if(this.tagName&&this.tagName.toUpperCase()=='IMG'&&this.src.match(/\.png$/)){this.style.filter='AlphaImageLoader(src="'+this.src+'", sizingMethod="scale") Alpha(Opacity="'+(opacity*100)+'")';}else{this.style.filter='Alpha(Opacity="'+(opacity*100)+'")';}}else{this.style.opacity=opacity;}},getOpacity:function(opacity){if(IE){}else{return this.style.opacity;}}};Mohawk.Effects=new Singletone({opacity_delay:10,opacity_step:0.025,blink_delay:100,blink_number:3,_stop:false,moving:null,opacity:function(object,start,end,finalize,current){self=Mohawk.Effects;if(typeof current=='undefined'){current=start;object._opacity=object.getOpacity();if(IE){object._filter=object.style.filter;}}
current+=self.opacity_step*Math.sign(end-start);object.setOpacity(current);if(Math.sign(end-start)!=0&&(Math.sign(end-start)==Math.sign(end-current)||!Math.sign(end-current))){setTimeout(function(){self.opacity(object,start,end,finalize,current);},self.opacity_delay);}else{object.setOpacity(end);if(finalize instanceof Function){finalize.call(object);}
object.setOpacity(object._opacity);if(IE){object.style.filter=object._filter;}}},appear:function(object,finalize){Mohawk.Effects.opacity(object,0,1,finalize);},vanish:function(object,finalize){Mohawk.Effects.opacity(object,1,0,finalize);},fold:function(object,finalize){var height=object.offsetHeight;var step=Math.floor(height/48);var _fold=function(){if(height<step||step<=0){object.style.height='0px';if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height-=step;object.style.height=height+'px';setTimeout(_fold,1);}};object.style.overflow='hidden';_fold();},unfold:function(object,finalize){var height=0;var end=object.offsetHeight;var step=Math.floor(end/48);var _unfold=function(){if(end-height<step||step<=0){if(finalize instanceof Function){finalize.call();}
object.style.overflow='auto';object.style.height='auto';}else{height+=step;object.style.height=height+'px';setTimeout(_unfold,1);}};object.style.overflow='hidden';object.style.height='0px';_unfold();},strike:function(node,finalize){var html=node.innerHTML;var text=node.textContent||node.innerText;var del=DOM.element('DEL');var span=DOM.element('SPAN');var len=Math.ceil(text.length/5);var _strike=function(){if(text.length<=len){if(finalize instanceof Function){finalize.call();}
node.setHTML(html);}else{var str=text.substr(0,len);text=text.substr(len);del.innerHTML+=str;span.innerHTML=text;setTimeout(_strike,100);}};node.removeChildren();node.appendChild(del);node.appendChild(span);_strike();},blink:function(object,finalize,start,counter){self=Mohawk.Effects;if(typeof counter=='undefined'){counter=0;start=Array.find(['hidden','off'],object.style.visibility)!==false;}
counter++;if(counter<self.blink_number*2){object.style.visibility=(counter+start)%2?'hidden':'visible';setTimeout(function(){self.blink(object,finalize,start,counter)},self.blink_delay);}else{object.style.visibility=start?'visible':'hidden';if(finalize instanceof Function){finalize.call(object);}}},move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;if(!offset){var temp=document.createElement('DIV');temp.style.left='0px';temp.style.top='0px';temp.style.position='absolute';e.parentNode.appendChild(temp);offset=new Pixel(temp.offsetLeft,temp.offsetTop);temp.remove();}
if(!x&&x!==0){x=cur_x;}
if(!y&&y!==0){y=cur_y;}
if(!step_x){step_x=1;}
if(!step_y){step_y=1;}
if(!acc_x){acc_x=1;}
if(!acc_y){acc_y=1;}
self._move(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset);},_move:function(e,x,y,step_x,step_y,acc_x,acc_y,finalize,offset){var self=Mohawk.Effects;var cur_x=e.offsetLeft;var cur_y=e.offsetTop;var moved_x=false;if(Math.abs(cur_x-x)>=step_x){e.style.left=(cur_x+Math.sign(x-cur_x)*step_x)+'px';moved_x=true;}else{e.style.left=x-offset.x+'px';}
var moved_y=false;if(Math.abs(cur_y-y)>=step_y){e.style.top=(cur_y+Math.sign(y-cur_y)*step_y)+'px';moved_y=true;}else{e.style.top=y-offset.y+'px';}
if(moved_x||moved_y){self.moving=setTimeout(function(){self._move(e,x,y,step_x*acc_x,step_y*acc_y,acc_x,acc_y,finalize,offset);},1);}else{if(finalize instanceof Function){finalize.call(e);}}},stop:function(){clearTimeout(self.moving);},scrollTo:function(obj){var to=obj.coordinates().y;var from=document.scrollTop();var step=Math.abs(to-from)/10;var prev=0;var scroll=function(){var now=document.scrollTop();if(now==prev){return;}
if(Math.abs(to-now)<=step){window.scrollTo(0,to);}else{window.scrollBy(0,Math.sign(to-now)*step);setTimeout(scroll,1);}
prev=now;};scroll();}});Mohawk.EventInterface={preventDefault:function(){if(this.button==BTN_RIGHT){if(OPERA){no_ctmenu=window.no_ctmenu;if(!no_ctmenu){no_ctmenu=document.createElement('input');no_ctmenu.type='button';document.body.appendChild(no_ctmenu);}
no_ctmenu.style.position='fixed';no_ctmenu.style.top=this.clientY-2+'px';no_ctmenu.style.left=this.clientX-2+'px';no_ctmenu.style.width='5px';no_ctmenu.style.height='5px';no_ctmenu.style.opacity=0;no_ctmenu.style.zIndex=10000;}}
if(typeof this.returnValue!='undefined'){this.returnValue=false;}else{if(window._preventDefault instanceof Function){window._preventDefault.call(this);}}
return false;},stopPropagation:function(){if(typeof this.cancelBubble!='undefined'){this.cancelBubble=true;}else{if(window._stopPropagation instanceof Function){window._stopPropagation.call(this);}}
return false;},cursor:function(){var x=0,y=0;if(this.pageX||this.pageY){x=this.pageX;y=this.pageY;}else if(this.clientX||this.clientY){x=this.clientX+document.scrollLeft();y=this.clientY+document.scrollTop();}else if(this.screenX||this.screenY){x=this.screenX;y=this.screenY;}
return new Pixel(x,y);},wheel:function(){var delta=0;if(this.wheelDelta){delta=event.wheelDelta/120;}else if(this.detail){delta=-this.detail/3;}
return delta;},key:function(){return this.keyCode||this.which||null;},element:function(){return this.srcElement||this.currentTarget;}};if(window.Event){window._preventDefault=window.Event.prototype.preventDefault;window._stopPropagation=window.Event.prototype.stopPropagation;if(FF){delete(Mohawk.EventInterface.preventDefault);}
extend(window.Event,Mohawk.EventInterface);}
Mohawk.NodeClassInterface={getClasses:function(){return this.className?this.className.split(/\s+/):[];},hasClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){if(Array.find(classes,arguments[i])!==false){return true;}}
return false;},addClass:function(className){if(!this.className.length){this.className=className;}else if(!this.hasClass(className)){this.className+=' '+className;}
for(var i=1;i<arguments.length;i++){if(!this.hasClass(arguments[i])){this.className+=' '+arguments[i];}}},removeClass:function(className){var classes=this.getClasses();for(var i=0;i<arguments.length;i++){Array.remove(classes,arguments[i]);}
this.className=classes.join(' ');},replaceClass:function(find,replace){var classes=this.getClasses();if((key=Array.find(classes,find))!==false){classes[key]=replace;this.className=classes.join(' ');}else{this.addClass(replace);}},flipClass:function(className){for(var i=0;i<arguments.length;i++){if(this.hasClass(arguments[i])){this.removeClass(arguments[i]);}else{this.addClass(arguments[i]);}}},copyClassesTo:function(element){var classes=this.getClasses();classes.forEach(function(){element.addClass(this);});},setClassesTo:function(element){element.className=this.className;}};Mohawk.NodeEventInterface={addEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.addEventListener){this.addEventListener(event,action,useCapture);}else if(this.attachEvent){this.attachEvent('on'+event,action);}
return action;},removeEvent:function(event,action,useCapture){if(!useCapture){useCapture=false;}
if(this.removeEventListener){this.removeEventListener(event,action,useCapture);}else if(this.detachEvent){this.detachEvent('on'+event,action);}}};Mohawk.NodeStructureInterface={coordinates:function(){var x=0,y=0;var element=this;while(element){x+=element.offsetLeft;y+=element.offsetTop;element=element.offsetParent;}
return new Pixel(x,y);},isDescendantOf:function(node){var parent=this.parentNode;while(parent){if(parent==node){return true;}
parent=parent.parentNode;}
return false;},isAncestorOf:function(node){var parent=node.parentNode;while(parent){if(parent==this){return true;}
parent=parent.parentNode;}
return false;},removeChildren:function(){while(this.firstChild){this.removeChild(this.firstChild);}},firstTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.firstChild;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},nextTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.nextSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.nextSibling;}
return current;},ancestorTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.parentNode;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.parentNode;}
return current;},previousTag:function(tag){if(typeof tag=='undefined'){tag=false;}
var current=this.previousSibling;while(current&&(!current.tagName||(tag&&current.tagName.toLowerCase()!=tag.toLowerCase()))){current=current.previousSibling;}
return current;},replace:function(node){this.parentNode.replaceChild(node,this);},insertFirst:function(node){this.insertBefore(node,this.firstChild);},insertAfter:function(node,before){this.insertBefore(node,before.nextSibling);},getElementsByClassName:function(class_name){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].hasClass&&elements[i].hasClass(class_name)){found.push(elements[i]);}}
return found;},getElementsByLang:function(lang){var elements=this.getElementsByTagName('*');var found=[];for(var i=0;i<elements.length;i++){if(elements[i].lang==lang){found.push(elements[i]);}}
return found;},setHTML:function(html){this.purgeChildren();this.innerHTML=html;Mohawk.DOM.enchaseDocumentNodes(this);},prependHTML:function(html){this.innerHTML=html+this.innerHTML;Mohawk.DOM.enchaseDocumentNodes(this);},appendHTML:function(html){this.innerHTML+=html;Mohawk.DOM.enchaseDocumentNodes(this);},purge:function(){this.parentNode.purgeChild(this);},purgeChild:function(node){var a=node.attributes,i,l,n;if(a){l=a.length;for(i=0;i<l;i+=1){n=a[i].name;if(node[n]instanceof Function){node[n]=null;}}}
if(node.purgeChildren instanceof Function){node.purgeChildren();}
this.removeChild(node);node=null;},purgeChildren:function(){while(this.firstChild){this.purgeChild(this.firstChild);}},setChild:function(node){this.purgeChildren();this.appendChild(node);},appendTo:function(node){node.appendChild(this);}};Mohawk.ElementOnlyInterface={getElementById:function(id){var elements=this.getElementsByTagName('*');var found=false;for(var i=0;i<elements.length;i++){if(elements[i].id==id){found=elements[i];break;}}
return found;}};Mohawk.NodePositionInterface={alignTo:function(node,side,absolute){switch(side){case'left':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth-this.offsetWidth+'px';break;case'center':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+(node.offsetWidth-this.offsetWidth)/2+'px';break;case'top':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;case'middle':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+(node.offsetHeight-this.offsetHeight)/2+'px';break;}},adjoinTo:function(node,side,absolute){switch(side){case'left':this.style.right=(absolute?node.coordinates().x:node.offsetLeft)+'px';break;case'right':this.style.left=(absolute?node.coordinates().x:node.offsetLeft)+node.offsetWidth+'px';break;case'top':this.style.bottom=(absolute?node.coordinates().y:node.offsetTop)+'px';break;case'bottom':this.style.top=(absolute?node.coordinates().y:node.offsetTop)+node.offsetHeight+'px';break;}}};Mohawk.DOM=new Singletone({ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9,enchaseNode:function(node){if(!node){return;}
if(IE&&typeof(HTMLGenericElement)!='undefined'&&node instanceof HTMLGenericElement){return;}
if(Array.find([self.ELEMENT_NODE,self.DOCUMENT_NODE],node.nodeType)===false){return;}
if(node._enchased instanceof Function&&node._enchased()===true){return;}
if(!node.nodeName||node.nodeName.match(/^(?:svg|OBJECT)/)){return;}
node._cloneNode=node.cloneNode;node.cloneNode=function(flag){var clone=this._cloneNode(flag);self.enchaseNode(clone);return clone;};switch(node.nodeName.toUpperCase()){case'TABLE':node._insertRow=node.insertRow;node.insertRow=function(index){var row=IE?this._insertRow(index):HTMLTableElement.prototype.insertRow.call(this,index);self.enchaseNode(row);return row;};node._createTHead=node.createTHead;node.createTHead=function(){var thead=IE?this._createTHead():HTMLTableElement.prototype.createTHead.call(this);self.enchaseNode(thead);return thead;};node._createTFoot=node.createTFoot;node.createTFoot=function(){var tfoot=IE?this._createTFoot():HTMLTableElement.prototype.createTFoot.call(this);self.enchaseNode(tfoot);return tfoot;};break;case'TR':node._insertCell=node.insertCell;node.insertCell=function(index){var cell=IE?this._insertCell(index):HTMLTableRowElement.prototype.insertCell.call(this,index);self.enchaseNode(cell);return cell;};break;case'FORM':if(typeof Mohawk.FormsInterface!='undefined'){extend(node,Mohawk.FormsInterface);}
break;}
extend(node,Mohawk.NodeClassInterface);extend(node,Mohawk.NodeEventInterface);extend(node,Mohawk.NodeStructureInterface);extend(node,Mohawk.NodePositionInterface);if(node.nodeType==self.ELEMENT_NODE){extend(node,Mohawk.ElementOnlyInterface);}
if(Mohawk.NodeEffectInterface instanceof Object){extend(node,Mohawk.NodeEffectInterface);}
node._enchased=function(){return true;};},enchaseDocument:function(){if(document._document_enchased){return;}
document._document_enchased=true;var createElement=document.createElement;document.createElement=function(tag_name){if(typeof Document=='undefined'){var element=createElement(tag_name);}else{var element=(Document.prototype.createElement||createElement).call(document,tag_name);}
self.enchaseNode(element);return element;};var getElementById=document.getElementById;document.getElementById=function(id){if(typeof Document=='undefined'){var element=getElementById(id);}else{var element=(Document.prototype.getElementById||getElementById).call(document,id);}
self.enchaseNode(element);return element;};document.scrollLeft=function(){return self.pageXOffset||(document.documentElement&&document.documentElement.scrollLeft)||(document.body&&document.body.scrollLeft);};document.scrollTop=function(){return self.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||(document.body&&document.body.scrollTop);};document.size=function(){var w=0,h=0;var win=window.window;if(win.self.innerHeight){w=win.self.innerWidth;h=win.self.innerHeight;}else if(win.document.documentElement&&win.document.documentElement.clientWidth){w=win.document.documentElement.clientWidth;h=win.document.documentElement.clientHeight;}else if(win.document.body){w=win.document.body.clientWidth;h=win.document.body.clientHeight;}
return{width:w,height:h};};extend(document,Mohawk.NodeEventInterface);extend(document,Mohawk.NodeStructureInterface);extend(document,Mohawk.NodePositionInterface);document._toHideOnClick=[];document.addEvent('click',function(){foreach(document._toHideOnClick,function(){this.hide();});});if(typeof document.defaultView=='undefined'){document.defaultView={};}
if(typeof document.defaultView.getComputedStyle=='undefined'){document.defaultView.getComputedStyle=function(element,pseudoElement){return element.currentStyle;};}},enchaseWindow:function(){if(window._window_enchased){return;}
window._window_enchased=true;extend(window,Mohawk.NodeEventInterface);},enchaseDocumentNodes:function(node){if(node){self.enchaseNode(node);}
self.enchaseNode(document.body);var all=(node||document.body).getElementsByTagName('*');if(all.forEach instanceof Function){foreach(all,function(){self.enchaseNode(this);});}else{for(var i=0;i<all.length;i++){self.enchaseNode(all[i]);}}}});Mohawk.DOM.element=function(tag_name,args){var element;if(tag_name.toUpperCase()=='INPUT'){if(IE&&!IE9){var str='<input';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('INPUT');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else if(tag_name.toUpperCase()=='BUTTON'){if(IE&&!IE9){var str='<button';if(args){if(args.name!=undefined){str+=' name="'+args.name+'"';}
if(args.type!=undefined){str+=' type="'+args.type+'"';}}
str+='>';element=document.createElement(str);}else{element=document.createElement('BUTTON');if(args){if(args.name!=undefined){element.name=args.name;}
if(args.type!=undefined){element.type=args.type;}}}}else{element=document.createElement(tag_name);}
if(args&&args instanceof Object){delete(args['name']);delete(args['type']);foreach(args,function(arg,value){if(arg=='className'){if(value instanceof Array){element.addClass.apply(element,value);}else{element.addClass(value);}}else if(arg=='html'){element.setHTML(value);}else if(arg=='appendTo'){element.appendTo(value);}else{element[arg]=value;}});}
return element;};Mohawk.DOM.text=function(text){return document.createTextNode(text);};Mohawk.DOM.event=function(event){event=event||window.event;extend(event,Mohawk.EventInterface);return event;};Mohawk.DOM.stopEvent=function(event){event=DOM.event(event);event.stopPropagation();};Mohawk.DOM.enchaseWindow();Mohawk.DOM.enchaseDocument();document.addLoader(function(){Mohawk.DOM.enchaseDocumentNodes();});window.ID=function(id){return document.getElementById(id);};Mohawk.Utils.IniParser=new Class({parse:function(source){source=source+'\n';var pos=0;var data={};var buffer='';var status=static.STAT_NL;var key='';while(pos<source.length){var cur=source.slice(pos,pos+1);switch(status){case static.STAT_NL:if(cur==';'){status=static.STAT_COM;}else if(cur.match(new RegExp('\\w'))){status=static.STAT_KEY;buffer+=cur;}else if(cur.match(new RegExp('\\s'))){}else{status=static.STAT_ERR;buffer='';}
break;case static.STAT_COM:case static.STAT_ERR:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;}else{}
break;case static.STAT_KEY:if(cur.match(new RegExp('\\w'))){buffer+=cur;}else if(cur==' '||cur==' '){status=static.STAT_END_KEY;key=buffer;buffer='';}else if(cur=='='){status=static.STAT_VAL;key=buffer;buffer='';}else{status=static.STAT_ERR;key='';buffer='';}
break;case static.STAT_END_KEY:if(cur=='='){status=static.STAT_VAL;}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;key='';}
break;case static.STAT_VAL:if(cur==' '){if(buffer){buffer+=cur;}else{}}else if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;if(buffer){data[key]=buffer.rtrim();buffer='';}
key='';}else if(cur=='"'){status=static.STAT_STR;}else if(cur==';'){status=static.STAT_COM;if(buffer){data[key]=buffer;buffer='';}
key='';}else{buffer+=cur;}
break;case static.STAT_STR:if(cur=='"'){status=static.STAT_END_VAL;data[key]=buffer;}else if(cur=='\\'){status=static.STAT_ESC;}else{buffer+=cur;}
break;case static.STAT_ESC:status=static.STAT_STR;if(cur.match(new RegExp('["\\\\]'))){buffer+=cur;}else{buffer+='\\'+cur;}
break;case static.STAT_END_VAL:if(cur.match(new RegExp('\\r\\n|\\n|\\r'))){status=static.STAT_NL;data[key]=buffer;buffer='';key='';}else if(cur==';'){status=static.STAT_COM;data[key]=buffer;buffer='';key='';}else if(cur==' '||cur==' '){}else{status=static.STAT_ERR;buffer='';key='';}
break;default:self.error('Unknown status = '+status);}
if(typeof(Console)!=='undefined'){Console.log([cur,status,pos]);}
pos++;}
return data;},error:function(str){alert(str);}});Mohawk.Utils.IniParser.STAT_KEY='key';Mohawk.Utils.IniParser.STAT_VAL='value';Mohawk.Utils.IniParser.STAT_END_KEY='endkey';Mohawk.Utils.IniParser.STAT_END_VAL='endvalue';Mohawk.Utils.IniParser.STAT_STR='string';Mohawk.Utils.IniParser.STAT_ESC='escape';Mohawk.Utils.IniParser.STAT_COM='comment';Mohawk.Utils.IniParser.STAT_ERR='error';Mohawk.Utils.IniParser.STAT_NL='newline';var StringInterface={trim:function(){return this.rtrim().ltrim();},ltrim:function(){return this.replace(new RegExp('^\\s+'),'');},rtrim:function(){return this.replace(new RegExp('\\s+$'),'');},pad:function(length,chr,right){var str=this;var size=length-this.length;chr=chr||' ';for(var i=0;i<size;i++){str=right?str.concat(chr):chr.concat(str);}
return str;},ucfirst:function(){if(!this.length){return'';}
var first=this.slice(0,1);return first.toUpperCase()+this.slice(1,this.length);},htmlspecialchars:function(){var str=this.valueOf();str=str.replace(/&/g,'&amp;');str=str.replace(/</g,'&lt;');str=str.replace(/>/g,'&gt;');return str;},nl2br:function(){return this.replace(/\r\n|\n\r|\n|\r/g,'<br />');},wordwrap:function(width,str){var len=0;var wrapped='';if(str==undefined){str='\n';}
for(var i=0;i<this.length;i++){var char=this.substr(i,1);if(char.match(/\s/)){len=0;}else{len++;}
if(len>width){wrapped=wrapped.concat(str);len=1;}
wrapped=wrapped.concat(char);}
return wrapped;}};extend(String,StringInterface);Mohawk.Loader=new Singletone({css:[],css_default_url:URL.css+'mohawk/',addCss:function(url){if(!url.match(new RegExp('^(http://|/)','i'))){url=self.css_default_url+url;}
if(document.loaded){self.importCss(url);}else{if(Array.find(self.css,url)===false){self.css.push(url);}}},loadCss:function(){foreach(self.css,function(){self.importCss(this);});},importCss:function(src){var link=document.createElement('LINK');link.href=src;link.type='text/css';link.rel='stylesheet';document.getElementsByTagName('HEAD')[0].appendChild(link);},js:[],js_default_url:URL.home+'system/js/',addJs:function(url){url=url||'';if(!url.match(new RegExp('^(http://|/)','i'))){url=Mohawk.js_url+url;}
if(document.loaded){self.loadJs(url);}else{if(Array.find(self.js,url)===false){self.js.push(url);}}},loadJs:function(){foreach(self.js,self.importJs);},importJs:function(src){var script=DOM.element('script',{src:src,type:'text/javascript',appendTo:document.getElementsByTagName('HEAD')[0]});},extendLanguage:function(lng){foreach(Object.keys(lng),function(){var key=this.toString();var str=lng[key].toString();lng[key.ucfirst()]=str.ucfirst();lng[key.toUpperCase()]=str.toUpperCase();lng[key.toLowerCase()]=str.toLowerCase();});extend(window.LNG,lng);},includeLanguage:function(path){var include_path=URL.lang+ENV.language+'/'+path+'.ini';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);try{var parser=new Mohawk.Utils.IniParser();var lng=parser.parse(XHR.responseText);self.extendLanguage(lng);}catch(e){if(Console){Console.describe(e);}}
Mohawk.included.push(include_path);delete(XHR);}},includeTemplate:function(path){var include_path=URL.html+path.replace(new RegExp('\\.','g'),'/')+'.tmpl';if(Array.find(Mohawk.included,include_path)===false){var XHR=Mohawk.XHR();XHR.open('GET',include_path+'?'+(new Date).valueOf(),false);XHR.send(null);var str=XHR.responseText;str=str.replace(new RegExp('"','g'),'\\"');str=str.replace(new RegExp('([\n\r]+)','g'),'" + "\\n');str='"'+str+'"';var name=path.substr(path.lastIndexOf('.')+1).toUpperCase();name=name.replace(new RegExp('\\W','g'),'_');eval('window.'+name+' = '+str);Mohawk.included.push(include_path);delete(XHR);}}});window.LNG={};document.addLoader(function(){Mohawk.Loader.loadCss();Mohawk.Loader.loadJs();});Mohawk.Observer=new Singletone({events:{},add:function(type,action){if(!(self.events[type]instanceof Array)){self.events[type]=[];}
self.events[type].push(action);},remove:function(type,action){if(self.events[type]instanceof Array){var source=action.toString();var i=0;while(i<self.events[type].length){if(self.events[type][i].toString()==source){self.events[type].splice(i,1);}else{i++;}}}},fire:function(type){if(!self.events[type]){return;}
var args=[];for(i=1;i<arguments.length;i++){args.push(arguments[i]);}
if(self.events[type]instanceof Array){foreach(self.events[type],function(){this.apply(null,args);});}}});var DOM=Mohawk.DOM;var Loader=Mohawk.Loader;var Template=Mohawk.Template;Template.assign('URL',URL);var Effects=Mohawk.Effects;var Observer=Mohawk.Observer;
Mohawk.Dragdrop=new Singletone({css_class:'draggable',max_index:1000,dragged:false,caller:null,target:{elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]},over:[],events:[],reset:function(){self.target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};self.over=[];self.events=[];self.dragged=false;self.caller=null;},dragging:function(){return!!self.events.length;},binSearch:function(array,value){var l=0;var r=array.length-1;if(array[l]>=value){return l;}
if(array[r]<value){return r+1;}
do{var m=Math.round((r+l)/2);if(m==l||m==r||array[m]==value){break;}else if(array[m]<value){l=m;}else{r=m;}}while(true);return m;},createTargetObjectElement:function(target,element,i,last){self=Mohawk.Dragdrop;var n=target.elements.length;var box=Rect.fromNode(element[i]);var start_x=self.binSearch(target.x_delim,box.start.x);if(typeof target.x_boxes[box.start.x]=='undefined'){target.x_boxes[box.start.x]=typeof target.x_delim[start_x-1]!='undefined'&&typeof target.x_boxes[target.x_delim[start_x-1]]!='undefined'?target.x_boxes[target.x_delim[start_x-1]].concat([]):[];target.x_delim.splice(start_x,0,box.start.x);}
var end_x=self.binSearch(target.x_delim,box.end.x);if(typeof target.x_boxes[box.end.x]=='undefined'){target.x_boxes[box.end.x]=typeof target.x_boxes[target.x_delim[end_x-1]]!='undefined'?target.x_boxes[target.x_delim[end_x-1]].concat([]):[];target.x_delim.splice(end_x,0,box.end.x);}
for(var j=start_x;j<end_x;j++){if(typeof target.x_boxes[target.x_delim[j]]=='undefined'){target.x_boxes[target.x_delim[j]]=[];}
target.x_boxes[target.x_delim[j]].push(n);}
var start_y=self.binSearch(target.y_delim,box.start.y);if(typeof target.y_boxes[box.start.y]=='undefined'){target.y_boxes[box.start.y]=typeof target.y_delim[start_y-1]!='undefined'&&typeof target.y_boxes[target.y_delim[start_y-1]]!='undefined'?target.y_boxes[target.y_delim[start_y-1]].concat([]):[];target.y_delim.splice(start_y,0,box.start.y);}
var end_y=self.binSearch(target.y_delim,box.end.y);if(typeof target.y_boxes[box.end.y]=='undefined'){target.y_boxes[box.end.y]=typeof target.y_boxes[target.y_delim[end_y-1]]!='undefined'?target.y_boxes[target.y_delim[end_y-1]].concat([]):[];target.y_delim.splice(end_y,0,box.end.y);}
for(var j=start_y;j<end_y;j++){if(typeof target.y_boxes[target.y_delim[j]]=='undefined'){target.y_boxes[target.y_delim[j]]=[];}
target.y_boxes[target.y_delim[j]].push(n);}
var actions=['ondragover','ondragout','ondrop'];for(var k=0;k<actions.length;k++){var action=element[i][actions[k]]||element[i].getAttribute(actions[k]);try{element[i][actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}catch(e){}}
target.elements[n]=element[i];if(++i<element.length){setTimeout(function(){self.createTargetObjectElement(target,element,i,last);},0);}else if(last){}},createTargetObject:function(element){var target={elements:[],x_boxes:{},x_delim:[],y_boxes:{},y_delim:[]};for(var n=0;n<arguments.length;n++){self.createTargetObjectElement(target,arguments[n],0,n==arguments.length-1);}
return target;},setTarget:function(element){self.target=self.createTargetObject.call(self,arguments);},setTargetObject:function(object){self.target=object;},getDraggable:function(node){if(node.hasClass(self.css_class)){return node;}else{if(node.parentNode){return self.getDraggable(node.parentNode);}else{return null;}}},pick:function(event,elements){self=Mohawk.Dragdrop;event=DOM.event(event);var caller=event.currentTarget||event.srcElement;self.caller=caller;if(!elements||!elements.length){elements=[caller];}
document.addEvent('mousemove',self.drag);document.addEvent('mouseup',self.release);if(IE){document.body.focus();}
document.addEvent('selectstart',self.returnFalse);caller.addEvent('dragstart',self.returnFalse);document.addEvent('dragstart',self.returnFalse);document.body.onselectstart=self.returnFalse;self.events=[];var cur=event.cursor();foreach(elements,function(i){var action=this.onpick||this.getAttribute('onpick');if(action instanceof Function){var handler=new Function(['event'],action.parse().body);handler.call(this,event);}
var draggable=self.getDraggable(this);if(draggable){var evt={element:this,draggable:draggable,position:draggable.style.position||'static',offset:new Pixel(draggable.offsetLeft,draggable.offsetTop),start:new Pixel(cur.x,cur.y),ondrag:handler instanceof Function?handler:false};var actions=['ondrag','ondrop','onrelease'];for(var k=0;k<actions.length;k++){var action=this[actions[k]]||this.getAttribute(actions[k]);evt[actions[k]]=action instanceof Function?new Function(['event'],action.parse().body):false;}
self.events.push(evt);draggable.style.position='absolute';if(draggable.dragFront!==false){self.bringToFront(draggable);}}});event.stopPropagation();return false;},drag:function(event){self=Mohawk.Dragdrop;event=DOM.event(event);if(!self.dragged){document.removeEvent('mouseup',self.release);document.addEvent('mouseup',self.drop);}
self.dragged=true;var cur=event.cursor();for(var i=0;i<self.events.length;i++){var evt=self.events[i];var new_pix=new Pixel(evt.offset.x+cur.x-evt.start.x,evt.offset.y+cur.y-evt.start.y);var move=true;if(evt.ondrag){if(evt.ondrag.call(evt.element,event,new_pix)===false){move=false;}}
if(move){if(evt.draggable.dragX!==false){evt.draggable.style.left=new_pix.x+'px';}
if(evt.draggable.dragY!==false){evt.draggable.style.top=new_pix.y+'px';}}}
if(self.target.elements.length){var x_boxes=self.target.x_boxes[self.target.x_delim[self.binSearch(self.target.x_delim,cur.x)-1]];var y_boxes=self.target.y_boxes[self.target.y_delim[self.binSearch(self.target.y_delim,cur.y)-1]];if(x_boxes&&y_boxes){var boxes=Array.intersect(x_boxes,y_boxes,true);for(var z=0;z<boxes.length;z++){if(cur.inside(Rect.fromNode(self.target.elements[boxes[z]]))){if(Array.find(self.over,self.target.elements[boxes[z]])===false){self.over.push(self.target.elements[boxes[z]]);}
if(self.target.elements[boxes[z]].ondragover){self.target.elements[boxes[z]].ondragover.call(self.target.elements[boxes[z]],event);}}}}}
if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(!cur.inside(bound)){if(over.ondragout){over.ondragout.call(over,event);}
Array.remove(self.over,over);}}}
return false;},drop:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.drop);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;var cur=event.cursor();if(self.over.length){for(var i=0;i<self.over.length;i++){var over=self.over[i];var bound=Rect.fromNode(over);if(cur.inside(bound)){if(over.ondrop){over.ondrop.call(over,event);}}}}
for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.ondrop){evt.element.ondrop.call(evt.element,event);}}
self.reset();},release:function(event){self=Mohawk.Dragdrop;event=Mohawk.DOM.event(event);document.removeEvent('mousemove',self.drag);document.removeEvent('mouseup',self.release);self.caller.removeEvent('dragstart',self.returnFalse);document.removeEvent('selectstart',self.returnFalse);document.removeEvent('dragstart',self.returnFalse);document.body.onselectstart=null;for(var i=0;i<self.events.length;i++){var evt=self.events[i];if(evt.element.onrelease){evt.element.onrelease.call(evt.element,event);}}
self.reset();},bringToFront:function(element){element.style.zIndex=self.max_index;self.max_index++;},getDragObjects:function(){var objects=[];for(var i=0;i<self.events.length;i++){objects.push(self.events[i].draggable);}
return objects;},returnFalse:function(){return false;}});window.Dragdrop=Mohawk.Dragdrop;Mohawk.UI.Console=new Class({element:null,content:null,hidden:true,__construct:function(){var element=DOM.element('div');element.addClass('console');self.element=element;var content=document.createElement('UL');element.appendChild(content);element.collapse();self.content=content;var btn_clear=document.createElement('A');btn_clear.href='#clear';btn_clear.innerHTML='clear';btn_clear.object=self;btn_clear.addClass('clear');btn_clear.onclick=function(){this.object.clear();return false;};self.element.appendChild(btn_clear);var btn_hide=document.createElement('A');btn_hide.href='#hide';btn_hide.innerHTML='hide';btn_hide.object=self;btn_hide.addClass('hide');btn_hide.onclick=function(){this.object.hide();return false;};self.element.appendChild(btn_hide);var form=document.createElement('FORM');form.action='#';form.history=[];form.current=0;form.onsubmit=function(){return false;};form.onclick=function(){form.elements[0].focus();};self.element.appendChild(form);var input=document.createElement('INPUT');input.history=[];input.current=0;input.onkeydown=function(event){event=DOM.event(event);switch(event.key()){case 38:if(this.current>0){this.current--;this.value=this.history[this.current];}
break;case 40:if(this.current<this.history.length-1){this.current++;this.value=this.history[this.current];}
break;case 13:try{var val=eval(this.value);self.log(val);}catch(e){self.log('Error occured: '+self.hash(e),'error');}
this.history.push(this.value);this.current=this.history.length;this.value='';return false;}};input.onfocus=function(){input.addClass('onfocus');};input.onblur=function(){input.removeClass('onfocus');};form.appendChild(input);self.input=input;},append:function(){document.body.appendChild(self.element);},log:function(text,type){var now=new Date;var line=document.createElement('LI');line.innerHTML=IE?'<pre>'+text+'</pre>':text;if(type){line.addClass(type);}
var date=document.createElement('SPAN');date.innerHTML=now.toLocaleString();line.appendChild(date);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},log2:function(title,text){var line=self.content.lastChild?self.content.lastChild:document.createElement('LI');var p=document.createElement('P');var toggle=document.createElement('A');var container=document.createElement('DIV');p.innerHTML=title+': ';toggle.innerHTML='+';toggle.href='#toggle';toggle.onclick=function(){if(toggle.innerHTML=='+'){container.display();toggle.innerHTML='-';}else{container.collapse();toggle.innerHTML='+';}
return false;};container.collapse();container.innerHTML=text;line.appendChild(p);p.appendChild(toggle);line.appendChild(container);self.content.appendChild(line);self.content.scrollTop=self.content.scrollHeight;},error:function(text){self.log(text,'error');},clear:function(){self.content.removeChildren();},hide:function(){self.hidden=true;self.element.collapse();},show:function(){self.hidden=false;self.element.display();self.element.scrollTop=self.element.scrollHeight;self.input.focus();Mohawk.Dragdrop.bringToFront(self.element);},toggle:function(){if(self.hidden){self.show();}else{self.hide();}},hash:function(data){var hash='';switch(typeof data){case'object':if(data==null){hash+='NULL';}else{if(data.forEach){foreach(data,function(i){hash+='\n'+i+':'+this;});}else{for(var i in data){hash+='\n'+i+':'+data[i];};}}
break;case'function':hash+='\n'+i+'()';break;case'string':hash+='"'+data+'"';break;case'number':hash+=data;break;case'boolean':hash+=data?'TRUE':'FALSE';break;case'undefined':hash+='UNDEFINED';break;default:hash+=typeof data;}
return hash;},describe:function(data){self.log(self.hash(data));},regKey:function(){document.console=self;document.addEvent('keydown',function(event){event=DOM.event(event);if(event.ctrlKey){switch(event.key()){case 96:if(!OPERA){break;}
case 192:document.console.toggle();break;}}});},handleErrors:function(flag){try{if(flag=='undefined'){flag=true;}
if(flag){if(!window.Console){window.Console=self;}
window._onerror=window.onerror;window.onerror=function(message,url,line){window.Console.error(message+' (<a href="'+url+'">'+url+'</a> #'+line+')');return false;}}else{if(window._onerror instanceof Function){window.onerror=window._onerror;}}}catch(e){}}});document.addLoader(function(){window.Console=new Mohawk.UI.Console();window.Console.append();window.Console.regKey();window.Console.handleErrors(false);});Mohawk.UI.Progress=new Class({element:null,text:null,loading:false,__construct:function(){var element=document.createElement('DIV');element.id='progress';self.element=element;self.element.onmouseover=function(){if(!self.loading){self.element.collapse(Mohawk.Effects.vanish);}}
var text=document.createElement('P');element.appendChild(text);self.text=text;self.element.collapse();},appendTo:function(node){node.appendChild(self.element);},append:function(){self.appendTo(document.body);},load:function(text){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.innerHTML=text;self.text.addClass('active');self.loading=true;},done:function(text,hide){self.element.display();Mohawk.Dragdrop.bringToFront(self.element);self.text.setHTML(text);self.text.removeClass('active');if(hide){self.element.collapse(Mohawk.Effects.vanish);}
self.loading=false;}});document.addLoader(function(){window.Progress=new Mohawk.UI.Progress;Progress.append();});window.Storage=new Class({name:'',data:null,__construct:function(name){self.name=name;try{var serialized=localStorage.getItem(name)||'[]';self.data=JSON.parse(serialized);}catch(e){self.data=[];}},insert:function(row){self.data.push(Object.clone(row));return self.data.length;},update:function(row,predicate){var rows_id=self.find(predicate);if(!rows_id){return null;}
return self.updateByIndex(row,rows_id);},updateByIndex:function(row,index){for(var i=0;i<index.length;i++){foreach(row,function(key,value){self.data[index[i]][key]=value?value.valueOf():null;});};return index;},remove:function(predicate){var rows_id=self.find(predicate);if(!rows_id){return null;}
return self.removeByIndex(rows_id);},removeByIndex:function(index){for(var i=0;i<index.length;i++){delete(self.data[index[i]]);};return index;},select:function(cols,predicate,order){if(predicate==undefined){predicate={};}
var rows_id=self.find(predicate);var rows=[];if(cols==undefined||cols=='*'){for(var i=0;i<rows_id.length;i++){rows.push(Object.clone(self.data[rows_id[i]]));};}else if(cols instanceof Array){for(var i=0;i<rows_id.length;i++){var row={};foreach(cols,function(){row[this]=self.data[rows_id[i]][this];});rows.push(Object.clone(row));};}else{for(var i=0;i<rows_id.length;i++){rows.push(self.data[rows_id[i]][cols]);};}
if(order!=undefined){rows.sort(function(a,b){a[order]>b[order];});}
return rows;},find:function(predicate){var id=[];for(var i=0;i<self.data.length;i++){if(self.data[i]==undefined){continue;}
if(self.match(self.data[i],predicate)){id.push(i);}}
return id;},isAny:function(predicate){for(var i=0;i<self.data.length;i++){if(self.data[i]==undefined){continue;}
if(self.match(self.data[i],predicate)){return true;}}
return false;},match:function(row,predicate){var result=false;if(predicate instanceof Array){foreach(predicate,function(key){result=self.match(row,this);return!result;});}else{result=true;foreach(predicate,function(key,value){if(row[key]==null){result=false;}else{var val=row[key].valueOf();if(value instanceof Array){result=Array.find(value,val)!==false;}else{result=value==val;}}
return result;});}
return result;},store:function(){var rows=[];for(var i=0;i<self.data.length;i++){if(self.data[i]!=undefined){rows.push(self.data[i]);}}
try{localStorage.setItem(self.name,JSON.stringify(rows));}catch(e){}}});window.PkStorage=Storage.extend({pk:'',__construct:function(name,pk){self.pk=pk;parent.__construct(name);},isAnyByPk:function(id){var cond={};cond[self.pk]=id;return self.isAny(cond);},removeByPk:function(id){var cond={};cond[self.pk]=id;self.remove(cond);},selectByPk:function(fields,id){var cond={};cond[self.pk]=id;var rows=self.select(fields,cond);if(!rows){return null;}
return rows[0];}});window.Revisions=new Storage('_revisions');Revisions.rev=0;window.StorageList={};window.RStorage=PkStorage.extend({__construct:function(name,pk){self.EVENT_PK_UPDATED='pk-updated-'+name;self.EVENT_ROW_REMOVED='row-removed-'+name;parent.__construct(name,pk);window.StorageList[name]=self;},foreignKey:function(field,table){Observer.add(table.EVENT_PK_UPDATED,function(tmp_id,new_id){var data={};data[field]=new_id;var cond={};cond[field]=tmp_id;self.updateByIndex(data,self.find(cond));});Observer.add(table.EVENT_ROW_REMOVED,function(id,rev){var cond={};cond[field]=id;self.remove(cond,rev);});},insert:function(row,rev){var id=parent.insert(row);var meta={type:self.name,id:row[self.pk],r:0,a:'+'};if(rev){meta.a=0;meta.r=rev;}
Revisions.insert(meta);return id;},update:function(row,predicate,rev){var rows_id=self.find(predicate);var meta_data={a:1};if(rev){meta_data.a=0;meta_data.r=rev;}
for(var i=0;i<rows_id.length;i++){var cond={type:self.name,id:self.data[rows_id[i]][self.pk]};var meta=Revisions.select('a',cond);if(meta[0]==0||rev){Revisions.update(meta_data,cond);}};return self.updateByIndex(row,rows_id);},updateByPk:function(data,id,rev){var cond={};cond[self.pk]=id;return self.update(data,cond,rev);},remove:function(predicate,rev){var rows_id=self.find(predicate);var id_set=[];for(var i=0;i<rows_id.length;i++){var id=self.data[rows_id[i]][self.pk];var cond={type:self.name,id:id};var meta=Revisions.select('a',cond);if(meta[0]=='+'){Revisions.remove(cond);}else{Revisions.update({a:'-'},cond);}
id_set.push(id);}
var result=self.removeByIndex(rows_id);if(rows_id.length){Observer.fire(self.EVENT_ROW_REMOVED,id_set,rev);}
return result;},removeByPk:function(id,rev){var cond={};cond[self.pk]=id;var result=self.remove(cond);if(rev){self.apply(id,rev);}
return result;},updatePk:function(tmp_id,new_id){Revisions.update({id:new_id},{type:self.name,id:tmp_id});var cond={};cond[self.pk]=tmp_id;var data={};data[self.pk]=new_id;self.parent.update(data,cond);Observer.fire(self.EVENT_PK_UPDATED,tmp_id,new_id);},apply:function(id,rev){var cond={type:self.name,id:id};var meta=Revisions.select('a',cond);try{if(meta[0]=='-'){Revisions.remove(cond);}else{Revisions.update({a:0,r:rev},cond);}}catch(e){Console.describe(e);}},store:function(){parent.store();Revisions.store();}});window.LocalSettings=new Singletone({Storage:null,__construct:function(){self.Storage=new PkStorage('local_settings','key');window.addEvent('unload',function(){LocalSettings.Storage.store();});},set:function(key,value){if(self.Storage.isAnyByPk(key)){self.Storage.update({value:value},{key:key});}else{self.Storage.insert({key:key,value:value});}},get:function(key){return self.Storage.selectByPk('value',key);}});Mohawk.Utils.Cookie=new Singletone({STORAGE_DOCUMENT_COOKIE:'document.cookie',STORAGE_WINDOW_NAME:'window.name',storage:null,__construct:function(){self.storage=self.STORAGE_DOCUMENT_COOKIE;},set:function(name,value,expires,path,domain,secure){var cookie=name+'='+escape(Ajax.prepare(value));if(expires){cookie+='; max-age='+expires;}
cookie+='; path='+(path||'/');if(domain){cookie+='; domain='+domain;}
if(secure){cookie+='; secure';}
switch(self.storage){case self.STORAGE_DOCUMENT_COOKIE:document.cookie=cookie;break;case self.STORAGE_WINDOW_NAME:top.name=cookie;break;}},get:function(name){var cookie='';switch(self.storage){case self.STORAGE_DOCUMENT_COOKIE:cookie=document.cookie;break;case self.STORAGE_WINDOW_NAME:cookie=top.name;break;}
var tuples=cookie.split(';');var value=null;for(var i=0;i<tuples.length;i++){var tuple=tuples[i].toString().trim().split('=');if(tuple[0].toString().trim()==name){value=Ajax.parse_url('data='+unescape(tuple[1]));break;}};return value==null||value.data==null?null:value.data;}});window.htmlspecialchars=function(str){str=String(str);str=str.replace(/&/g,'&amp;');str=str.replace(/</g,'&lt;');str=str.replace(/>/g,'&gt;');str=str.replace(/"/g,'&quot;');return str;};window.nl2br=function(str){return str.replace(/\r\n|\n\r|\n|\r/g,'<br />');};function calculate_time_zone(){var now=new Date();var jan1=new Date(now.getFullYear(),0,1,0,0,0,0);var temp=jan1.toGMTString();var jan2=new Date(temp.substring(0,temp.lastIndexOf(' ')-1));return(jan1-jan2)/1000/3600;}
window.PREMIUM_INFO="<div class=\"wrap\">"+"\n    <h1>{%LNG.Almost_there}</h1>"+"\n    <p><img src=\"{%URL.img}site/premium.png\" alt=\"*\" /> {%LNG.Need_premium}</p>"+"\n    <a class=\"button\" href=\"{%URL.home}premium/\"><span><span>{%LNG.Know_more}</span></span></a>"+"\n    <a class=\"script\" href=\"#hide\" onclick=\"return hide_premium()\">{%LNG.No_thanks}</a>"+"\n</div>";window.show_premium=function(){var div=ID('premium-info');if(div){return;}
Shadow.show();div=DOM.element('DIV',{id:'premium-info',innerHTML:Template.transform(PREMIUM_INFO),appendTo:document.body});Dragdrop.bringToFront(div);return false;}
window.hide_premium=function(){Shadow.hide();var div=ID('premium-info');div.purge();return false;}
Mohawk.FormsInterface={getData:function(){var data={};for(var i=0;i<this.elements.length;i++){var element=this.elements[i];if(element&&element.name){if(!element.disabled){switch(element.type){case'checkbox':case'radio':if(!element.checked){break;}
default:switch(element.tagName.toLowerCase()){case'select':if(element.multiple){if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}}else{data[element.name]=[];}
for(var j=0;j<element.options.length;j++){if(element.options[j].selected){data[element.name].push(element.options[j].value);}}
break;}
default:if(element.name in data){if(!(data[element.name]instanceof Array)){data[element.name]=[data[element.name]];}
data[element.name].push(element.value);}else{data[element.name]=element.value;}}}}}}
return data;},setData:function(data,name){var form=this;var changed=[];if(typeof name=='undefined'){name='';}
function set_data(data,name,keys){if(data instanceof Object){if(data instanceof Array){for(var i=0;i<data.length;i++){set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
set_data(data[i],name?name:i,name?(keys?keys.concat(i):[i]):[]);}}}else{var element_name=name+(keys.length?'['+keys.join('][')+']':'');if(typeof form[element_name]=='undefined'){element_name=name+(keys.length>1?'['+keys.slice(0,-1).join('][')+']':'')+'[]';if(typeof form[element_name]=='undefined'){return false;}}
var element=form[element_name];if(!element.length||element.tagName){element=[element];}
for(var i=0;i<element.length;i++){if(!element[i].tagName){continue;}
switch(element[i].tagName.toLowerCase()){case'select':if(element[i].multiple){for(var j=0;j<element[i].options.length;j++){if(element[i].options[j].value==data){element[i].options[j].selected=true;changed.push(element[i].options[j]);}else if(Array.find(changed,element[i].options[j])===false){element[i].options[j].selected=false;}}
break;}
case'input':if(element[i].type=='checkbox'||element[i].type=='radio'){if(element[i].value==data){element[i].checked=true;changed.push(element[i]);}else if(Array.find(changed,element[i])===false){element[i].checked=false;}
break;}
default:element[i].value=data;}
if(typeof(element[i].onchange)!='undefined'&&element[i].onchange instanceof Function){element[i].onchange();}}}
return true;}
set_data(data,name,[]);},createInput:function(type,name,value,options){switch(type){default:case'hidden':case'text':case'password':case'checkbox':if(IE&&!IE9){var input=document.createElement('<input name="'+name+'">');}else{var input=document.createElement('INPUT');input.name=name;}
input.type=type;input.value=value;break;case'textarea':if(IE&&!IE9){var input=document.createElement('<textarea name="'+name+'">');}else{var input=document.createElement('TEXTAREA');input.name=name;}
input.value=value;break;case'select':if(IE&&!IE9){var input=document.createElement('<select name="'+name+'">');}else{var input=document.createElement('SELECT');input.name=name;}
foreach(options,function(i,val){if(typeof(val)=='undefined'){return;}
var option=document.createElement('OPTION');option.value=val.value;option.innerHTML=val.text;if(value==option.value){option.selected=true;}
input.appendChild(option);});break;}
return input;}};window.FormsInterface=Mohawk.FormsInterface;Mohawk.XML=new Singletone({empty_elements:['br','img','link','meta','input','hr'],inline_elements:['a','abbr','acronym','b','basefont','bdo','big','br','cite','code','dfn','em','font','i','img','input','kbd','label','q','s','samp','select','small','span','strike','strong','sub','sup','textarea','tt','u','var','applet','button','del','iframe','ins','map','object','script'],toObject:function(node){switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:return node.nodeValue;case Mohawk.DOM.ELEMENT_NODE:var data=null;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeName!='_key'){if(data===null){data={};}
data[node.attributes[i].nodeName]=node.attributes[i].nodeValue;}}
var allow_text_nodes=true;node.normalize();for(var i=0;i<node.childNodes.length;i++){var child=self.toObject(node.childNodes[i]);if(child instanceof Object){if(!(data instanceof Object)){data={};}
if(child.name in data){if(!(data[child.name]instanceof Array)){data[child.name]=[data[child.name]];}
data[child.name].push(child.content);}else if(node.childNodes[i].getAttribute('_key')!=null){data[child.name]=[child.content];}else{data[child.name]=child.content;}
allow_text_nodes=false;}else if(allow_text_nodes){data=child;}}
return{name:node.nodeName,content:data};case Mohawk.DOM.DOCUMENT_NODE:var data=self.toObject(node.documentElement);return data.content;default:Console.log('Cannot handle type: '+node.nodeType);}},parse:function(str){var xmldoc;if(window.DOMParser){parser=new DOMParser();xmldoc=parser.parseFromString(str,'text/xml');}else{xmldoc=new ActiveXObject('Microsoft.XMLDOM');xmldoc.async='false';xmldoc.loadXML(str);}
return self.toObject(xmldoc);},escape:function(str){str=str.replace('&','&amp;');var table={62:'gt',60:'lt',160:'nbsp',169:'copy',8212:'mdash',8482:'trade',8482:'trade',8222:'bdquo',171:'laquo',8220:'ldquo',8222:'lsaquo',8249:'lsquo',187:'raquo',8221:'rdquo',8250:'rsaquo',8217:'rsquo',8218:'sbquo'};foreach(table,function(code){str=str.replace(new RegExp(String.fromCharCode(code),'g'),'&'+this+';');});return str;},clean:function(str){str=str.replace(new RegExp('^[\\s]+','gm'),' ');str=str.replace(new RegExp('[\\s]+$','gm'),' ');return str;},toHtml:function(node,padding,pad_with,exclude_name,first){if(!padding){padding='\n';}
if(!pad_with){pad_with='\t';}
switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:var value=self.escape(node.nodeValue);value=self.clean(value);return value;case Mohawk.DOM.ELEMENT_NODE:var tag=node.nodeName.toLowerCase();var str='';if(!exclude_name){var str=(!first&&Array.find(self.inline_elements,tag)===false?padding:'')+'<'+tag;for(var i=0;i<node.attributes.length;i++){if(node.attributes[i].nodeValue==''||node.attributes[i].nodeValue==null){continue;}
if(node.attributes[i].nodeValue.toString().match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
if(node.attributes[i].nodeName.match(new RegExp('^(_moz|apple|contentEditable)','i'))){continue;}
var value=self.escape(node.attributes[i].nodeValue.toString());str+=' '+node.attributes[i].nodeName+'="'+value+'"';}
if(!node.childNodes.length&&Array.find(self.empty_elements,tag)!==false){str+=' />';}else{str+='>';}}
var padding_closing='';if(tag=='pre'){str+=node.innerHTML;}else{node.normalize();var padding_children=!exclude_name?padding+pad_with:padding;var first_child=true;for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];var value=self.toHtml(child,padding_children,pad_with,false,exclude_name&&first_child);str+=value;if(value){first_child=false;}
if(Array.find([Mohawk.DOM.TEXT_NODE,Mohawk.DOM.CDATA_SECTION_NODE],child.nodeType)===false&&child.nodeName&&Array.find(self.inline_elements,child.nodeName.toLowerCase())===false){padding_closing=padding;}}}
if(node.childNodes.length||Array.find(self.empty_elements,tag)===false){str+=!exclude_name?(padding_closing+'</'+tag+'>'):'';}
return str;case Mohawk.DOM.DOCUMENT_NODE:return self.toHtml(node.documentElement,padding,pad_with,exclude_name,not_first);default:return'XML: unsupported type of node '+node.nodeType;}}});window.XML=Mohawk.XML;Mohawk.Ajax=new Class({XHR:null,caller:null,url:'',method:'',overwrite_method:true,data:'',charset:'UTF-8',sync:true,xml:'',text:'',type:'',data:{},__construct:function(url,method){self.url=url;self.method=method||static.METHOD_GET;self.type=static.TYPE_XML;self.XHR=Mohawk.XHR();},responseHandler:function(){},errorHandler:function(){},send:function(data){if(typeof self.XHR=='object'){self.XHR.onreadystatechange=function(){self.procedure.apply(self);};self.method=self.method.toUpperCase()
switch(self.method){default:case static.METHOD_GET:var url_with_data=self.url+(self.url.match(new RegExp('\\?'))?'&':'?')+static.prepare(data);self.XHR.open(static.METHOD_GET,url_with_data,self.sync);var get=true;break;case static.METHOD_POST:case static.METHOD_PUT:case static.METHOD_DELETE:case static.METHOD_OPTIONS:case static.METHOD_HEAD:self.XHR.open(self.overwrite_method?static.METHOD_POST:self.method,self.url,self.sync);var get=false;break;}
self.XHR.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset='+self.charset);self.XHR.setRequestHeader('X-Request-Method',self.method);self.XHR.setRequestHeader('Accept',self.type);if(get){if(window.XMLHttpRequest){self.XHR.send(null);}else{self.XHR.send();}}else{var query=static.prepare(data);self.XHR.send(query);}
if(window.Console){var hash=window.Console.hash(data);hash=hash.replace(new RegExp('<','g'),'&lt;');hash=hash.replace(new RegExp('>','g'),'&gt;');var report='Ajax query : '+self.method+' <a href="'+self.url+'">'+self.url+'</a><br />'
+'Data: <pre>'+hash+'</pre>'
+'Query: '+query;window.Console.log(report);}}else{self.error('XMLHttpRequest is not initialized');}},procedure:function(){var error=false;switch(self.XHR.readyState){case static.STATE_UNINITIALIZED:break;case static.STATE_LOADED:if(self.XHR.status==static.HTTP_OK){if(self.XHR.responseXML){self.xml=self.XHR.responseXML;}else{if(self.type==static.TYPE_XML&&self.errorHandler instanceof Function){error=true;self.errorHandler.call(self);}}}else{if(self.errorHandler instanceof Function){error=true;self.errorHandler(self);}}
self.text=self.XHR.responseText;if(window.Console){var data=self.XHR.responseText;data=data.replace(new RegExp('<','g'),'&lt;');data=data.replace(new RegExp('>','g'),'&gt;');var report='Ajax query received from: <a href="'+self.url+'">'+self.url+'</a>';window.Console.log(report);window.Console.log2('Data',data);}
switch(self.type){case static.TYPE_JSON:eval('self.data = '+self.text);break;case static.TYPE_XML:self.data=Mohawk.XML.toObject(self.xml);break;}
if(!error){self.responseHandler(self);}
break;default:}},error:function(message){if(window.Console){window.Console.log(message,'error');}}});Mohawk.Ajax.HTTP_OK=200;Mohawk.Ajax.HTTP_NOT_FOUND=404;Mohawk.Ajax.STATE_UNINITIALIZED=0;Mohawk.Ajax.STATE_OPEN=1;Mohawk.Ajax.STATE_SENT=2;Mohawk.Ajax.STATE_RECEIVING=3;Mohawk.Ajax.STATE_LOADED=4;Mohawk.Ajax.METHOD_GET='GET';Mohawk.Ajax.METHOD_POST='POST';Mohawk.Ajax.METHOD_PUT='PUT';Mohawk.Ajax.METHOD_DELETE='DELETE';Mohawk.Ajax.METHOD_HEAD='HEAD';Mohawk.Ajax.METHOD_OPTIONS='OPTIONS';Mohawk.Ajax.TYPE_XML='text/xml';Mohawk.Ajax.TYPE_JSON='text/json';Mohawk.Ajax.TYPE_TEXT='text/text';Mohawk.Ajax.escape=function(str){if(typeof str=='string'){if(OPERA){str=str.replace(new RegExp('\r','g'),'');}
str=str.replace(new RegExp('%','g'),'%'+'25');str=str.replace(new RegExp('\n','g'),'%'+'0A');str=str.replace(new RegExp('\r','g'),'%'+'0D');str=str.replace(new RegExp('&','g'),'%'+'26');str=str.replace(new RegExp('#','g'),'%'+'23');str=str.replace(new RegExp('\\+','g'),'%'+'2B');}
return str;};Mohawk.Ajax.prepare=function(data,prefix){var query='';switch(typeof data){case'object':if(data instanceof Array){for(var i=0;i<data.length;i++){if(typeof Array.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'[]':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}else{for(var i in data){if(typeof Object.prototype[i]!='undefined'){continue;}
query+=(query.length?'&':'');switch(typeof data[i]){case'object':if(data[i]==null){query+=prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=';}else{query+=Mohawk.Ajax.prepare(data[i],prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':''):i);}
break;case'string':case'number':case'boolean':query+=(prefix?prefix+(!prefix.match(new RegExp('\\[\\]$'))?'['+i+']':'')+'=':i+'=')+Mohawk.Ajax.prepare(data[i],prefix?prefix+'['+i+']':i);break;}}}
break;case'string':case'number':case'boolean':query=prefix?Mohawk.Ajax.escape(data):data;break;}
return query;};Mohawk.Ajax.parse_url=function(url){var chunks=url.split('&');var data={};foreach(chunks,function(){var tuple=this.split('=');var m;if(m=tuple[0].match(new RegExp('([a-z][a-z_0-9]*)((?:\\[[a-z_0-9]*\\])*)','i'))){var rec=data;var last=m[1].toString();if(m[2]){var keys=m[2].slice(1,-1).split('][');keys.unshift(m[1]);last=keys.pop();var prev_rec,prev_key;foreach(keys,function(){var key=this.toString();if(!(rec[key]instanceof Object)){rec[key]={};}
prev_rec=rec;prev_key=key;rec=rec[key];});}
if(last==''){if(!(rec instanceof Array)){prev_rec[prev_key]=[];}
prev_rec[prev_key].push(tuple[1]);}else{rec[last]=tuple[1];}}});return data;};window.Ajax=Mohawk.Ajax;window.GoalsApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/goals/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){self.addIcons(req.data.icon);Observer.fire('goal-added',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Goals.Add,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/goals/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){self.addIcons(req.data.icon);Observer.fire('goal-edited',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Goals.Edit,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},addIcons:function(icons){if(icons){if(icons.id){icons=[icons];}
foreach(icons,function(i,icon){Data.icons[icon.id]=icon.src;});}},showErrors:function(form,error){foreach(error,function(name){var input=form.element[name];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/goals/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('goal-removed',item);Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Deleting);},archive:function(id){self.edit(id,{archived:Data.today});},restore:function(id){self.edit(id,{archived:null});},sort:function(){var rows=Goals.Table.table.tBodies[0].childNodes;var pos=0;var data=[];for(var i=0;i<rows.length;i++){pos++;data.push({id:rows[i].data.id,position:pos});}
var req=new Ajax(URL.home+'api/goals/',Ajax.METHOD_PUT);req.responseHandler=function(req){var item=req.data.item;if(item){if(item.id){item=[item];}
Observer.fire('goals-sorted',item);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},save:function(id,date,data){var req=new Ajax(URL.home+'api/goals/'+id+'/'+date+'/data/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.ok){self.setData(id,date,data);var row=ID('goal-'+id);Goals.Table.createChart(row.data,row.getElementsByClassName('chart')[0]);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);Goals.Table.setPlan(row);var cell=Goals.Table.getDataCell(id,date);if(data.text!=undefined){if(data.text){cell.addClass('commented');}else{cell.removeClass('commented');}}
Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send(data);Progress.load(LNG.Saving);},addPlan:function(data){var req=new Ajax(URL.home+'api/plan/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){self.setPlan(req.data.item);self.Table.setPlan(ID('goal-'+data.goal));Observer.fire('plan-added-'+data.id,req.data.item.id);var row=ID('goal-'+req.data.item.goal);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send(data);Progress.load(LNG.Saving);},editPlan:function(id,data){var req=new Ajax(URL.home+'api/plan/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){self.setPlan(req.data.item);var row=ID('goal-'+req.data.item.goal);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);self.Table.setPlan(row);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send(data);Progress.load(LNG.Saving);},removePlan:function(id,goal){var req=new Ajax(URL.home+'api/plan/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.ok){self.unsetPlan(goal,id);self.Table.setPlan(ID('goal-'+goal));Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Saving);},initSearch:function(input){clearTimeout(self.search_timeout);self.search_timeout=setTimeout(function(){Goals.search(input.value);},1000);},search:function(query){if(query.length<3){return;}
var req=new Ajax(URL.home+'api/templates/search/');req.responseHandler=function(req){if(req.data.item){var items=req.data.item;if(items.id){items=[items];}
Goals.Add.Templates.setChildren(items);Progress.done(LNG.Done,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({q:query});Progress.load(LNG.Searching);},getData:function(id,date){var data={};if(id in Data.data&&date in Data.data[id]){data=Data.data[id][date];}
if(data.value&&data.value.match&&data.value.match(/\d+(\.\d+)?/)){data.value=parseFloat(data.value);}
return data;},setData:function(id,date,data){if(Data.data[id]==undefined){Data.data[id]={};}
if(Data.data[id][date]==undefined){Data.data[id][date]={};}
foreach(Object.keys(data),function(i,key){Data.data[id][date][key]=data[key];});},setPlan:function(data){var id=data.id;var goal=data.goal;if(Data.plan[goal]==undefined){Data.plan[goal]={};}
if(Data.plan[goal][id]==undefined){Data.plan[goal][id]={};}
foreach(data,function(i,value){Data.plan[goal][id][i]=value;});},unsetPlan:function(goal,id){if(Data.plan[goal]==undefined){return;}
if(Data.plan[goal][id]==undefined){return;}
delete(Data.plan[goal][id]);}});window.TabsApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/tabs/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){Observer.fire('tab-added',req.data.item);Progress.done(LNG.Saved,true);}else{Progress.done('Error');}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/tabs/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){Observer.fire('tab-edited',req.data.item);Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},remove:function(id){if(!confirm('Delete? There is NO undo')){return;}
var req=new Ajax(URL.home+'api/tabs/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('tab-removed',item);Progress.done('Deleted',true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load('Deleting');},create:function(){var data={};data.title=prompt(LNG.Input_new_tab_name);data.position=parseInt(Goals.Tabs.element.lastChild?Goals.Tabs.element.lastChild.data.position:0)+1;if(data.title===null||!data.title.length){return;}
self.add(data);},sort:function(){var pos=0;var data=[];var nodes=Goals.Tabs.element.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].cloned){continue;}
pos++;data.push({id:nodes[i].data.id,position:pos});}
var req=new Ajax(URL.home+'api/tabs/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.ok){Progress.done(LNG.Saved,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);}});Mohawk.UI.List=new Class({id:'',element:null,onchange:function(){},__construct:function(id,structure){self.id=id;self.element=document.createElement('UL');self.element.id=id;self.element.object=self;self.setChildren(structure);},setChildren:function(structure){self.element.removeChildren();for(var i=0;i<structure.length;i++){self.addNode(structure[i]);}},createNode:function(data){var node=document.createElement('LI');node.id=self.getId(data.id);node.data=data;node.parent=self.element;node.innerHTML=data.title;node.getId=function(){return this.id;};node.isLast=function(){return node.hasClass('last');};node.setLast=function(){node.addClass('last');};node.notLast=function(){node.removeClass('last');};node.onmouseover=function(event){node.addClass('over');};node.onmouseout=function(event){node.removeClass('over');};return node;},getId:function(id){return self.id+'-'+id;},getNode:function(id){var node=null;var id=self.getId(id);if(self.element.parentNode){node=ID(id);}else{for(var i=0;i<self.element.childNodes.length;i++){if(self.element.childNodes[i].id==id){node=self.element.childNodes[i];break;}}}
return node;},addNode:function(data){var node=self.createNode(data);self.element.appendChild(node);if(node.previousSibling){node.previousSibling.notLast();}
node.setLast();return node;},editNode:function(node,data){var node_data=node.data;foreach(data,function(i){node_data[i]=data[i];});var new_node=self.createNode(node_data);node.setClassesTo(new_node);node.replace(new_node);return new_node;},removeNode:function(node){if(node.isLast()){if(node.previousSibling){node.previousSibling.setLast();}}
node.remove();},appendTo:function(node){node.appendChild(self.element);}});Mohawk.UI.OrderedList=Mohawk.UI.List.extend({addNode:function(data){var node=self.createNode(data);self.placeNode(node);return node;},editNode:function(node,data){var node_data=node.data;foreach(data,function(i){node_data[i]=data[i];});var new_node=self.createNode(node_data);node.setClassesTo(new_node);self.removeNode(node);self.placeNode(new_node);return new_node;},placeNode:function(node){if(self.compareNodes instanceof Function){var before=null;for(var i=0;i<self.element.childNodes.length;i++){var child=self.element.childNodes[i];if(child==node){continue;}
if(self.compareNodes(node,child)){before=child;break;}}
self.element.insertBefore(node,before);}else{self.element.appendChild(node,child);}
if(node.previousSibling&&node.previousSibling.isLast()){node.previousSibling.notLast();node.setLast();}else if(self.element.childNodes.length==1){node.setLast();}}});Mohawk.Loader.extendLanguage({"Add_Goal":"Add A New Goal","Add_goal":"Add a new goal","ADD_GOAL":"ADD A NEW GOAL","add_goal":"add a new goal","Pick_Template":"Pick From A Template","Pick_template":"Pick from a template","PICK_TEMPLATE":"PICK FROM A TEMPLATE","pick_template":"pick from a template","Advanced_Mode":"Advanced Mode","Advanced_mode":"Advanced mode","ADVANCED_MODE":"ADVANCED MODE","advanced_mode":"advanced mode","Additional_Parameters":"Additional Parameters","Additional_parameters":"Additional parameters","ADDITIONAL_PARAMETERS":"ADDITIONAL PARAMETERS","additional_parameters":"additional parameters","Loading_Templates":"Loading Templates","Loading_templates":"Loading templates","LOADING_TEMPLATES":"LOADING TEMPLATES","loading_templates":"loading templates","Search":"Search","SEARCH":"SEARCH","search":"search","Add_This_Template":"Add To Your Goals","Add_this_template":"Add to your goals","ADD_THIS_TEMPLATE":"ADD TO YOUR GOALS","add_this_template":"add to your goals","Pick_Icon":"Pick An Icon","Pick_icon":"Pick an icon","PICK_ICON":"PICK AN ICON","pick_icon":"pick an icon","Hide_Ok":"Hide","Hide_ok":"Hide","HIDE_OK":"HIDE","hide_ok":"hide","Item_Search":"Or Search For An Icon Below","Item_search":"Or search for an icon below","ITEM_SEARCH":"OR SEARCH FOR AN ICON BELOW","item_search":"or search for an icon below","Click_To_Change_Value":"Click To Change The Value","Click_to_change_value":"Click to change the value","CLICK_TO_CHANGE_VALUE":"CLICK TO CHANGE THE VALUE","click_to_change_value":"click to change the value","Searching":"Searching","SEARCHING":"SEARCHING","searching":"searching","Search_More":"Search More","Search_more":"Search more","SEARCH_MORE":"SEARCH MORE","search_more":"search more","Powered_By_Iconfinder":"Powered By Iconfinder.com","Powered_by_iconfinder":"Powered by Iconfinder.com","POWERED_BY_ICONFINDER":"POWERED BY ICONFINDER.COM","powered_by_iconfinder":"powered by Iconfinder.com","Nothing_Found":"Nothing Is Found","Nothing_found":"Nothing is found","NOTHING_FOUND":"NOTHING IS FOUND","nothing_found":"nothing is found","Icon_Search_Hint":"Type A Keyword To Find An Icon &uarr; Or Pick From Below &darr;","Icon_search_hint":"Type a keyword to find an icon &uarr; or pick from below &darr;","ICON_SEARCH_HINT":"TYPE A KEYWORD TO FIND AN ICON &UARR; OR PICK FROM BELOW &DARR;","icon_search_hint":"Type a keyword to find an icon &uarr; or pick from below &darr;","Editing_Goal":"Goal","Editing_goal":"Goal","EDITING_GOAL":"GOAL","editing_goal":"goal","Setting_Plan":"Planning","Setting_plan":"Planning","SETTING_PLAN":"PLANNING","setting_plan":"planning","Statistics":"Statistics","STATISTICS":"STATISTICS","statistics":"statistics","Premium_Feature":"Premium Feature","Premium_feature":"Premium feature","PREMIUM_FEATURE":"PREMIUM FEATURE","premium_feature":"premium feature","Show_All_Goals":"Show All Goals","Show_all_goals":"Show all goals","SHOW_ALL_GOALS":"SHOW ALL GOALS","show_all_goals":"show all goals","Loading_Tab":"Loading Tab","Loading_tab":"Loading tab","LOADING_TAB":"LOADING TAB","loading_tab":"loading tab","Save":"Save","SAVE":"SAVE","save":"save","Saving":"Saving","SAVING":"SAVING","saving":"saving","Saved":"Saved","SAVED":"SAVED","saved":"saved","Confirm_Delete":"Delete? There Is No Undo","Confirm_delete":"Delete? There is NO undo","CONFIRM_DELETE":"DELETE? THERE IS NO UNDO","confirm_delete":"Delete? There is NO undo","Deleted":"Deleted","DELETED":"DELETED","deleted":"deleted","Deleting":"Deleting","DELETING":"DELETING","deleting":"deleting","Delete_This_Tab":"Delete This Tab","Delete_this_tab":"Delete this tab","DELETE_THIS_TAB":"DELETE THIS TAB","delete_this_tab":"delete this tab","Tab_Empty":"This Tab Is Empty","Tab_empty":"This tab is empty","TAB_EMPTY":"THIS TAB IS EMPTY","tab_empty":"this tab is empty","You_Can":"You Can","You_can":"You can","YOU_CAN":"YOU CAN","you_can":"you can","Loading":"Loading","LOADING":"LOADING","loading":"loading","Input_New_Tab_Name":"Enter New Tab Name","Input_new_tab_name":"Enter new tab name","INPUT_NEW_TAB_NAME":"ENTER NEW TAB NAME","input_new_tab_name":"enter new tab name","Title":"Title","TITLE":"TITLE","title":"title","Type":"Type","TYPE":"TYPE","type":"type","Numeric":"Numeric","NUMERIC":"NUMERIC","numeric":"numeric","Counter":"Counter","COUNTER":"COUNTER","counter":"counter","Boolean":"Boolean","BOOLEAN":"BOOLEAN","boolean":"boolean","Time":"Time","TIME":"TIME","time":"time","Timer":"Stopwatch","TIMER":"STOPWATCH","timer":"stopwatch","Description":"Description","DESCRIPTION":"DESCRIPTION","description":"description","Unit":"Unit of measurement","UNIT":"UNIT OF MEASUREMENT","unit":"unit of measurement","Aggregate_Function":"Aggregate Function","Aggregate_function":"Aggregate function","AGGREGATE_FUNCTION":"AGGREGATE FUNCTION","aggregate_function":"aggregate function","None_Function":"None","None_function":"None","NONE_FUNCTION":"NONE","none_function":"none","Summation":"Summation","SUMMATION":"SUMMATION","summation":"summation","Average":"Average","AVERAGE":"AVERAGE","average":"average","Maximim":"Maximum","MAXIMIM":"MAXIMUM","maximim":"maximum","Minimum":"Minimum","MINIMUM":"MINIMUM","minimum":"minimum","Item_Icon":"Item Icon","Item_icon":"Item icon","ITEM_ICON":"ITEM ICON","item_icon":"item icon","Yes_Icon":"&laquo;yes&raquo; Icon","Yes_icon":"&laquo;Yes&raquo; icon","YES_ICON":"&LAQUO;YES&RAQUO; ICON","yes_icon":"&laquo;Yes&raquo; icon","No_Icon":"&laquo;no&raquo; Icon","No_icon":"&laquo;No&raquo; icon","NO_ICON":"&LAQUO;NO&RAQUO; ICON","no_icon":"&laquo;No&raquo; icon","Zero_Icon":"&laquo;zero&raquo; Icon","Zero_icon":"&laquo;Zero&raquo; icon","ZERO_ICON":"&LAQUO;ZERO&RAQUO; ICON","zero_icon":"&laquo;Zero&raquo; icon","Set":"Set","SET":"SET","set":"set","Week":"Week","WEEK":"WEEK","week":"week","Month":"Month","MONTH":"MONTH","month":"month","Past":"Past","PAST":"PAST","past":"past","Plan":"Plan","PLAN":"PLAN","plan":"plan","Input_Plan_Week":"Input Planned Value For This Week","Input_plan_week":"Input planned value for this week","INPUT_PLAN_WEEK":"INPUT PLANNED VALUE FOR THIS WEEK","input_plan_week":"Input planned value for this week","Input_Plan_Month":"Input Planned Value For This Month","Input_plan_month":"Input planned value for this month","INPUT_PLAN_MONTH":"INPUT PLANNED VALUE FOR THIS MONTH","input_plan_month":"Input planned value for this month","Date":"Date","DATE":"DATE","date":"date","Value":"Value","VALUE":"VALUE","value":"value","Planned":"Planned","PLANNED":"PLANNED","planned":"planned","Set_Date":"Set Date","Set_date":"Set date","SET_DATE":"SET DATE","set_date":"set date","Input_Value":"Input Value","Input_value":"Input value","INPUT_VALUE":"INPUT VALUE","input_value":"input value","Etc":"Etc.","ETC":"ETC.","etc":"etc.","Or":"Or","OR":"OR","or":"or","_Yes":"Yes","_yes":"yes","_YES":"YES","_No":"No","_no":"no","_NO":"NO","Eg":"Eg","EG":"EG","eg":"eg","Min":"Min","MIN":"MIN","min":"min","Unit_Example":"For Example: Km, $, M<Sup>2<\/sup>","Unit_example":"For example: km, $, m<sup>2<\/sup>","UNIT_EXAMPLE":"FOR EXAMPLE: KM, $, M<SUP>2<\/SUP>","unit_example":"for example: km, $, m<sup>2<\/sup>","Prepend_Hint":"Should Be In Front (As For <U>$<\/u>100 Vs. 100<U>Miles<\/u>)","Prepend_hint":"Should be in front (as for <u>$<\/u>100 vs. 100<u>miles<\/u>)","PREPEND_HINT":"SHOULD BE IN FRONT (AS FOR <U>$<\/U>100 VS. 100<U>MILES<\/U>)","prepend_hint":"should be in front (as for <u>$<\/u>100 vs. 100<u>miles<\/u>)","You_May_Also":"You May Also","You_may_also":"You may also","YOU_MAY_ALSO":"YOU MAY ALSO","you_may_also":"you may also","Archive_Goal":"Archive","Archive_goal":"Archive","ARCHIVE_GOAL":"ARCHIVE","archive_goal":"archive","This_Goal":"This Goal","This_goal":"This goal","THIS_GOAL":"THIS GOAL","this_goal":"this goal","Pick_Template_Info":"Here Is A List Of Templates For The Most Popular Goals. To Add A Template To Your Goals, Click On Its Title And Press 'add To Your Goals' Button. You Can Change Icons And Perform Other Customization Of The Goal After You Have Added It.","Pick_template_info":"Here is a list of templates for the most popular goals. To add a template to your goals, click on its title and press 'Add to your goals' button. You can change icons and perform other customization of the goal after you have added it.","PICK_TEMPLATE_INFO":"HERE IS A LIST OF TEMPLATES FOR THE MOST POPULAR GOALS. TO ADD A TEMPLATE TO YOUR GOALS, CLICK ON ITS TITLE AND PRESS 'ADD TO YOUR GOALS' BUTTON. YOU CAN CHANGE ICONS AND PERFORM OTHER CUSTOMIZATION OF THE GOAL AFTER YOU HAVE ADDED IT.","pick_template_info":"Here is a list of templates for the most popular goals. To add a template to your goals, click on its title and press 'Add to your goals' button. You can change icons and perform other customization of the goal after you have added it.","Goal_Type_Info":"The Type Of A Goal Is Determined By The Kind Of Information You Would Like To Store.","Goal_type_info":"The type of a goal is determined by the kind of information you would like to store.","GOAL_TYPE_INFO":"THE TYPE OF A GOAL IS DETERMINED BY THE KIND OF INFORMATION YOU WOULD LIKE TO STORE.","goal_type_info":"The type of a goal is determined by the kind of information you would like to store.","Numeric_Type_Hint":"For Information Such As Amount Of <Strong>Money<\/strong> Or Number Of <Strong>Miles<\/strong>, Choose <Strong>Numeric<\/strong> Type.","Numeric_type_hint":"For information such as amount of <strong>money<\/strong> or number of <strong>miles<\/strong>, choose <strong>numeric<\/strong> type.","NUMERIC_TYPE_HINT":"FOR INFORMATION SUCH AS AMOUNT OF <STRONG>MONEY<\/STRONG> OR NUMBER OF <STRONG>MILES<\/STRONG>, CHOOSE <STRONG>NUMERIC<\/STRONG> TYPE.","numeric_type_hint":"For information such as amount of <strong>money<\/strong> or number of <strong>miles<\/strong>, choose <strong>numeric<\/strong> type.","Counter_Type_Hint":"If You Want To Count Items, Such As <Strong>Number Of Push-Ups<\/strong> Or <Strong>Cups Of Coffee<\/strong>, Choose <Strong>Counter<\/strong>.","Counter_type_hint":"If you want to count items, such as <strong>number of push-ups<\/strong> or <strong>cups of coffee<\/strong>, choose <strong>counter<\/strong>.","COUNTER_TYPE_HINT":"IF YOU WANT TO COUNT ITEMS, SUCH AS <STRONG>NUMBER OF PUSH-UPS<\/STRONG> OR <STRONG>CUPS OF COFFEE<\/STRONG>, CHOOSE <STRONG>COUNTER<\/STRONG>.","counter_type_hint":"If you want to count items, such as <strong>number of push-ups<\/strong> or <strong>cups of coffee<\/strong>, choose <strong>counter<\/strong>.","Boolean_Type_Hint":"For '<Strong>Yes Or No<\/strong>' Questions, Such As 'did I Work Well Today?' Or 'have I Read A Book?', Choose <Strong>Boolean<\/strong>.","Boolean_type_hint":"For '<strong>yes or no<\/strong>' questions, such as 'Did I work well today?' or 'Have I read a book?', choose <strong>boolean<\/strong>.","BOOLEAN_TYPE_HINT":"FOR '<STRONG>YES OR NO<\/STRONG>' QUESTIONS, SUCH AS 'DID I WORK WELL TODAY?' OR 'HAVE I READ A BOOK?', CHOOSE <STRONG>BOOLEAN<\/STRONG>.","boolean_type_hint":"For '<strong>yes or no<\/strong>' questions, such as 'Did I work well today?' or 'Have I read a book?', choose <strong>boolean<\/strong>.","Time_Type_Hint":"To Log A Time Of An Event, Such As When You Wake Up, Select <Strong>Time<\/strong> Type.","Time_type_hint":"To log a time of an event, such as when you wake up, select <strong>time<\/strong> type.","TIME_TYPE_HINT":"TO LOG A TIME OF AN EVENT, SUCH AS WHEN YOU WAKE UP, SELECT <STRONG>TIME<\/STRONG> TYPE.","time_type_hint":"To log a time of an event, such as when you wake up, select <strong>time<\/strong> type.","Timer_Type_Hint":"<Strong>Stopwatch<\/strong> Allows You To Record Periods Of Time, E.g. 'how Long Have I Been Working Today?'. You Can Launch A Stopwatch Or Enter Time Manually.","Timer_type_hint":"<strong>Stopwatch<\/strong> allows you to record periods of time, e.g. 'How long have I been working today?'. You can launch a stopwatch or enter time manually.","TIMER_TYPE_HINT":"<STRONG>STOPWATCH<\/STRONG> ALLOWS YOU TO RECORD PERIODS OF TIME, E.G. 'HOW LONG HAVE I BEEN WORKING TODAY?'. YOU CAN LAUNCH A STOPWATCH OR ENTER TIME MANUALLY.","timer_type_hint":"<strong>Stopwatch<\/strong> allows you to record periods of time, e.g. 'How long have I been working today?'. You can launch a stopwatch or enter time manually.","Item_Icon_Hint":"This Icon Depicts An Item That You Keep Count. To Add An Item, Click On The Cell And One Icon Will Be Added. To Remove An Item, Click On The Icon.","Item_icon_hint":"This icon depicts an item that you keep count. To add an item, click on the cell and one icon will be added. To remove an item, click on the icon.","ITEM_ICON_HINT":"THIS ICON DEPICTS AN ITEM THAT YOU KEEP COUNT. TO ADD AN ITEM, CLICK ON THE CELL AND ONE ICON WILL BE ADDED. TO REMOVE AN ITEM, CLICK ON THE ICON.","item_icon_hint":"This icon depicts an item that you keep count. To add an item, click on the cell and one icon will be added. To remove an item, click on the icon.","Yes_Icon_Hint":"This Icon Depicts A Positive Answer. Depending On The Goal Title It May Have A Positive Or A Negative Meaning. In Case Of 'work Productivity' It Has A Positive Meaning, While In Case Of 'car Malfunctioning' It Has A Negative Meaning.","Yes_icon_hint":"This icon depicts a positive answer. Depending on the goal title it may have a positive or a negative meaning. In case of 'Work productivity' it has a positive meaning, while in case of 'Car malfunctioning' it has a negative meaning.","YES_ICON_HINT":"THIS ICON DEPICTS A POSITIVE ANSWER. DEPENDING ON THE GOAL TITLE IT MAY HAVE A POSITIVE OR A NEGATIVE MEANING. IN CASE OF 'WORK PRODUCTIVITY' IT HAS A POSITIVE MEANING, WHILE IN CASE OF 'CAR MALFUNCTIONING' IT HAS A NEGATIVE MEANING.","yes_icon_hint":"This icon depicts a positive answer. Depending on the goal title it may have a positive or a negative meaning. In case of 'Work productivity' it has a positive meaning, while in case of 'Car malfunctioning' it has a negative meaning.","No_Icon_Hint":"This Icon Depicts A Negative Answer.","No_icon_hint":"This icon depicts a negative answer.","NO_ICON_HINT":"THIS ICON DEPICTS A NEGATIVE ANSWER.","no_icon_hint":"This icon depicts a negative answer.","Unit_Hint":"What Your Data Is Measured With. For Example: Km, $, M<Sup>2<\/sup>.","Unit_hint":"What your data is measured with. For example: km, $, m<sup>2<\/sup>.","UNIT_HINT":"WHAT YOUR DATA IS MEASURED WITH. FOR EXAMPLE: KM, $, M<SUP>2<\/SUP>.","unit_hint":"What your data is measured with. For example: km, $, m<sup>2<\/sup>.","Aggregate_Hint":"We Use The Aggregate Function To Sum Up The Results Over A Period Of Time. This Option Affects The Value In The Right Part Of The Table And The Values Depicted In Graphs.","Aggregate_hint":"We use the aggregate function to sum up the results over a period of time. This option affects the value in the right part of the table and the values depicted in graphs.","AGGREGATE_HINT":"WE USE THE AGGREGATE FUNCTION TO SUM UP THE RESULTS OVER A PERIOD OF TIME. THIS OPTION AFFECTS THE VALUE IN THE RIGHT PART OF THE TABLE AND THE VALUES DEPICTED IN GRAPHS.","aggregate_hint":"We use the aggregate function to sum up the results over a period of time. This option affects the value in the right part of the table and the values depicted in graphs.","Show_The_Last_Value":"Show The Last Value","Show_the_last_value":"Show the last value","SHOW_THE_LAST_VALUE":"SHOW THE LAST VALUE","show_the_last_value":"show the last value","Planning_Info":"Here You Can Add A Plan For Your Goal. For Example, You Can Put How Many Miles You Plan To Run By The End Of The Month Or Set A Limit Of Your Expenses.","Planning_info":"Here you can add a plan for your goal. For example, you can put how many miles you plan to run by the end of the month or set a limit of your expenses.","PLANNING_INFO":"HERE YOU CAN ADD A PLAN FOR YOUR GOAL. FOR EXAMPLE, YOU CAN PUT HOW MANY MILES YOU PLAN TO RUN BY THE END OF THE MONTH OR SET A LIMIT OF YOUR EXPENSES.","planning_info":"Here you can add a plan for your goal. For example, you can put how many miles you plan to run by the end of the month or set a limit of your expenses.","Planning_Hint":"To Add A New Value, Click On 'add A Value'. To Edit Added Value Click On A Row. All The Information Will Be Saved Automatically When You Add Or Modify It.","Planning_hint":"To add a new value, click on 'add a value'. To edit added value click on a row. All the information will be saved automatically when you add or modify it.","PLANNING_HINT":"TO ADD A NEW VALUE, CLICK ON 'ADD A VALUE'. TO EDIT ADDED VALUE CLICK ON A ROW. ALL THE INFORMATION WILL BE SAVED AUTOMATICALLY WHEN YOU ADD OR MODIFY IT.","planning_hint":"To add a new value, click on 'add a value'. To edit added value click on a row. All the information will be saved automatically when you add or modify it.","Done_Planning":"I Am Done Planning","Done_planning":"I am done planning","DONE_PLANNING":"I AM DONE PLANNING","done_planning":"I am done planning","Share_Chart":"You Can Share Your Chart With Friends","Share_chart":"You can share your chart with friends","SHARE_CHART":"YOU CAN SHARE YOUR CHART WITH FRIENDS","share_chart":"You can share your chart with friends","Obtain_Code":"Obtain The Code","Obtain_code":"Obtain the code","OBTAIN_CODE":"OBTAIN THE CODE","obtain_code":"obtain the code","Back_To_Week_View":"Back To The Week View","Back_to_week_view":"Back to the week view","BACK_TO_WEEK_VIEW":"BACK TO THE WEEK VIEW","back_to_week_view":"back to the week view","Link_To_Chart_Page":"Link To Your Chart Page","Link_to_chart_page":"Link to your chart page","LINK_TO_CHART_PAGE":"LINK TO YOUR CHART PAGE","link_to_chart_page":"Link to your chart page","Embed_Chart_Code":"Embed This Code In Your Blog","Embed_chart_code":"Embed this code in your blog","EMBED_CHART_CODE":"EMBED THIS CODE IN YOUR BLOG","embed_chart_code":"Embed this code in your blog","Post_Chart":"Share In Your Favorite Network","Post_chart":"Share in your favorite network","POST_CHART":"SHARE IN YOUR FAVORITE NETWORK","post_chart":"Share in your favorite network","Period":"Period","PERIOD":"PERIOD","period":"period","Group_By":"Group By","Group_by":"Group by","GROUP_BY":"GROUP BY","group_by":"group by","Chart_Line":"Line","Chart_line":"Line","CHART_LINE":"LINE","chart_line":"line","Chart_Column":"Column","Chart_column":"Column","CHART_COLUMN":"COLUMN","chart_column":"column","Chart_Pie":"Pie","Chart_pie":"Pie","CHART_PIE":"PIE","chart_pie":"pie","Week_Days":"Week Days","Week_days":"Week days","WEEK_DAYS":"WEEK DAYS","week_days":"week days","Day":"Day","DAY":"DAY","day":"day","Quarter":"Quarter","QUARTER":"QUARTER","quarter":"quarter","Year":"Year","YEAR":"YEAR","year":"year","All_Time":"All Time","All_time":"All time","ALL_TIME":"ALL TIME","all_time":"all time","Accumulate_Values":"Accumulate Values","Accumulate_values":"Accumulate values","ACCUMULATE_VALUES":"ACCUMULATE VALUES","accumulate_values":"accumulate values","Interpolate_Line":"Interpolate Line","Interpolate_line":"Interpolate line","INTERPOLATE_LINE":"INTERPOLATE LINE","interpolate_line":"interpolate line","Fill_Empty_Values":"Fill Empty Values","Fill_empty_values":"Fill empty values","FILL_EMPTY_VALUES":"FILL EMPTY VALUES","fill_empty_values":"fill empty values","Save_Chart":"Save Chart","Save_chart":"Save chart","SAVE_CHART":"SAVE CHART","save_chart":"save chart","Set_Title":"Set Title","Set_title":"Set title","SET_TITLE":"SET TITLE","set_title":"set title","Choose_Chart_Type":"Choose Chart Type","Choose_chart_type":"Choose chart type","CHOOSE_CHART_TYPE":"CHOOSE CHART TYPE","choose_chart_type":"choose chart type","Choose_Goal_And_Type":"Choose Goal And Type","Choose_goal_and_type":"Choose goal and type","CHOOSE_GOAL_AND_TYPE":"CHOOSE GOAL AND TYPE","choose_goal_and_type":"choose goal and type","Choose_Period_And_Group":"Choose Period And Group","Choose_period_and_group":"Choose period and group","CHOOSE_PERIOD_AND_GROUP":"CHOOSE PERIOD AND GROUP","choose_period_and_group":"choose period and group","Additional_Options":"Additional Options","Additional_options":"Additional options","ADDITIONAL_OPTIONS":"ADDITIONAL OPTIONS","additional_options":"additional options","No_Archived_Goals":"No Archived Goals. To Archive A Goal Click On The Goal's Name And Choose &quot;archive&quot; In The Appeared Form.","No_archived_goals":"No archived goals. To archive a goal click on the goal's name and choose &quot;archive&quot; in the appeared form.","NO_ARCHIVED_GOALS":"NO ARCHIVED GOALS. TO ARCHIVE A GOAL CLICK ON THE GOAL'S NAME AND CHOOSE &QUOT;ARCHIVE&QUOT; IN THE APPEARED FORM.","no_archived_goals":"No archived goals. To archive a goal click on the goal's name and choose &quot;archive&quot; in the appeared form.","Error_Empty_Title":"Input Title","Error_empty_title":"Input title","ERROR_EMPTY_TITLE":"INPUT TITLE","error_empty_title":"input title"})
window.TemplatesPick=Mohawk.UI.OrderedList.extend({active:null,createNode:function(data){var node=parent.createNode(data);node.setHTML('');var title=DOM.element('H2');node.appendChild(title);var icon=DOM.element('IMG');if(data.type=='boolean'){icon.src=Data.icons[data.icon_true];}else if(data.type=='counter'){icon.src=Data.icons[data.icon_item];}else if(data.type=='numeric'){icon.src=URL.img+'icons/number.png';}else if(data.type=='time'){icon.src=URL.img+'icons/time.png';}else if(data.type=='timer'){icon.src=URL.img+'icons/stopwatch.png';}else{icon.src=URL.img+'icons/loading.png';}
title.insertFirst(icon);var span=DOM.element('SPAN');span.setHTML(data.title);title.appendChild(span);var text=DOM.element('DIV');text.addClass('text','hidden');var html=data.preview;html=nl2br(html);text.setHTML('<p>'+html+'</p>');node.appendChild(text);span.onclick=function(){if(text.hasClass('hidden')){if(self.active){Effects.fold(self.active,function(){self.active.addClass('hidden');text.removeClass('hidden');Effects.unfold(text);self.active=text;});}else{text.removeClass('hidden');Effects.unfold(text);self.active=text;}}else{Effects.fold(text,function(){text.addClass('hidden');self.active=null;});}};var button=DOM.element('BUTTON',{type:'button'});if(data.type!='timer'||ENV.user.valid){button.setHTML(LNG.Add_this_template);button.onclick=function(){var goal=Object.clone(data);goal.id='';goal.tab=ENV.tab;goal.template=data.id;goal.position=(Goals.Table.table.tBodies[0].childNodes.length?parseInt(Goals.Table.table.tBodies[0].lastChild.data.position):0)+1;Goals.add(goal);return false;};}else{button.setHTML('<img src="'+URL.img+'site/premium.png" alt="*" /> '+LNG.Add_this_template);button.onclick=show_premium;}
text.appendChild(button);return node;}});window.CategoriesPick=Mohawk.UI.OrderedList.extend({active:null,createNode:function(data){var node=parent.createNode(data);node.purgeChildren();var title=DOM.element('H2',{appendTo:node});var span=DOM.element('SPAN',{innerHTML:data.title,appendTo:title});var templates=[];foreach(Data.templates,function(i,template){if(template.category==data.id){templates.push(template);}});node.Templates=new TemplatesPick('templates-'+node.id,templates);var list=node.Templates.element;list.addClass('hidden');node.appendChild(list);span.onclick=function(){if(list.hasClass('hidden')){if(self.active){Effects.fold(self.active,function(){self.active.addClass('hidden');list.removeClass('hidden');Effects.unfold(list);self.active=list;});}else{list.removeClass('hidden');Effects.unfold(list);self.active=list;}}else{Effects.fold(list,function(){list.addClass('hidden');self.active=null;});}};return node;}});Mohawk.UI.SelectableList=Mohawk.UI.List.extend(Mohawk.UI.SelectableListInterface={selected:[],last_selected:null,last_click:null,multiple:true,__construct:function(id,structure){parent.__construct(id,structure);Mohawk.UI.selectables.push(self);self.EVENT_SELECTED=self.id+'-selected';self.element.onmousedown=function(){return false;};},createNode:function(data){var node=parent.createNode(data);node.select=function(){node.addClass('selected');if(!node.isSelected()){self.selected.push(node);}};node.unselect=function(){node.removeClass('selected');Array.remove(self.selected,node);};node.isSelected=function(){return Array.find(self.selected,node)!==false;};node.onclick=function(event){event=DOM.event(event);if(IE?event.button==0:event.button==BTN_LEFT){if(node.isSelected()&&!event.ctrlKey){self.select(event,node);}
if(node.ondblclick instanceof Function){var now=new Date;if(node.last_click instanceof Date&&!OPERA){if(now.getTime()-node.last_click.getTime()<1000){node.ondblclick();}}
node.last_click=now;}
event.stopPropagation();self.select(event,node);}};return node;},select:function(event,node,silently){event=DOM.event(event);if(event.ctrlKey&&self.multiple){if(Array.find(self.selected,node)!==false){node.unselect();}else{node.select();self.last_selected=node;}}else if((event.shiftKey&&self.last_selected&&self.multiple)||Mohawk.UI.selection){if(Mohawk.UI.selection&&!self.last_selected){self.last_selected=node;}
var last=0;var cur=0;for(var i=0;i<self.element.childNodes.length;i++){if(self.element.childNodes[i]==self.last_selected){last=i;}
if(self.element.childNodes[i]==node){cur=i;}
if(cur&&last){break;}}
while(self.selected.length){self.selected[0].unselect();}
if(cur>last){for(var i=last;i<cur;i++){self.element.childNodes[i].select();}}else{for(var i=cur;i<=last;i++){self.element.childNodes[i].select();}}
if(!node.isSelected()){node.select();}}else{self.unselectAll();node.select();self.last_selected=node;}
if(!silently){Observer.fire(self.EVENT_SELECTED);}},unselectAll:function(){while(self.selected.length){self.selected[0].unselect();}
self.last_selected=null;},isSelected:function(node){return Array.find(self.selected,node)!==false;},setSelected:function(id){self.select({},self.getNode(id),true);},getSelected:function(){return self.selected.length?self.selected[0].data.id:false;}});window.IconList=Mohawk.UI.SelectableList.extend({multiple:false,__construct:function(id,data){parent.__construct(id,data);self.element.addClass('icon-list');self.selected=[];},createNode:function(data){var node=parent.createNode(data);node.setHTML('');var icon=DOM.element('IMG');icon.src=data.src;node.appendChild(icon);return node;},getSelected:function(){var data=null;if(self.selected.length){data=self.selected[0].data.id;}
return data;},setSelected:function(id){self.unselectAll();var node=self.getNode(id);if(node){node.select();}}});window.IconFinderApi=new Class({List:null,initSearch:function(input){clearTimeout(self.search_timeout);self.search_timeout=setTimeout(function(){self.search(input.value);},1000);},search:function(q,p){p=p||0;var req=new Ajax(URL.home+'api/iconfinder/');req.responseHandler=function(req){try{var icons=req.data.iconmatches.icon;if(icons.id){icons=[icons];}
var data=[];foreach(icons,function(i,icon){data.push({id:'if-'+icon.id,src:unescape(icon.image)});});if(!p){self.List.setChildren(data);}else{foreach(data,function(i,icon){self.List.addNode(icon);});}
self.List.element.removeClass('hidden');var link=DOM.element('A');link.href='#more';link.addClass('script');link.onclick=function(){self.search(q,p+1);return false;};link.setHTML(LNG.Search_more);self.Message.setHTML('');self.Message.appendChild(link);self.Message.appendChild(DOM.text(' ('+LNG.powered_by_iconfinder+')'));}catch(e){self.Message.setHTML(LNG.Nothing_found);}};req.errorHandler=function(req){Progress.done('Error');};req.send({q:q,p:p});if(!p){self.List.element.addClass('hidden');}
self.Message.removeClass('hidden');self.Message.setHTML(LNG.Searching+'...');}});window.IconPick=new Class({__construct:function(icons){var element=DOM.element('DIV');element.addClass('icon-pick');self.element=element;self.icons=icons;var input=FormsInterface.createInput('text','q',LNG.search+'...');input.onchange=function(){if(!this.value.length){self.setDefault();}};input.title=LNG.search+'...';input.addClass('empty');input.onfocus=function(){if(this.value==this.title){this.value='';}
this.removeClass('empty');};input.onblur=function(){if(this.value==''){this.value=this.title;this.addClass('empty');}};input.onkeydown=function(event){event=DOM.event(event);if(event.key()==13){return false;}};input.onkeyup=function(){self.IconFinder.initSearch(this);};input.value=input.title;self.input=input;element.appendChild(input);var hint=DOM.element('P');hint.addClass('hint');hint.setHTML(LNG.Icon_search_hint);element.appendChild(hint);self.IconList=new IconList('icon-list',icons);Observer.add(self.IconList.EVENT_SELECTED,function(){if(!self.IconList.selected.length){return;}
var data=self.IconList.selected[0].data;self.Picker.setData(data.id.match('^if-')?data.src:data.id);self.hide();});element.appendChild(self.IconList.element);self.message=DOM.element('P');self.message.addClass('message','hidden');element.appendChild(self.message);self.IconFinder=new IconFinderApi();self.IconFinder.List=self.IconList;self.IconFinder.Message=self.message;},setDefault:function(){self.message.addClass('hidden');self.IconList.setChildren(self.icons);},set:function(picker){if(self.Picker){self.Picker.link.setHTML(LNG.Pick_icon);}
self.Picker=picker;if(self.Picker){self.Picker.link.setHTML(LNG.Hide_ok);}
var node=self.IconList.getNode(picker.data);if(node){self.IconList.select({},node);}else{self.IconList.unselectAll();self.setDefault();self.input.value='';setTimeout(function(){self.input.focus();});}},hide:function(){if(self.Picker){self.Picker.link.setHTML(LNG.Pick_icon);}
self.Picker=null;self.element.remove();}});window.IconPicker=new Class({Pick:null,data:null,__construct:function(Pick){self.Pick=Pick;self.element=DOM.element('DIV');self.element.addClass('icon-picker');self.element.onclick=function(){self.Pick.set(self);self.element.parentNode.insertAfter(self.Pick.element,self.element);};self.img=DOM.element('IMG');self.element.appendChild(self.img);var link=DOM.element('A');link.href='#icon-pick';link.addClass('script');link.setHTML(LNG.Pick_icon);link.onclick=function(){if(self.Pick.Picker===self){setTimeout(function(){self.Pick.hide();});}else{self.Pick.set(self);}
return false;};self.element.appendChild(link);self.link=link;},setData:function(data){self.data=data;if(data&&data!='0'){self.img.src=Data.icons[data]!==undefined?Data.icons[data]:data;}else{self.img.src=URL.img+'icons/loading.png';}}});window.GoalsPage=new Class({element:null,__construct:function(){self.element=self.createForm();ID('goals-wrapper').appendChild(self.element);self.element.addClass('hidden');var icons=[];foreach(Data.icons,function(i,val){icons.push({id:i,src:val});});self.IconPick=new IconPick(icons);self.IconItem=new IconPicker(self.IconPick);self.element.getElementsByClassName('goals-icon-item')[0].replace(self.IconItem.element);self.IconZero=new IconPicker(self.IconPick);self.IconTrue=new IconPicker(self.IconPick);self.element.getElementsByClassName('goals-icon-true')[0].replace(self.IconTrue.element);self.IconFalse=new IconPicker(self.IconPick);self.element.getElementsByClassName('goals-icon-false')[0].replace(self.IconFalse.element);},createForm:function(){var form=DOM.element('FORM');form.addClass('goals-form');form.object=self;form.onmousedown=DOM.stopEvent;form.onsubmit=function(){self.save.apply(self,[form]);return false;};return form;},save:function(form){foreach(form.getElementsByClassName('error'),function(){this.remove();});var data=form.getData();data.icon_item=self.IconItem.data;data.icon_zero=self.IconZero.data;data.icon_true=self.IconTrue.data;data.icon_false=self.IconFalse.data;data.prepend=data.prepend||'no';Observer.fire('form-submitted',data);},setData:function(){self.element.removeClass('hidden');self.element.setData({'id':''});self.element.reset();self.element.getElementsByClassName('additional-parameters')[0].addClass('hidden');Observer.fire(self.EVENT_SET);},hide:function(silently){self.element.addClass('hidden');if(!silently){Observer.fire(self.EVENT_HIDDEN);}},setType:function(type){var fields=self.element.getElementsByTagName('LI');for(var i=0;i<fields.length;i++){if(!fields[i].hasClass('type')){continue;}
if(type&&fields[i].hasClass(type)){fields[i].removeClass('hidden');}else{fields[i].addClass('hidden');}}}});Mohawk.UI.Tabset=new Class({element:null,current:null,tabs:[],__construct:function(tabs,attributes){self.element=document.createElement('DL');if(!IE&&attributes&&attributes.length){for(var i=0;i<attributes.length;i++){self.element.setAttribute(attributes[i].nodeName,attributes[i].nodeValue);}}
self.element.addClass.call(self.element,'tabset');self.element.object=self;var max_height=0;self.tabs=[];for(var i=0;i<tabs.length;i++){var tab={title:self.createTabTitle(i,tabs[i].title),content:self.createTabContent(i,tabs[i].content)};self.tabs.push(tab);if(i){self.element.insertBefore(tab.title,self.tabs[i-1].title.nextTag('DD'));}else{self.element.appendChild(tab.title);}
self.element.appendChild(tab.content);tab.content.collapse();}
self.tabs[0].title.open();},createTabTitle:function(index,title){var node=document.createElement('DT');node.setHTML(title);node.addClass('tab');node.data={index:index,title:title};node.getContent=function(){return self.tabs[node.data.index].content;};node.onclick=function(){node.open();};node.open=function(){if(self.current){self.current.close();}
self.current=node;node.addClass('active');node.getContent().display();};node.close=function(){node.removeClass('active');node.getContent().collapse();};return node;},createTabContent:function(index,content){var node=document.createElement('DD');node.setHTML(content);node.addClass('tab');node.data={index:index,content:content};node.getTitle=function(){return self.tabs[node.data.index].title;};return node;}});Mohawk.UI.Tabset.fromElement=function(element){var tabs=[];var last_dt=0;var last_dd=0;for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].tagName){switch(element.childNodes[i].tagName.toUpperCase()){case'DT':if(!tabs[last_dt]){tabs[last_dt]={};}
tabs[last_dt].title=element.childNodes[i].innerHTML;last_dt++;break;case'DD':if(!tabs[last_dd]){tabs[last_dd]={};}
tabs[last_dd].content=element.childNodes[i].innerHTML;last_dd++;break;}}}
var tabset=new Mohawk.UI.Tabset(tabs,element.attributes);return tabset;};window.GoalsPageAdd=GoalsPage.extend({createForm:function(){var form=parent.createForm();form.id='goals-form-add';self.EVENT_SET=form.id+'-set';self.EVENT_HIDDEN=form.id+'-hidden';window.GOALS_FORM_ADD="<img id=\"goals-form-close\" src=\"{%URL.img}site/chart-close.png\" onclick=\"Goals.Add.hide(); return false;\" />"+"\n<fieldset>"+"\n    <dl>"+"\n        <dt>{%LNG.Pick_template}</dt>"+"\n        <dd>"+"\n            <p class=\"info\">"+"\n                {%LNG.Pick_template_info}"+"\n            </p>"+"\n            "+"\n            <div id=\"categories-pick\" class=\"categories-pick\">{%LNG.Loading_templates}...</div>"+"\n        </dd>"+"\n        <dt>{%LNG.Advanced_mode}</dt>"+"\n        <dd>"+"\n            <fieldset>"+"\n                <input type=\"hidden\" name=\"id\" />"+"\n                <ul class=\"fields\">"+"\n                    <li>"+"\n                        <label class=\"block\">{%LNG.Title}</label>"+"\n                        <input name=\"title\" class=\"text\" />"+"\n                    </li>"+"\n                    <li class=\"clearfix\">"+"\n                        <label class=\"block\">{%LNG.Type}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Goal_type_info}</p>"+"\n                            <ul>"+"\n                                <li>{%LNG.Numeric_type_hint}</li>"+"\n                                <li>{%LNG.Counter_type_hint}</li>"+"\n                                <li>{%LNG.Boolean_type_hint}</li>"+"\n                                <li>{%LNG.Time_type_hint}</li>"+"\n                                <li>{%LNG.Timer_type_hint}</li>"+"\n                            </ul>"+"\n                        </blockquote>"+"\n                        <ul class=\"fields\">"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-type-numeric\" name=\"type\" value=\"numeric\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"add-type-numeric\">{%LNG.numeric}: <i class=\"ex\">3.14, 100, 299792, {%LNG.etc}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-type-counter\" name=\"type\" value=\"counter\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"add-type-counter\">{%LNG.counter}: <i class=\"ex\">1, 2, 3 ...</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-type-boolean\" name=\"type\" value=\"boolean\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"add-type-boolean\">{%LNG.boolean}: <i class=\"ex\">{%LNG._yes} {%LNG.or} {%LNG._no}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-type-time\" name=\"type\" value=\"time\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"add-type-time\">{%LNG.time}: <i class=\"ex\">7:30</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                            {%if ENV.user.valid}"+"\n                                <input type=\"radio\" id=\"add-type-timer\" name=\"type\" value=\"timer\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"add-type-timer\">{%LNG.timer}: <i class=\"ex\">&#9656;7:30</i></label>"+"\n                            {%else}"+"\n                                <a href=\"{%URL.home}premium/\" onclick=\"return show_premium();\" class=\"premium\">"+"\n                                    <img src=\"{%URL.img}site/premium.png\" alt=\"*\" title=\"Premium feature\" />"+"\n                                </a>"+"\n                                <label for=\"add-type-timer\">{%LNG.timer}: <i class=\"ex\">&#9656;7:30</i></label>"+"\n                            {%end}"+"\n                            </li>"+"\n                        </ul>"+"\n                    </li>"+"\n                    <li class=\"type counter\">"+"\n                        <label class=\"block\">{%LNG.Item_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Item_icon_hint}</p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-item\"></div>"+"\n                    </li>"+"\n                    <li class=\"type boolean\">"+"\n                        <label class=\"block\">{%LNG.Yes_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>"+"\n                                {%LNG.Yes_icon_hint}"+"\n                            </p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-true\"></div>"+"\n                    </li>"+"\n                    <li class=\"type boolean\">"+"\n                        <label class=\"block\">{%LNG.No_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.No_icon_hint}</p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-false\"></div>"+"\n                    </li>"+"\n                </ul>"+"\n                <p class=\"additional-parameters-toggler\"><a href=\"#additional-parameters\" class=\"script\" onclick=\"this.parentNode.nextTag('UL').flipClass('hidden'); return false;\">{%LNG.Additional_parameters}</a> &darr;</p>"+"\n                <ul class=\"fields additional-parameters\">"+"\n                    <li>"+"\n                        <label class=\"block\">{%LNG.Description}</label>"+"\n                        <textarea name=\"text\"></textarea>"+"\n                    </li>"+"\n                    <li class=\"type numeric counter\">"+"\n                        <label class=\"block\">{%LNG.Unit}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Unit_hint}</p>"+"\n                        </blockquote>"+"\n                        <input type=\"text\" name=\"unit\" class=\"text\" />"+"\n                        <br />"+"\n                        <input type=\"checkbox\" id=\"add-prepend\" name=\"prepend\" value=\"yes\" />"+"\n                        <label for=\"add-prepend\">{%LNG.prepend_hint}</label>"+"\n                    </li>"+"\n                    <li class=\"type numeric counter time timer\">"+"\n                        <label class=\"block\">{%LNG.Aggregate_function}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Aggregate_hint}</p>"+"\n                        </blockquote>"+"\n                        <ul class=\"fields\">"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-none\" name=\"aggregate\" value=\"\" />"+"\n                                <label for=\"add-function-none\">{%LNG.none_function}: <i class=\"ex\">{%LNG.show_the_last_value}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-sum\" name=\"aggregate\" value=\"sum\" />"+"\n                                <label for=\"add-function-sum\">{%LNG.summation}: <i class=\"ex\">1 + 2 + 3 = 6</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-avg\" name=\"aggregate\" value=\"avg\" />"+"\n                                <label for=\"add-function-avg\">{%LNG.average}: <i class=\"ex\">(1 + 2 + 3) / 3 = 2</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-max\" name=\"aggregate\" value=\"max\" />"+"\n                                <label for=\"add-function-max\">{%LNG.maximim}: <i class=\"ex\">max(1, 2, 3) = 3</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-min\" name=\"aggregate\" value=\"min\" />"+"\n                                <label for=\"add-function-min\">{%LNG.minimum}: <i class=\"ex\">min(1, 2, 3) = 1</i></label>"+"\n                            </li>"+"\n                        </ul>"+"\n                    </li>        "+"\n                </ul>"+"\n                <div class=\"buttons\">"+"\n                    <button type=\"submit\" class=\"button\"><span><span>{%LNG.Save}</span></span></button>"+"\n                    {%LNG.or}"+"\n                    <a href=\"#cancel\" class=\"script\" onclick=\"Goals.Add.hide(); return false;\">{%LNG.cancel}</a>"+"\n                </div>"+"\n            </fieldset>"+"\n        </dd>"+"\n    </dl>"+"\n    <input type=\"hidden\" name=\"tab\" />"+"\n    <input type=\"hidden\" name=\"position\" />"+"\n</fieldset>";form.setHTML(Template.transform(GOALS_FORM_ADD));self.Tabset=Mohawk.UI.Tabset.fromElement(form.getElementsByTagName('DL')[0]);form.getElementsByTagName('DL')[0].replace(self.Tabset.element);self.Categories=new CategoriesPick('categories-pick',Data.categories);form.getElementsByClassName('categories-pick')[0].replace(self.Categories.element);return form;},setData:function(){parent.setData();self.element.replaceClass('editing','adding');self.element.setData({type:'numeric',tab:ENV.tab,position:(Goals.Table.table.tBodies[0].length?parseInt(Goals.Table.table.tBodies[0].lastChild.data.position):0)+1});self.setType('numeric');self.IconItem.setData(0);self.IconZero.setData(0);self.IconTrue.setData(0);self.IconFalse.setData(0);self.Tabset.tabs[0].title.open();}});Mohawk.UI.Table=new Class({id:'',element:null,head:null,body:null,cols:[],__construct:function(id,data,head){self.id=id;self.element=document.createElement('TABLE');self.element.id=id;self.element.object=self;if(head){self.cols=Object.keys(head);self.head=self.createHead(head);self.element.appendChild(self.head);}
self.body=self.createBody();self.element.appendChild(self.body);self.setRows(data);},createHead:function(structure){var head=document.createElement('THEAD');var row=document.createElement('TR');head.appendChild(row);foreach(structure,function(name,value){cell=self.createHeadCell(name,value);row.appendChild(cell);});return head;},createHeadCell:function(name,content){var cell=document.createElement('TH');cell.data={name:name};cell.addClass(name);cell.innerHTML=content;return cell;},setHeadTitles:function(titles){var cells=self.head.firstTag('TR').childNodes;for(var i=0;i<cells.length;i++){if(cells[i].tagName&&cells[i].tagName.toUpperCase()=='TH'){cells[i].innerHTML=titles[cells[i].data.name];}}},createBody:function(){var body=document.createElement('TBODY');return body;},setRows:function(structure){self.body.removeChildren();foreach(structure,function(i,data){var row=self.createRow(data);self.body.appendChild(row);});},createCell:function(row_id,col_id,content,as_th){var cell=document.createElement(as_th?'TH':'TD');cell.id=self.getCellId(row_id,col_id);cell.row=row_id;cell.col=col_id;cell.data={row:row_id,col:col_id,content:content};cell.addClass(col_id);cell.innerHTML=content;cell.onmouseover=function(event){cell.addClass('cell-over');};cell.onmouseout=function(event){cell.removeClass('cell-over');};return cell;},createRow:function(cells){var row=DOM.element('TR');row.id=self.getRowId(cells.id);row.data=cells;foreach(self.cols,function(key,col){var data=cells[col];var cell=null;var handler=self['createCell'+col.ucfirst()];if(handler instanceof Function){cell=handler.apply(self,[cells.id,col,data]);}else{cell=self.createCell(cells.id,col,data);}
row.appendChild(cell);});row.onmouseover=function(){for(var i=0;i<row.childNodes.length;i++){row.childNodes[i].addClass('row-over');}};row.onmouseout=function(){for(var i=0;i<row.childNodes.length;i++){row.childNodes[i].removeClass('row-over');}};return row;},getRowId:function(id){return self.id+'-'+id;},getCellId:function(row_id,col_id){return self.id+'-'+row_id+'-'+col_id;},getCell:function(row_id,col_id){return ID(self.getCellId(row_id,col_id));},getRow:function(id){return ID(self.getRowId(id));},addRow:function(data){var row=self.createRow(data);self.body.appendChild(row);return row;},editRow:function(row,data){var row_data=row.data;foreach(data,function(i){row_data[i]=data[i];});var new_row=self.createRow(row_data);row.setClassesTo(new_row);row.replace(new_row);return new_row;},removeRow:function(row){row.remove();},appendTo:function(node){node.appendChild(self.element);}});Date.DAY=3600*24*1000;Date.fromString=function(str){var datetime=str.trim().split(' ');var date=datetime[0].split('-');if(datetime.length>1){var time=datetime[1].split(':');}else{var time=[0,0,0];}
return new Date(date[0],date[1]-1,date[2],time[0]||0,time[1]||0,time[2]||0);};Date.prototype.getWeek=function(dowOffset){dowOffset=typeof(dowOffset)=='number'?dowOffset:0;var newYear=new Date(this.getFullYear(),0,1);var day=newYear.getDay()-dowOffset;day=(day>=0?day:day+7);var daynum=Math.floor((this.getTime()-newYear.getTime()-(this.getTimezoneOffset()-newYear.getTimezoneOffset())*60000)/86400000)+1;var weeknum;if(day<4){weeknum=Math.floor((daynum+day-1)/7)+1;if(weeknum>52){nYear=new Date(this.getFullYear()+1,0,1);nday=nYear.getDay()-dowOffset;nday=nday>=0?nday:nday+7;weeknum=nday<4?1:53;}}else{weeknum=Math.floor((daynum+day-1)/7);}
return weeknum;};Date.prototype.getDaysInMonth=function(){var months=[31,Date.isLeapYear(this.getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31];return months[this.getMonth()];};Date.isLeapYear=function(year){return year%4?false:(year%100?true:(year%400?false:true));};Date.getWeekday=function(d,m,y){var date=new Date(y,m-1,d);var wd=date.getDay()||7;return wd;};Date.prototype.clone=function(){return new Date(this.valueOf());};Date.prototype.addDay=function(num){if(typeof(num)=='undefined'){num=1;}
var date=this.clone();date.setDate(date.getDate()+num);return date;};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};Date.prototype.daysFrom=function(date){return Math.round((this.valueOf()-date.valueOf())/Date.DAY);};Date.prototype.getMonthWeek=function(){var first_date=new Date(this);first_date.setDate(1);return this.getWeek(1)-first_date.getWeek(1)+1;};Date.prototype.getId=function(date){var year=this.getFullYear();var month=this.getMonth()+1;var day=this.getDate();return''+year+'-'+(month<10?'0':'')+month+'-'+(day<10?'0':'')+day;};Date.prototype.gt=function(date){return this.valueOf()>date.valueOf();};Date.prototype.ge=function(date){return this.valueOf()>=date.valueOf();};Date.prototype.eq=function(date){return this.valueOf()==date.valueOf();};Date.prototype.ne=function(date){return this.valueOf()!=date.valueOf();};Date.prototype.le=function(date){return this.valueOf()<=date.valueOf();};Date.prototype.lt=function(date){return this.valueOf()<date.valueOf();};Date.prototype.isBetween=function(date1,date2){return this.ge(date1)&&this.le(date2);};Date.isTimeValid=function(str){var time_regexp=new RegExp('^(\\d{1,2})[\.-:](\\d{1,2})(?:[\.-:](\\d{1,2}))?$');return!!time_regexp.exec(str);};Date.parseTime=function(str){var time_regexp=new RegExp('^(\\d{1,2})[\.-:](\\d{1,2})(?:[\.-:](\\d{1,2}))?$');var hour='',mins='',secs='';if(time=time_regexp.exec(str)){hour=time[1];mins=time[2];secs=time[3];}else{hour='00';mins='00';secs='00';}
return{hour:hour,mins:mins,secs:secs};};Date.parse=function(str){var date_regexp=new RegExp('([0-9]{1,4})[\.\/-]([0-9]{1,2})[\.\/-]([0-9]{2}|\d{2})');if(date=date_regexp.exec(str)){var year=parseInt(date[1]);var month=date[2]*1;var day=date[3]*1;year=(year.toString().length==2)?(year<50?'20':'19').toString()+year:year;}else{var today=new Date;var day=today.getDate();var month=today.getMonth()+1;var year=today.getFullYear();}
return{day:day,month:month,year:year};};Mohawk.Loader.extendLanguage({"today":"today","January":"January","February":"February","March":"March","April":"April","May":"May","June":"June","July":"July","August":"August","September":"September","October":"October","November":"November","December":"December","Jan":"Jan","Feb":"Feb","Mar":"Mar","Apr":"Apr","Jun":"Jun","Jul":"Jul","Aug":"Aug","Sep":"Sep","Oct":"Oct","Nov":"Nov","Dec":"Dec","of_January":"January","of_February":"February","of_March":"March","of_April":"April","of_May":"May","of_June":"June","of_July":"July","of_August":"August","of_September":"September","of_October":"October","of_November":"November","of_December":"December","Monday":"Monday","Tuesday":"Tuesday","Wednesday":"Wednesday","Thursday":"Thursday","Friday":"Friday","Saturday":"Saturday","Sunday":"Sunday","Mon":"Mon","Tue":"Tue","Wed":"Wed","Thu":"Thu","Fri":"Fri","Sat":"Sat","Sun":"Sun","mo":"mo","tu":"tu","we":"we","th":"th","fr":"fr","sa":"sa","su":"su"})
window.RangeCalendar=new Class({element:null,startdate:null,enddate:null,marked:[],__construct:function(id){self.id=id;self.element=DOM.element('DIV');self.element.id=id;self.element.onclick=DOM.stopEvent;var today=new Date();self.element.appendChild(self.build(today.getFullYear(),today.getMonth()+1));self.EVENT_STARTDATE_SET='startdate-set';self.EVENT_ENDDATE_SET='enddate-set';document._toHideOnClick.push(self);},build:function(year,month){var container=DOM.element('DIV');container.addClass('range-calendar');var list=DOM.element('UL');var num=3;var prev=DOM.element('a');prev.addClass('go','prev');prev.setHTML('&lsaquo;');prev.href='#prev-month';prev.year=year;prev.month=month;prev.onclick=function(){var m=prev.month;var y=prev.year;if(m==1){m=12;y--;}else{m--;}
self.setDate(y,m);return false;};var next=DOM.element('a');next.addClass('go','next');next.setHTML('&rsaquo;');next.href='#next-month';next.year=year;next.month=month;next.onclick=function(){var m=next.month;var y=next.year;if(m==12){m=1;y++;}else{m++;}
self.setDate(y,m);return false;};self.marked=[];var last_table=null;for(var i=0;i<num;i++){var table=self.buildMonth(year,month,last_table);if(!last_table){self.firstTable=table;}
last_table=table;var li=DOM.element('LI');li.appendChild(table);list.appendChild(li);month++;if(month>12){month=1;year++;}}
container.appendChild(prev);container.appendChild(list);container.appendChild(next);var hint=DOM.element('P');hint.setHTML('To select a range: click on a date of the beginning, then click on a date of the end.<br /> To select a single day, simply click on it twice.');hint.appendTo(container);return container;},buildMonth:function(year,month,last_table){var months=[{name:LNG.January,days:31},{name:LNG.February,days:Date.isLeapYear(year)?29:28},{name:LNG.March,days:31},{name:LNG.April,days:30},{name:LNG.May,days:31},{name:LNG.June,days:30},{name:LNG.July,days:31},{name:LNG.August,days:31},{name:LNG.September,days:30},{name:LNG.October,days:31},{name:LNG.November,days:30},{name:LNG.December,days:31}];var today=new Date();var table=DOM.element('TABLE');table.onclick=function(event){event=Mohawk.DOM.event(event);event.stopPropagation();return false;};var caption=DOM.element('CAPTION');var title=months[month-1].name;if(month==1){title+=' '+year;}
caption.setHTML(title);table.appendChild(caption);var thead=DOM.element('THEAD');table.appendChild(thead);var thead_row=DOM.element('TR');thead.appendChild(thead_row);for(var i=0;i<static.weekdays.length;i++){var cell=DOM.element('TH');cell.setHTML(static.weekdays[i].name);cell.addClass(static.weekdays[i].holiday?'holiday':'');thead_row.appendChild(cell);}
var tbody=DOM.element('TBODY');table.appendChild(tbody);var day_of_week=Date.getWeekday(1,month,year);var days_in_month=months[month-1].days;var row=DOM.element('TR');tbody.appendChild(row);for(var i=1;i<day_of_week;i++){var cell=DOM.element('TD');row.appendChild(cell);}
var i=1;var last_cell=null;for(;i<=days_in_month;i++){if((i+day_of_week-1)%7==1){row=DOM.element('TR');tbody.appendChild(row);}
var date=new Date(year,month-1,i);var cell=self.createCell(date);if(last_cell){last_cell.nextCell=cell;}else{if(last_table){last_table.lastCell.nextCell=cell;}
table.firstCell=cell;}
last_cell=cell;if(date.toString()==today.toString()){cell.addClass('today');}
row.appendChild(cell);}
table.lastCell=cell;i=(days_in_month+day_of_week-1)%7;if(!i){i=7;}
for(;i<7;i++){var cell=DOM.element('TD');row.appendChild(cell);}
return table;},createCell:function(day){var cell=DOM.element('TD');cell.data={date:day};cell.onmouseover=function(){cell.addClass('over');};cell.onmouseout=function(){cell.removeClass('over');};cell.onclick=function(){if(!self.startdate){self.startdate=cell.data.date;Observer.fire(self.EVENT_STARTDATE_SET,cell.data.date);}else if(!self.enddate){if(self.startdate.le(cell.data.date)){self.enddate=cell.data.date;Observer.fire(self.EVENT_ENDDATE_SET,cell.data.date);}else{self.startdate=cell.data.date;Observer.fire(self.EVENT_STARTDATE_SET,cell.data.date);}}else{self.startdate=cell.data.date;self.enddate=null;Observer.fire(self.EVENT_STARTDATE_SET,cell.data.date);Observer.fire(self.EVENT_ENDDATE_SET,null);}
self.markRange();};cell.innerHTML='<small>'+day.getDate()+'</small>';cell.id=self.getId(day);return cell;},getId:function(date){return self.id+'-'+(date instanceof Date?date.getId():date);},getCell:function(date){return ID(self.getId(date));},markRange:function(){foreach(self.marked,function(){this.removeClass('marked','start','end','one');});if(!self.startdate){return;}
var cell=self.getCell(self.startdate);if(cell){self.markCell(cell);cell.replaceClass('marked','start');}else{if(self.firstTable.firstCell.data.date.gt(self.startdate)){cell=self.firstTable.firstCell;}else{return;}}
if(!self.enddate){return;}
if(cell.data.date.eq(self.startdate)&&cell.data.date.eq(self.enddate)){cell.replaceClass('start','one');return;}
while(cell.nextCell){if(cell.nextCell.data.date.le(self.enddate)){self.markCell(cell.nextCell);cell=cell.nextCell;if(cell.data.date.eq(self.enddate)){cell.replaceClass('marked','end');break;}}else{break;}}},markCell:function(cell){cell.addClass('marked');self.marked.push(cell);},setDate:function(year,month){if(year instanceof Date){month=year.getMonth()+1;year=year.getFullYear();}
var container=self.build(year,month);self.element.setChild(container);self.markRange();},hide:function(){self.element.remove();}});RangeCalendar.weekdays=[{name:LNG.mo,holiday:false},{name:LNG.tu,holiday:false},{name:LNG.we,holiday:false},{name:LNG.th,holiday:false},{name:LNG.fr,holiday:false},{name:LNG.sa,holiday:true},{name:LNG.su,holiday:true}];window.PlanTable=Mohawk.UI.Table.extend({__construct:function(id){var data=[];var head={date:LNG.Date,value:LNG.Value};parent.__construct(id,data,head);var foot=self.createFoot();self.element.appendChild(foot);self.Calendar=new RangeCalendar('plan-calendar');self.Calendar.element.addClass('shadowed');Observer.add(self.Calendar.EVENT_ENDDATE_SET,function(date){if(!date){return;}
self.Calendar.hide();var startdate=self.Calendar.startdate;var enddate=self.Calendar.enddate;if(self.current){var row=self.getRow(self.current);var data={goal:self.goal.id,startdate:startdate.getId(),enddate:enddate.getId()};Goals.editPlan(row.data.id,data);self.editRow(row,data);}else{var data={id:'new-'+(new Date).valueOf(),goal:self.goal.id,startdate:startdate.getId(),enddate:enddate.getId(),value:''};var row=self.addRow(data);Observer.add('plan-added-'+data.id,function(new_id){self.editRow(row,{id:new_id});});Goals.addPlan(data);}});},createFoot:function(){var foot=DOM.element('TFOOT');var row=DOM.element('TR');foot.appendChild(row);var cell=self.createCellDate(0,'date',null);cell.colSpan=2;row.appendChild(cell);return foot;},createRow:function(data){data.date={start:data.startdate,end:data.enddate};return parent.createRow(data);},createCellDate:function(row,col,data){var cell=parent.createCell(row,col,data,true);var startdate,enddate;if(data){startdate=Date.fromString(data.start);enddate=Date.fromString(data.end);}
var p=DOM.element('P');if(data){var remove=DOM.element('IMG');remove.src=URL.img+'site/trash.png';remove.appendTo(p);remove.onclick=function(){var row=self.getRow(cell.row);Goals.removePlan(row.data.id,row.data.goal);Effects.vanish(row,function(){self.removeRow(row);});};}
var link=DOM.element('A');link.href='#set-date';link.addClass('script');link.setHTML(startdate?Format.dateRange(startdate,enddate):LNG.Set_date);link.onclick=function(event){event=DOM.event(event);event.stopPropagation();document.body.appendChild(self.Calendar.element);if(data){self.Calendar.startdate=startdate;self.Calendar.enddate=enddate;}else{self.Calendar.startdate=null;self.Calendar.enddate=null;}
self.Calendar.setDate(startdate?startdate:new Date);Dragdrop.bringToFront(self.Calendar.element);self.Calendar.element.adjoinTo(link,'bottom',true);self.Calendar.element.alignTo(link,'left',true);self.current=row;return false;};link.appendTo(p);cell.setChild(p);return cell;},createCellValue:function(row,col,data){var cell=parent.createCell(row,col,data);cell.setHTML('');var input=DOM.element('input');if(Goals.Edit.data.type=='time'||Goals.Edit.data.type=='timer'){input.value=Goals.Table.formatTime(data,'{%h}:{%m}');}else{input.value=data;}
cell.appendChild(input);input.title=LNG.Input_value;input.onfocus=function(){if(input.value==input.title){input.value='';}
input.removeClass('empty');};input.onblur=function(){if(input.value==''){input.value=input.title;input.addClass('empty');}};input.onchange=function(){var value=input.value;if(Goals.Edit.data.type=='time'||Goals.Edit.data.type=='timer'){value=Goals.Time.toSeconds(input.value);}
Goals.editPlan(self.getRow(cell.row).data.id,{goal:self.goal.id,value:value});};input.blur();return cell;}});window.ChartPeriodList=Mohawk.UI.SelectableList.extend({selected:[],multiple:false,__construct:function(id){var period_list=[{id:'week',title:LNG.week},{id:'month',title:LNG.month},{id:'quarter',title:LNG.quarter},{id:'year',title:LNG.year},{id:'all',title:LNG.all_time}];parent.__construct(id,period_list);self.element.addClass('options');}});window.ChartGroupList=Mohawk.UI.SelectableList.extend({selected:[],multiple:false,__construct:function(id){var groupby_list=[{id:'day',title:LNG.day},{id:'week',title:LNG.week},{id:'weekday',title:LNG.week_days},{id:'month',title:LNG.month}];parent.__construct(id,groupby_list);self.element.addClass('options');}});window.ChartTypeList=Mohawk.UI.SelectableList.extend({selected:[],multiple:false,__construct:function(id){var type_list=[{id:'column',title:LNG.chart_column},{id:'line',title:LNG.chart_line},{id:'area',title:LNG.chart_area},{id:'pie',title:LNG.chart_pie}];parent.__construct(id,type_list);self.element.addClass('options');},createNode:function(data){var node=parent.createNode(data);node.setHTML('<img src="'+URL.img+'site/chart_'+data.id+'.png" alt="'+data.title+'" />');return node;}});window.ChartData=new Singletone({setGoalId:function(id){self.setGoal(self.getGoalById(id));},setGoal:function(goal){self.goal=goal;self.setAggregate();},setGroup:function(group){self.group=group;},setPeriod:function(period){var today=new Date();var first=Object.keys(Data.data[self.goal.id]).sort()[0];var earliest=first?Date.fromString(first):today;var start;var end=today;switch(period){case'week':start=end.addDay(-7);break;default:case'month':start=end.addDay(-31);break;case'quarter':start=end.addDay(-122);break;case'year':start=end.addDay(-366);break;case'all':start=earliest;break;}
if(start.lt(earliest)){start=earliest;}
self.start=start;self.end=end;},setAggregate:function(){var aggregate=function(){};if(self.goal.type=='boolean'){self.goal.aggregate='boolean';}
switch(self.goal.aggregate){default:case'sum':aggregate=function(array){var sum=0;for(var i=0;i<array.length;i++){sum+=array[i];}
return sum;};break;case'min':aggregate=function(array){var min;for(var i=0;i<array.length;i++){if(min==undefined||min>array[i]){min=array[i];}}
return min;};break;case'max':aggregate=function(array){var max=undefined;for(var i=0;i<array.length;i++){if(max==undefined||max<array[i]){max=array[i];}}
return max;};break;case'avg':aggregate=function(array){var sum=0;for(var i=0;i<array.length;i++){sum+=array[i];}
return sum/i;};break;case'boolean':aggregate=function(array){var yes=0;var no=0;for(var i=0;i<array.length;i++){if(array[i]===1){yes++;}else if(array[i]===0){no++;}}
return(yes+no>0)?yes/(yes+no):0;};break;}
self.aggregate=aggregate;},getGoalById:function(id){var goal=false;foreach(Data.goals,function(i,data){if(data.id==id){goal=Object.clone(data);return false;}});return goal;},data4protovis:function(grouped){var data=[];foreach(grouped,function(i,val){data.push([i,val.value,val.title,val.extended]);});return data;},getGroupedData:function(){switch(self.group){default:case'day':return self.groupByDay();case'week':return self.groupByWeek();case'weekday':return self.groupByWeekDay();case'month':return self.groupByMonth();}},getBooleanData:function(){var values=[{extended:'no',title:'no',value:0,plan:'-'},{extended:'yes',title:'yes',value:0,plan:'-'}];for(var day=self.start;day.le(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,Format.date(day,'Y-m-d')).value;if(value===1){values[1].value++;}else if(value===0){values[0].value++;}}
return values;},getAccumulatedData:function(){var grouped=[];var plans=[];if(!self.goal.day_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var plan={};plan.start=Date.fromString(row.startdate);plan.end=Date.fromString(row.enddate);plan.period=plan.end.daysFrom(plan.start)+1;if(self.goal.aggregate=='sum'){plan.value=row.value+' in '+plan.period+'days';}else{plan.value=row.value;}
plans.push(plan);});}
self.goal.day_plans=plans;}else{plans=self.goal.day_plans;}
var value=0,min,max;for(var day=self.start;day.le(self.end);day=day.addDay()){var actual=Goals.getData(self.goal.id,Format.date(day,'Y-m-d')).value;if(self.goal.type=='time'||self.goal.type=='timer'){actual/=3600;}
if(self.goal.aggregate==''){value=actual||value;}else{value+=actual||0;}
if((min===undefined||min<actual)&&actual!==''){min=actual;}
if((max===undefined||max>actual)&&actual!==''){max=actual;}
var row={};row.value=value;row.title=Format.date(day,'n/j');row.extended=Format.date(day,'l, F j');var day_plan=false;foreach(plans,function(i,plan){if(day.isBetween(plan.start,plan.end)&&(!day_plan||day_plan.period>plan.period)){day_plan=plan;return true;}});row.plan=day_plan?day_plan.value:'-';grouped.push(row);}
self.min=min;self.max=max;return grouped;},groupByDay:function(){var grouped=[];var plans=[];if(!self.goal.day_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var plan={};plan.start=Date.fromString(row.startdate);plan.end=Date.fromString(row.enddate);plan.period=plan.end.daysFrom(plan.start)+1;if(self.goal.aggregate=='sum'){plan.value=[row.value,plan.period];}else{plan.value=row.value;}
plans.push(plan);});}
self.goal.day_plans=plans;}else{plans=self.goal.day_plans;}
var min,max,prev=0;for(var day=self.start;day.le(self.end);day=day.addDay()){var row={};var day_id=day.getId();var actual=Goals.getData(self.goal.id,day_id).value;if(self.goal.type=='time'||self.goal.type=='timer'){actual/=3600;}
var value=actual||(self.take_last_value?prev:0);row.value=value;row.title=Format.date(day,'n/j');row.extended=Format.date(day,'l, F j');if((min===undefined||min<actual)&&actual!==''){min=actual;}
if((max===undefined||max>actual)&&actual!==''){max=actual;}
var day_plan=false;foreach(plans,function(i,plan){if(day.isBetween(plan.start,plan.end)&&(!day_plan||day_plan.period>plan.period)){day_plan=plan;return true;}});row.plan=day_plan?day_plan.value:'-';grouped.push(row);prev=value;}
self.min=min;self.max=max;return grouped;},groupByWeekDay:function(){var grouped=[{value:[],title:'Sun',extended:'Sunday','plan':''},{value:[],title:'Mon',extended:'Monday','plan':''},{value:[],title:'Tue',extended:'Tueday','plan':''},{value:[],title:'Wed',extended:'Wednesday','plan':''},{value:[],title:'Thu',extended:'Thursday','plan':''},{value:[],title:'Fri',extended:'Friday','plan':''},{value:[],title:'Sat',extended:'Saturday','plan':''}];var prev=0;for(var day=self.start;day.le(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,day.getId()).value||(self.take_last_value?prev:0);if(self.goal.type=='time'||self.goal.type=='timer'){value/=3600;}
grouped[day.getDay()].value.push(value);prev=value;}
for(var i=0;i<grouped.length;i++){grouped[i].value=self.aggregate(grouped[i].value);}
grouped.push(grouped.shift());return grouped;},groupByWeek:function(){var plans=[];if(!self.goal.week_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var period=Date.fromString(row.enddate).daysFrom(Date.fromString(row.startdate))+1;if(period!=7){return;}
var plan={};plan.startdate=row.startdate;plan.value=row.value;plans.push(plan);});}
self.goal.week_plans=plans;}else{plans=self.goal.week_plans;}
var grouped=[];var week_start=self.start;var values=[];var prev=0;for(var day=self.start,week=day.getWeek();day.le(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,day.getId()).value||(self.take_last_value?prev:0);if(self.goal.type=='time'||self.goal.type=='timer'){value/=3600;}
if(day.getWeek(1)!=week){var row={};row.value=self.aggregate(values);row.title=Format.dateRange(week_start,day.addDay(-1),'-',{d:'j',m:'M'});row.extended=Format.dateRange(week_start,day.addDay(-1),'-',{d:'j',m:'M'});var week_plan=false;foreach(plans,function(i,plan){if(week_start.getId()==plan.startdate){week_plan=plan;return true;}});row.plan=week_plan?week_plan.value:'-';grouped.push(row);week=day.getWeek(1);week_start=day;values=[value];}else{values.push(value);}
prev=value;}
if(values.length){var row={};row.value=self.aggregate(values);row.title=Format.dateRange(week_start,day.addDay(-1),'-',{d:'j',m:'M'});row.extended=Format.dateRange(week_start,day.addDay(-1),'-',{d:'j',m:'M'});var week_plan=false;foreach(plans,function(i,plan){if(week_start.getId()==plan.startdate){week_plan=plan;return true;}});row.plan=week_plan?week_plan.value:'-';grouped.push(row);}
return grouped;},groupByMonth:function(){var plans=[];if(!self.goal.week_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var start=Date.fromString(row.startdate);if(start.getDate()!=1){return;}
var period=Date.fromString(row.enddate).daysFrom(start)+1;if(period!=start.getDaysInMonth()){return;}
var plan={};plan.month=start.getMonth();plan.value=row.value;plans.push(plan);});}
self.goal.week_plans=plans;}else{plans=self.goal.week_plans;}
var grouped=[];var values=[];var prev=0;for(var day=self.start,month=day.getMonth();day.lt(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,day.getId()).value||(self.take_last_value?prev:0);if(self.goal.type=='time'||self.goal.type=='timer'){value/=3600;}
if(day.getMonth()!=month){var row={};row.value=self.aggregate(values);row.title=Format.date(day.addDay(-1),'M');row.extended=Format.date(day.addDay(-1),'F');var month_plan=false;foreach(plans,function(i,plan){if(month==plan.month){month_plan=plan;return true;}});row.plan=month_plan?month_plan.value:'-';grouped.push(row);month=day.getMonth();values=[value];}else{values.push(value);}
prev=value;}
if(values.length){var row={};row.value=self.aggregate(values);row.title=Format.date(day.addDay(-1),'M');row.extended=Format.date(day.addDay(-1),'F');var month_plan=false;foreach(plans,function(i,plan){if(month==plan.month){month_plan=plan;return true;}});row.plan=month_plan?month_plan.value:'-';grouped.push(row);}
return grouped;}});window.BaseChart=new Class({width:0,height:0,canvas:null,type:null,interpolate:false,title:'',set:function(options){var fields=['width','height','canvas','type','data','interpolate'];foreach(fields,function(i,field){if(field in options){self[field]=options[field];}});},draw:function(){}});window.ChartFactory={factory:function(type){if(type=='protovis'){window.ProtovisChart=BaseChart.extend({grid:function(id,data,w,h,linear_x){var max=false,min=false;var labels_length=0;foreach(data,function(i,row){labels_length+=row[2].length;var value=row[1];if(max===false||max<value){max=value;}
if(min===false||min>value){min=value;}});if(min>0){min-=Math.ceil(Math.log(max-min)/Math.log(10));}
self.min=min;self.max=max;var x;if(linear_x){x=pv.Scale.linear(0,data.length-1).range(0,w-70);}else{x=pv.Scale.ordinal(pv.range(data.length)).splitBanded(0,w-70,4/5);}
var y=pv.Scale.linear(min,max).range(0,h-50);self.vis=new pv.Panel().def("i",-1).canvas(id).width(w-70).height(h-50).bottom(25).left(35).right(35).top(25);self.vis.add(pv.Rule).data(y.ticks(4)).bottom(function(d){return Math.round(y(d))-.5}).strokeStyle(function(d){return d==Math.max(0,min)?'#000':'#eee'}).anchor("left").add(pv.Label).text(function(d){return(d&&d>-10&&d<10?d.toFixed(1):d)});var n_labels=Math.floor(w/(labels_length/data.length))/10;self.vis.add(pv.Label).data(data).left(function(d){return x(d[0])}).bottom(y(min)).visible(function(d){return data.length<=n_labels||!(d[0]%Math.round(data.length/n_labels))}).textStyle("#000").textBaseline('top').textAlign('left').textMargin(10).text(function(d){return d[2]});self.x=x,self.y=y;},column:function(id,data,w,h){self.grid(id,data,w,h);var vis=self.vis,x=self.x,y=self.y,min=self.min,max=self.max;var bar=vis.add(pv.Bar).data(data).left(function(d){return x(d[0])}).width(x.range().band).bottom(function(d){var bh=y(d[1]);return(d[1]>=0?Math.max(y(0),y(min)):bh)}).height(function(d){var bh=y(d[1])-Math.max(y(0),y(min));return Math.abs(bh)-1}).fillStyle(function(d){return(d[1]>=0?pv.color((vis.i()==this.index?'#aec7e8':'#1f77b4')).alpha(0.8):pv.color((vis.i()==this.index?'#ff9896':'#d62728')).alpha(0.8))}).event('mouseover',function(){return vis.i(this.index)}).event('mouseout',function(){return vis.i(-1)}).add(pv.Label).bottom(function(d){return y(d[1])}).visible(function(){return vis.i()==this.index}).text(function(d){return d[1].toFixed(1)+': '+d[3]}).textAlign(function(){return(this.index>0.5*data.length?'right':'left')}).textStyle("#000000").textMargin(10).font("12px Arial");vis.render();},line:function(id,data,w,h,interpolate){self.grid(id,data,w,h,true);var vis=self.vis,x=self.x,y=self.y,min=self.min,max=self.max,idx=-1;var line=vis.add(pv.Line).data(data).left(function(d){return x(d[0])}).bottom(function(d){return y(d[1])-1}).lineWidth(1).interpolate(interpolate?'cardinal':'none').add(pv.Label).bottom(function(d){return y(d[1])}).visible(function(d){return vis.i()==d[0]}).text(function(d){return d[1].toFixed(1)+': '+d[3]}).textAlign(function(){return(this.index>0.5*data.length?'right':'left')}).textStyle("#000000").textMargin(10).font("12px Arial");if(data.length<40){line.add(pv.Dot).visible(true).bottom(function(d){return y(d[1])-1}).shapeSize(10).fillStyle("#1f77b4")}
vis.add(pv.Rule).visible(function(){return idx>=0}).left(function(){return x(idx)}).top(-4).bottom(-4).strokeStyle("#000");vis.add(pv.Panel).events("all").event("mousemove",function(){idx=x.invert(vis.mouse().x)>>0;return vis.i(idx)}).event("mouseout",function(){idx=-1;return vis.i(-1)});vis.render();},area:function(id,data,w,h,interpolate){self.grid(id,data,w,h,true);var vis=self.vis,x=self.x,y=self.y,min=self.min,max=self.max,idx=-1,prev;var new_data=[];var prev;foreach(data,function(i,row){var value=row[1];if(prev&&prev*value<0){var x2=row[0],x1=x2-1;var y2=value,y1=prev;var x=x1-y1*((x2-x1)/(y2-y1));new_data.push([x,0,'','']);}
new_data.push(row);prev=value;});var area=vis.add(pv.Area).data(new_data).left(function(d){return x(d[0])}).bottom(Math.max(y(0),y(min))).height(function(d){return y(d[1])-Math.max(y(0),y(min))}).interpolate(interpolate?'cardinal':'none').segmented(true).fillStyle(function(d){return pv.color(d[1]<0||(d[1]==0&&new_data[this.index+1]&&new_data[this.index+1][1]<0)?'#ff9896':'#aec7e8').alpha(0.5)})
var line=vis.add(pv.Line).data(new_data).left(function(d){return x(d[0])}).bottom(function(d){return y(d[1])-1}).lineWidth(1).segmented(true).strokeStyle(function(d){return pv.color(d[1]<0||(d[1]==0&&new_data[this.index+1]&&new_data[this.index+1][1]<0)?'#d62728':'#1f77b4').alpha(0.5)}).interpolate(interpolate?'cardinal':'none').add(pv.Label).bottom(function(d){return y(d[1])}).visible(function(d){return vis.i()==d[0]}).text(function(d){return d[1].toFixed(1)+': '+d[3]}).textAlign(function(){return(this.index>0.5*data.length?'right':'left')}).textStyle("#000000").textMargin(10).font("12px Arial");if(data.length<40){line.add(pv.Dot).visible(function(d){return!!d[2]}).bottom(function(d){return y(d[1])-1}).shapeSize(10).fillStyle(function(d){return(d[1]>=0?pv.color('#1f77b4'):pv.color('#d62728'))});}
vis.add(pv.Rule).visible(function(){return idx>=0}).left(function(){return x(idx)}).top(-4).bottom(-4).strokeStyle("#000");vis.add(pv.Panel).events("all").event("mousemove",function(){idx=x.invert(vis.mouse().x)>>0;return vis.i(idx)}).event("mouseout",function(){idx=-1;return vis.i(-1)});vis.render();},pie:function(id,data,w,h){var sum=0;var vals=[];foreach(data,function(i,row){var value=row[1];sum+=value;vals.push(value);});var
r=(h-50)/2,a=pv.Scale.linear(0,sum).range(0,2*Math.PI);var vis=new pv.Panel().canvas(id).width(w).height(h);vis.add(pv.Wedge).data(vals).bottom(h/2).left(w/2).outerRadius(r).angle(a).title(function(d){p=d/sum*100;return p.toFixed(2)+'%'}).add(pv.Wedge).visible(function(d){return d>.15}).innerRadius(r/6).outerRadius(r).fillStyle(null).anchor("center").add(pv.Label).textAngle(0).textStyle('white').textShadow('0.1em 0.1em 0.1em rgba(0, 0, 0, 0.5)').font('14px Arial').text(function(d){p=d/sum*100;return p.toFixed(2)+'%'});vis.render();},data4protovis:function(grouped){var data=[];foreach(grouped,function(i,val){if(isNaN(val.value)){val.value=0;}
data.push([i,val.value,val.title,val.extended]);});return data;},draw:function(){switch(self.type){case'column':var data=self.data4protovis(self.data);self.column(self.canvas,data,self.width,self.height);break;case'line':var data=self.data4protovis(self.data);self.line(self.canvas,data,self.width,self.height,self.interpolate);break;case'area':var data=self.data4protovis(self.data);self.area(self.canvas,data,self.width,self.height,self.interpolate);break;case'pie':var data=[[0,self.data[1].value,'Yes'],[1,self.data[0].value,'No'],];self.pie(self.canvas,data,self.width,self.height);}}});return new ProtovisChart;}else if(type=='googleapi'){window.GoogleApiChart=BaseChart.extend({encode:function(values,min,max){min=min||0;var map='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.';var len=map.length;var base=len*len;var range=max-min;var data='';foreach(values,function(i,val){val=new Number(val);if(isNaN(val)){val=0;}
var scaled=Math.floor((val-min)/range*base);if(scaled>base-1){data+='..';}else{var quotient=Math.floor(scaled/len);var remainder=scaled-len*quotient;data+=map.charAt(quotient)+map.charAt(remainder);}});return data;},draw:function(){var values=[];var titles=[];var max_len=10;foreach(self.data,function(i,row){if(self.data.length<max_len||i%Math.ceil(self.data.length/max_len)==0){titles.push(row['title']);}else{titles.push('');}
row['value']=new Number(row['value']);if(isNaN(row['value'])){row['value']=0;}
values.push(Math.round(row['value'],2));});var max=Math.max.apply(Math,values);var min=Math.min.apply(Math,values);var options={};var zero_point=min>0?0:Math.round(-min/(max-min),2);switch(self.type){case'line':options={cht:'lc',chd:'e:'+self.encode(values,min,max),chxl:'0:|'+titles.join('|'),chxr:'1,'+min+','+max,chxt:'x,y',chco:'1f77b4',chm:self.data.length<40?'h,000000,0,'+zero_point+',1|o,1f77b4,0,-1,6':'h,000000,0,'+zero_point+',1'};break;case'area':options={cht:'lc',chd:'e:'+self.encode(values,min,max)+','+self.encode([0,0],min,max),chxl:'0:|'+titles.join('|'),chxr:'1,'+min+','+max,chxt:'x,y',chco:'1f77b4',chds:min+','+max,chm:self.data.length<40?'h,000000,0,'+zero_point+',1|o,1f77b4,0,-1,6|b,aec7e8,1,0,0':'h,000000,0,'+zero_point+',1|b,aec7e8,1,0,0'};break;case'column':options={cht:'bvs',chd:'e:'+self.encode(values,min,max),chxl:'0:|'+titles.join('|'),chxr:'1,'+min+','+max,chxt:'x,y',chco:'1f77b4',chbh:'a',chds:min+','+max,chm:'h,000000,0,'+zero_point+',1'};break;case'pie':options={cht:'p',chd:'t:'+values.join(','),chl:'No|Yes',chco:'aec7e8|1f77b4'};break;default:return;}
options.chs=self.width+'x'+self.height;options.chtt=self.title;var canvas=ID(self.canvas);canvas.setChild(DOM.element('img',{src:URL.img+'site/loading24.gif'}));var img=DOM.element('IMG',{src:'http://chart.apis.google.com/chart?'+Ajax.prepare(options),onload:function(){canvas.setChild(img);},onerror:function(){canvas.setHTML(LNG.Error);}});}});return new GoogleApiChart;}else if(type=='googlevis'){window.GoogleVisChart=BaseChart.extend({__construct:function(){},draw:function(){var len=0;var data=new google.visualization.DataTable();data.addColumn('string','Date');data.addColumn('number','Value');if(self.type=='pie'){data.addRows(2);data.setValue(0,0,'Yes');data.setValue(0,1,1*self.data[1].value);data.setValue(1,0,'No');data.setValue(1,1,1*self.data[0].value);}else{foreach(self.data,function(i,row){len++;data.addRows(1);row.value=new Number(row.value);if(isNaN(row.value)){row.value=0;}
row.value=Math.round(row.value,2);data.setValue(i,0,row.title);data.setValue(i,1,row.value);});}
var options={width:self.width-1,height:self.height-1,chartArea:{left:40,top:20,width:self.width-80,height:self.height-50},legend:'none',enableTooltip:true,colors:['#1f77b4'],axisTitlesPosition:'in',hAxis:{slantedText:false,textStyle:{fontSize:10}},vAxis:{textStyle:{fontSize:10}}};switch(self.type){default:case'column':var Graph=new google.visualization.ColumnChart(ID(self.canvas));Graph.draw(data,options);break;case'line':var Graph=new google.visualization.LineChart(ID(self.canvas));options.lineWidth=1;options.pointSize=len<40?4:0;options.curveType=self.interpolate?'function':'none';Graph.draw(data,options);break;case'area':var Graph=new google.visualization.AreaChart(ID(self.canvas));options.lineWidth=1;options.curveType=self.interpolate?'function':'none';options.pointSize=len<40?4:0;Graph.draw(data,options);break;case'pie':var Graph=new google.visualization.PieChart(ID(self.canvas));options.colors=['#1f77b4','#aec7e8'];Graph.draw(data,options);break;}}});return new GoogleVisChart;}else{console.log(type+' is undefined');}}};window.SHARE_DEFAULT="<p>"+"\n    {%LNG.Share_chart},"+"\n    <a href=\"#share\" onclick=\"Goals.Edit.Chart.share(); return false;\" class=\"script\">{%LNG.obtain_code}</a>"+"\n</p>";window.SHARE_RESULT="<p>"+"\n    {%LNG.Link_to_chart_page}: <a href=\"{%url}\">{%url}</a>"+"\n</p>"+"\n"+"\n<p>"+"\n    {%LNG.Embed_chart_code}: <br />"+"\n    <textarea onfocus=\"this.select();\">{%code}</textarea>"+"\n</p>"+"\n"+"\n<p>"+"\n    {%LNG.Post_chart}:<br />"+"\n    <a href=\"http://www.facebook.com/share.php?u={%url}\" target=\"_blank\"><img src=\"{%URL.img}site/facebook.png\" alt=\"Share in Facebook\" /></a>"+"\n    <a href=\"http://twitter.com/home?status=My+chart+for+{%goal.title|escape}: {%url}\" target=\"_blank\"><img src=\"{%URL.img}site/twitter.png\" alt=\"Retweet\" /></a>"+"\n    <a href=\"http://www.google.com/buzz/post?url={%url}&title=My+chart+for+{%goal.title|escape}&imageurl={%url}.png\" target=\"_blank\"><img src=\"{%URL.img}site/buzz.png\" alt=\"Rebuzz\" /></a>"+"\n</p>";window.GoalsChart=new Class({initiated:false,init:function(){self.initiated=true;self.canvas=ID('chart-canvas');self.table=ID('chart-table');self.image=ID('chart-image');self.Period=new ChartPeriodList('chart-period');ID('chart-period').replace(self.Period.element);self.GroupBy=new ChartGroupList('chart-groupby');ID('chart-groupby').replace(self.GroupBy.element);self.Type=new ChartTypeList('chart-type');ID('chart-type').replace(self.Type.element);Observer.add(self.Type.EVENT_SELECTED,function(){var type=self.Type.selected[0].data.id;switch(type){case'pie':self.GroupBy.element.parentNode.addClass('hidden');ID('chart-advanced').parentNode.addClass('hidden');break;default:self.GroupBy.element.parentNode.removeClass('hidden');ID('chart-advanced').parentNode.removeClass('hidden');if(self.goal.type=='boolean'){self.Period.getNode('week').addClass('hidden');self.GroupBy.getNode('day').addClass('hidden');}else{self.Period.getNode('week').removeClass('hidden');self.GroupBy.getNode('day').removeClass('hidden');}
break;}
self.draw();});Observer.add(self.Period.EVENT_SELECTED,function(){self.draw();});Observer.add(self.GroupBy.EVENT_SELECTED,function(){self.draw();});self.Chart=ChartFactory.factory(ENV.chart_type);},draw:function(goal){if(goal){self.goal=Object.clone(goal);switch(goal.type){case'boolean':self.Type.getNode('pie').removeClass('hidden');self.Type.setSelected('pie');self.Period.setSelected('month');self.GroupBy.setSelected('week');break;default:self.Type.getNode('pie').addClass('hidden');self.Type.setSelected('column');self.Period.setSelected('month');self.GroupBy.setSelected('day');break;}
Observer.fire(self.Type.EVENT_SELECTED);}else{goal=self.goal;}
var type=self.Type.getSelected()||'column';var data;ChartData.setGoal(goal);ChartData.setGroup(self.GroupBy.getSelected()||'day');ChartData.setPeriod(self.Period.getSelected()||'none');ChartData.take_last_value=ID('chart-fill-empty').checked;var accumulate=ID('chart-accumulate').checked;if(type=='pie'){data=ChartData.getBooleanData();}else{data=accumulate?ChartData.getAccumulatedData():ChartData.getGroupedData();}
self.Chart.set({canvas:self.canvas.id,width:800,height:300,type:type,interpolate:ID('chart-interpolate').checked,data:data});self.Chart.draw();self.drawTable(data);},drawTable:function(data){var table=new ChartTable('chart-table',{},{extended:LNG.Date,value:LNG.Value,plan:LNG.Planned});table.type=self.goal.type;table.setRows(data);self.table.replace(table.element);self.table=table.element;},share:function(post_to){var req=new Ajax(URL.home+'api/share/');req.responseHandler=function(req){var item=req.data.item;if(item){var url=URL.host+URL.home+'p/'+item.uid;Template.assign('url',url);Template.assign('goal',self.goal);Template.assign('code','<a href="'+url+'"><img src="'+url+'.png" alt="My chart for '+self.goal.title+'" border="0" /></a>');ID('chart-share').setHTML(Template.transform(SHARE_RESULT));}else{}};var src=Goals.Edit.Chart.image.firstTag('img').src;var data=src.substr(src.indexOf('?')+1);req.send({data:data,goal:self.goal.id,post_to:post_to});ID('chart-share').setHTML(LNG.Loading);},hide:function(){Shadow.hide();self.element.addClass('hidden');}});window.ChartTable=Mohawk.UI.Table.extend({createCellValue:function(row,col,data){var cell=parent.createCell(row,col,data);if(self.type=='time'||self.type=='timer'){cell.setHTML(Goals.Table.formatTime(data*3600,'{%h}:{%m}'));}else{cell.setHTML(Math.round(data,2));}
return cell;},createCellPlan:function(row,col,data){var period=0;if(data instanceof Array){period=data[1];data=data[0];}
var cell=parent.createCell(row,col,data);if(self.type=='time'||self.type=='timer'){cell.setHTML(Goals.Table.formatTime(data,'{%h}:{%m}'));}
if(period>0){cell.setHTML(cell.innerHTML+' in '+period+'day'+(period>1?'s':''));}
return cell;}});window.GoalsPageEdit=GoalsPage.extend({createForm:function(){var form=parent.createForm();form.id='goals-form-edit';self.EVENT_SET=form.id+'-set';self.EVENT_HIDDEN=form.id+'-hidden';window.GOALS_FORM_EDIT="<img id=\"goals-form-close\" src=\"{%URL.img}site/chart-close.png\" onclick=\"Goals.Edit.hide(); return false;\" />"+"\n<fieldset>"+"\n    <dl>"+"\n        <dt>{%LNG.Editing_goal}</dt>"+"\n        <dd>"+"\n            <fieldset>"+"\n                <input type=\"hidden\" name=\"id\" />"+"\n                <ul class=\"fields\">"+"\n                    <li>"+"\n                        <label class=\"block\">{%LNG.Title}</label>"+"\n                        <input name=\"title\" class=\"text\" />"+"\n                    </li>"+"\n                    <li class=\"clearfix\">"+"\n                        <label class=\"block\">{%LNG.Type}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Goal_type_info}</p>"+"\n                            <ul>"+"\n                                <li>{%LNG.Numeric_type_hint}</li>"+"\n                                <li>{%LNG.Counter_type_hint}</li>"+"\n                                <li>{%LNG.Boolean_type_hint}</li>"+"\n                                <li>{%LNG.Time_type_hint}</li>"+"\n                                <li>{%LNG.Timer_type_hint}</li>"+"\n                            </ul>"+"\n                        </blockquote>"+"\n                        <ul class=\"fields\">"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-type-numeric\" name=\"type\" value=\"numeric\" onclick=\"Goals.Edit.setType(this.value)\" />"+"\n                                <label for=\"edit-type-numeric\">{%LNG.numeric}: <i class=\"ex\">3.14, 100, 299792, {%LNG.etc}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-type-counter\" name=\"type\" value=\"counter\" onclick=\"Goals.Edit.setType(this.value)\" />"+"\n                                <label for=\"edit-type-counter\">{%LNG.counter}: <i class=\"ex\">1, 2, 3 ...</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-type-boolean\" name=\"type\" value=\"boolean\" onclick=\"Goals.Edit.setType(this.value)\" />"+"\n                                <label for=\"edit-type-boolean\">{%LNG.boolean}: <i class=\"ex\">{%LNG._yes} {%LNG.or} {%LNG._no}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-type-time\" name=\"type\" value=\"time\" onclick=\"Goals.Edit.setType(this.value)\" />"+"\n                                <label for=\"edit-type-time\">{%LNG.time}: <i class=\"ex\">7:30</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                            {%if ENV.user.valid}"+"\n                                <input type=\"radio\" id=\"edit-type-timer\" name=\"type\" value=\"timer\" onclick=\"Goals.Add.setType(this.value)\" />"+"\n                                <label for=\"edit-type-timer\">{%LNG.timer}: <i class=\"ex\">&#9656;7:30</i></label>"+"\n                            {%else}"+"\n                                <a href=\"{%URL.home}premium/\" onclick=\"return show_premium();\" class=\"premium\">"+"\n                                    <img src=\"{%URL.img}site/premium.png\" alt=\"*\" title=\"Premium feature\" />"+"\n                                </a>"+"\n                                <label for=\"edit-type-timer\">{%LNG.timer}: <i class=\"ex\">&#9656;7:30</i></label>"+"\n                            {%end}"+"\n                            </li>"+"\n                        </ul>"+"\n                    </li>"+"\n                    <li class=\"type counter\">"+"\n                        <label class=\"block\">{%LNG.Item_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Item_icon_hint}</p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-item\"></div>"+"\n                    </li>"+"\n                    <li class=\"type boolean\">"+"\n                        <label class=\"block\">{%LNG.Yes_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>"+"\n                                {%LNG.Yes_icon_hint}"+"\n                            </p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-true\"></div>"+"\n                    </li>"+"\n                    <li class=\"type boolean\">"+"\n                        <label class=\"block\">{%LNG.No_icon}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.No_icon_hint}</p>"+"\n                        </blockquote>"+"\n                        <div class=\"goals-icon-false\"></div>"+"\n                    </li>"+"\n                </ul>"+"\n                <p class=\"additional-parameters-toggler\"><a href=\"#additional-parameters\" class=\"script\" onclick=\"this.parentNode.nextTag('UL').flipClass('hidden'); return false;\">{%LNG.Additional_parameters}</a> &darr;</p>"+"\n                <ul class=\"fields additional-parameters\">"+"\n                    <li>"+"\n                        <label class=\"block\">{%LNG.Description}</label>"+"\n                        <textarea name=\"text\"></textarea>"+"\n                    </li>"+"\n                    <li class=\"type numeric counter\">"+"\n                        <label class=\"block\">{%LNG.Unit}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Unit_hint}</p>"+"\n                        </blockquote>"+"\n                        <input type=\"text\" name=\"unit\" class=\"text\" />"+"\n                        <br />"+"\n                        <input type=\"checkbox\" id=\"edit-prepend\" name=\"prepend\" value=\"yes\" />"+"\n                        <label for=\"edit-prepend\">{%LNG.prepend_hint}</label>"+"\n                    </li>"+"\n                    <li class=\"type numeric counter time timer\">"+"\n                        <label class=\"block\">{%LNG.Aggregate_function}</label>"+"\n                        <blockquote class=\"hint\">"+"\n                            <p>{%LNG.Aggregate_hint}</p>"+"\n                        </blockquote>"+"\n                        <ul class=\"fields\">"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"add-function-none\" name=\"aggregate\" value=\"\" />"+"\n                                <label for=\"add-function-none\">{%LNG.none_function}: <i class=\"ex\">{%LNG.show_the_last_value}</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-function-sum\" name=\"aggregate\" value=\"sum\" />"+"\n                                <label for=\"edit-function-sum\">{%LNG.summation}: <i class=\"ex\">1 + 2 + 3 = 6</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-function-avg\" name=\"aggregate\" value=\"avg\" />"+"\n                                <label for=\"edit-function-avg\">{%LNG.average}: <i class=\"ex\">(1 + 2 + 3) / 3 = 2</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-function-max\" name=\"aggregate\" value=\"max\" />"+"\n                                <label for=\"edit-function-max\">{%LNG.maximim}: <i class=\"ex\">max(1, 2, 3) = 3</i></label>"+"\n                            </li>"+"\n                            <li>"+"\n                                <input type=\"radio\" id=\"edit-function-min\" name=\"aggregate\" value=\"min\" />"+"\n                                <label for=\"edit-function-min\">{%LNG.minimum}: <i class=\"ex\">min(1, 2, 3) = 1</i></label>"+"\n                            </li>"+"\n                        </ul>"+"\n                    </li>        "+"\n                </ul>"+"\n                <div class=\"buttons\">"+"\n                    <button type=\"submit\" class=\"button\"><span><span>{%LNG.Save}</span></span></button>"+"\n                    {%LNG.or}"+"\n                    <a href=\"#cancel\" class=\"script\" onclick=\"Goals.Edit.hide(); return false;\">{%LNG.cancel}</a>"+"\n                    &nbsp;&nbsp;&nbsp;"+"\n                    <span id=\"delete-goal\">{%LNG.You_may_also} "+"\n                    {%if ENV.user.valid}"+"\n                        <a href=\"#archive\" class=\"script\" onclick=\"Goals.archive(Goals.Edit.element.id.value); return false;\">{%LNG.archive_goal}</a> "+"\n                    {%else}"+"\n                        <img src=\"{%URL.img}site/premium.png\" alt=\"*\" title=\"Premium feature\" />"+"\n                        <a href=\"{%URL.home}premium/\" onclick=\"return show_premium();\" class=\"script\">{%LNG.archive_goal}</a>"+"\n                    {%end}"+"\n                    {%LNG.or} <a href=\"#delete\" class=\"script\" onclick=\"Goals.remove(Goals.Edit.element.id.value); return false;\">{%LNG.del}</a> {%LNG.this_goal}</span>"+"\n                </div>"+"\n            </fieldset>"+"\n        </dd>"+"\n        <dt>{%LNG.Setting_plan}</dt>"+"\n        <dd>"+"\n            <p class=\"info\">{%LNG.Planning_info}</p>"+"\n            <blockquote class=\"hint\">"+"\n                <p>{%LNG.Planning_hint}</p>"+"\n            </blockquote>"+"\n            <div id=\"goals-plan\" class=\"goals-plan\"></div>"+"\n            <div class=\"buttons\">"+"\n                <button type=\"button\" class=\"button\" onclick=\"Goals.Edit.hide(); return false;\"><span><span>{%LNG.Done_planning}</span></span></button>"+"\n            </div>"+"\n        </dd>"+"\n        <dt>{%LNG.Statistics}</dt>"+"\n        <dd>"+"\n                    "+"\n            <div id=\"chart-constructor\">"+"\n                <dl>"+"\n                    <dt class=\"first\"><span>1. {%LNG.Choose_chart_type}:</span></dt>"+"\n                    <dt class=\"second\"><span>2. {%LNG.Choose_period_and_group}:</span></dt>"+"\n                    <dt class=\"third\"><span>3. {%LNG.Additional_options}:</span></dt>"+"\n                    <dd class=\"first\">"+"\n                        <div>"+"\n<!--                            <select id=\"chart-goal\" onchange=\"Goals.Edit.Chart.draw()\">-->"+"\n<!--                                {%for goal in Data.goals}-->"+"\n<!--                                    {%if goal}-->"+"\n<!--                                <option value=\"{%goal.id}\">{%goal.title}</option>-->"+"\n<!--                                    {%end}-->"+"\n<!--                                {%end}-->"+"\n<!--                            </select>-->"+"\n<!--                            <br /><br />-->"+"\n                            <div id=\"chart-type\"></div>"+"\n                        </div>"+"\n                    </dd>"+"\n                    <dd class=\"second\">"+"\n                        <div>"+"\n                            <b>{%LNG.Period}:</b> "+"\n                            <div id=\"chart-period\"></div>"+"\n                            <br /><br />"+"\n                            <b>{%LNG.Group_by}:</b>"+"\n                            <div id=\"chart-groupby\"></div>"+"\n                        </div>"+"\n                    </dd>"+"\n                    <dd class=\"third\">"+"\n                        <div>"+"\n                            <ul id=\"chart-advanced\">"+"\n                                <li>"+"\n                                    <input type=\"checkbox\" class=\"checkbox\" id=\"chart-accumulate\" onclick=\"Goals.Edit.Chart.draw()\" />"+"\n                                    <label for=\"chart-accumulate\">{%LNG.accumulate_values}</label>"+"\n                                </li>"+"\n                                <li>    "+"\n                                    <input type=\"checkbox\" class=\"checkbox\" id=\"chart-fill-empty\" onclick=\"Goals.Edit.Chart.draw()\" />"+"\n                                    <label for=\"chart-fill-empty\">{%LNG.fill_empty_values}</label>"+"\n                                </li>"+"\n                                <li>     "+"\n                                    <input type=\"checkbox\" class=\"checkbox\" id=\"chart-interpolate\" onclick=\"Goals.Edit.Chart.draw()\" />"+"\n                                    <label for=\"chart-interpolate\">{%LNG.interpolate_line}</label>"+"\n                                </li>"+"\n                            </ul>"+"\n                        </div>"+"\n                    </dd>"+"\n                </dl>"+"\n            </div>"+"\n"+"\n            <div id=\"chart-canvas\"></div>"+"\n            <div id=\"chart-image\" class=\"hidden\"></div>"+"\n            <div id=\"chart-table\"></div>"+"\n                        "+"\n            <div class=\"buttons\">"+"\n                <button type=\"button\" class=\"button\" onclick=\"Goals.Edit.hide(); return false;\"><span><span>{%LNG.Back_to_week_view}</span></span></button>"+"\n            </div>"+"\n        </dd>"+"\n    </dl>"+"\n</fieldset>";form.setHTML(Template.transform(GOALS_FORM_EDIT));self.Tabset=Mohawk.UI.Tabset.fromElement(form.getElementsByTagName('DL')[0]);form.getElementsByTagName('DL')[0].replace(self.Tabset.element);self.Plan=new PlanTable('goals-plan');form.getElementsByClassName('goals-plan')[0].replace(self.Plan.element);self.Chart=new GoalsChart;return form;},setData:function(data){parent.setData();self.data=data;self.element.setData(data);self.setType(data.type);self.IconItem.setData(data.icon_item);self.IconZero.setData(data.icon_zero);self.IconTrue.setData(data.icon_true);self.IconFalse.setData(data.icon_false);self.Tabset.tabs[0].title.open();self.Plan.goal=data;var plan=Data.plan[data.id]||{};self.Plan.setRows(Object.values(plan));if(!self.Chart.initiated){self.Chart.init();}
self.Chart.draw(data);},showChart:function(data){self.setData(data);self.Tabset.tabs[2].title.open();}});window.GoalsNumber=new Class({element:null,input:null,__construct:function(){var element=DOM.element('DIV');element.id='goals-number';element.addClass('goals-number-input','rounded');element.onclick=DOM.stopEvent;self.element=element;var corner1=DOM.element('SPAN');corner1.addClass('corner-border');element.appendChild(corner1);var corner2=DOM.element('SPAN');corner2.addClass('corner-bg');element.appendChild(corner2);var input=DOM.element('input',{type:'text'});input.id=self.id+'-input';var mode=DOM.element('LABEL');mode.htmlFor=input.id;mode.setHTML('+');mode.onclick=function(){if(mode.innerHTML=='+'){mode.setHTML('-');}else if(mode.innerHTML=='-'){mode.setHTML('=');}else{mode.setHTML('+');}};element.appendChild(mode);self.mode=mode;input.onclick=DOM.stopEvent;input.onmousedown=DOM.stopEvent;input.onkeypress=function(event){event=DOM.event(event);if(input.value.match(/^=/)){self.mode.innerHTML='=';self.input.value=input.value.replace(/^=/,'');}else if(input.value.match(/^-/)){if(self.mode.innerHTML!='='){self.mode.innerHTML='-';self.input.value=input.value.replace(/^-/,'');}}else if(input.value.match(/^\+/)){self.mode.innerHTML='+';self.input.value=input.value.replace(/^\+/,'');}
if(document.all){if(event.key()==13){self.save();self.hide();}}else{if (event.keyCode==13){self.save();self.hide();}}};element.appendChild(input);self.input=input;var close=DOM.element('IMG');close.src=URL.img+'site/enter.png';close.onclick=function(){self.save();self.hide();};close.addClass('close');element.appendChild(close);var clear=DOM.element('IMG');clear.src=URL.img+'site/trash.png';clear.onclick=function(){self.clear();self.hide();};clear.addClass('clear');element.appendChild(clear);document._toHideOnClick.push(self);},save:function(){var value=parseFloat(self.cell.value);if(isNaN(value)){value=0;}
var input=parseFloat(self.input.value);if(isNaN(input)){return;}
if(self.mode.innerHTML=='+'){value+=input;}else if(self.mode.innerHTML=='-'){value-=input;}else{value=input;}
value=Math.round(value,5);self.cell.setValue(value);Goals.save(self.cell.row.data.id,Format.date(self.cell.col.data.date,'Y-m-d'),{value:value});},clear:function(){self.cell.setValue('');Goals.save(self.cell.row.data.id,Format.date(self.cell.col.data.date,'Y-m-d'),{value:''});},set:function(cell){document.body.appendChild(self.element);self.element.alignTo(cell,'middle',true);self.element.adjoinTo(cell,'right',true);self.cell=cell;self.mode.innerHTML='+';self.input.value='';self.input.focus();Goals.Comment.hide();},hide:function(){self.element.remove();}});window.TIME_EXAMPLE="<p class=\"ex\">"+"\n{%LNG.eg}: <a href=\"#hh:mm\" class=\"script\" onclick=\"Goals.Time.input.value='{%time}'; return false;\">{%time}</a> "+"\n{%LNG.or} <a href=\"#20min\" class=\"script\" onclick=\"Goals.Time.input.value='20'; return false;\">20</a>{%LNG.min}"+"\n</p>";window.GoalsTime=GoalsNumber.extend({__construct:function(){parent.__construct();Template.assign('time',Format.date(new Date(),'H:i'));var ex=DOM.element('DIV',{innerHTML:Template.transform(TIME_EXAMPLE),appendTo:self.element});self.element.id='goals-time';self.element.addClass('goals-time-input');},save:function(){var value=parseFloat(self.cell.value);if(isNaN(value)){value=0;}
var input=self.toSeconds(self.input.value);if(self.mode.innerHTML=='+'){value+=input;}else if(self.mode.innerHTML=='-'){value-=input;}else{value=input;}
value=Math.round(value,5);self.cell.setValue(value);Goals.save(self.cell.row.data.id,Format.date(self.cell.col.data.date,'Y-m-d'),{value:value});},toSeconds:function(str){var hms_regexp=/^(\d{1,3})[\.\-:](\d{1,2})[\.\-:](\d{1,2})$/;var hm_regexp=/^(\d{1,3})[\.\-:](\d{1,2})$/;var m_regexp=/^(\d{1,2})$/;var hour=0,mins=0,secs=0;if(time=hms_regexp.exec(str)){hour=time[1];mins=time[2];secs=time[3];}else if(time=hm_regexp.exec(str)){hour=time[1];mins=time[2];secs=0;}else if(time=m_regexp.exec(str)){hour=0;mins=time[1];secs=0;}else{return;}
hour*=1;mins*=1;secs*=1;return hour*3600+mins*60+secs;}});window.Format=new Singletone({months_abbr:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],months:['January','February','March','April','May','June','July','August','September','October','November','December'],weekdays_abbr:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],weekdays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],date:function(date,format){if(!(date instanceof Date)){date=Date.fromString(date);}
var D={j:date.getDate(),w:date.getDay(),n:date.getMonth()+1,Y:date.getFullYear(),H:date.getHours(),i:date.getMinutes(),s:date.getSeconds()};D.d=D.j.toString().pad(2,'0');D.m=D.n.toString().pad(2,'0');D.H=D.H.toString().pad(2,'0');D.i=D.i.toString().pad(2,'0');D.s=D.s.toString().pad(2,'0');D.F=LNG['of_'+self.months[D.m-1]]||self.months[D.m-1];D.M=LNG[self.months_abbr[D.m-1]]||self.months_abbr[D.m-1];D.l=LNG[self.weekdays[D.w]]||self.weekdays[D.w];D.D=LNG[self.weekdays_abbr[D.w]]||self.weekdays_abbr[D.w];if(ENV.language=='ru'){D.l=D.l.toLowerCase();D.F=D.F.toLowerCase();}
var formatted='';for(var i=0;i<format.length;i++){var chr=format.substr(i,1);formatted=formatted.concat(D[chr]!=undefined?D[chr]:chr);}
return formatted;},dateRange:function(from,to,sep,format){var range='';if(!sep){sep=' - ';}
if(!format){format={d:'j',m:'M'};}
if(!format.dm){format.dm=ENV.language=='ru'?format.d+' '+format.m:format.m+' '+format.d;}
if(from.getMonth()==to.getMonth()){if(from.getDate()==to.getDate()){range=Format.date(from,format.dm);}else{if(ENV.language=='ru'){range=Format.date(from,format.d)+sep+Format.date(to,format.d)+' '+Format.date(from,format.m);}else{range=Format.date(from,format.dm)+sep+Format.date(to,format.d);}}}else{range=Format.date(from,format.dm)+sep+Format.date(to,format.dm);}
return range;},humanDate:function(date,today){if(!(date instanceof Date)){date=Date.fromString(date);}
if(today==undefined){today=new Date();}
var human_date='';if(today.getFullYear()==date.getFullYear()){if(today.getMonth()==date.getMonth()){var days=today.getDate()-date.getDate();if(days==0){human_date='today';}else if(days==-1){human_date='tomorrow';}else if(days==1){human_date='yesterday';}}}
if(!human_date){human_date=Format.date(date,'M j');}
return human_date;},time:function(str,seconds){var time=Date.parseTime(str);var hour=time.hour;var mins=time.mins;var secs=time.secs;var hour=hour.toString().pad(2,'0');var mins=mins.toString().pad(2,'0');if(secs!=undefined){secs=secs.toString().pad(2,'0');}
return hour+':'+mins+(seconds?':'+secs:'');},humanSize:function(size){i=0;iec=['B','KB','MB','GB','TB','PB','EB','ZB','YB'];while(size/1024>=1){size/=1024;i++;}
return Math.round(size,1)+' '+iec[i];}});Mohawk.UI.Calendar=new Class({table:null,month:0,year:0,__construct:function(){var today=new Date();self.table=self.buildMonth(today.getFullYear(),today.getMonth()+1);},buildMonth:function(year,month){var today=new Date();self.month=month;self.year=year;self.today=today;self.months=[{name:LNG.January,days:31},{name:LNG.February,days:Date.isLeapYear(year)?29:28},{name:LNG.March,days:31},{name:LNG.April,days:30},{name:LNG.May,days:31},{name:LNG.June,days:30},{name:LNG.July,days:31},{name:LNG.August,days:31},{name:LNG.September,days:30},{name:LNG.October,days:31},{name:LNG.November,days:30},{name:LNG.December,days:31}];var table=document.createElement('TABLE');table.onclick=function(event){event=Mohawk.DOM.event(event);event.stopPropagation();return false;};var caption=self.createCaption();table.appendChild(caption);var thead=self.createTHead();table.appendChild(thead);var tbody=self.createTBody();table.appendChild(tbody);return table;},createCaption:function(year,month){var caption=document.createElement('CAPTION');caption.setHTML(self.months[self.month-1].name+' '+self.year);return caption;},createTHead:function(){var thead=document.createElement('THEAD');var thead_row=document.createElement('TR');thead.appendChild(thead_row);for(var i=0;i<static.weekdays.length;i++){var cell=document.createElement('TH');cell.setHTML(static.weekdays[i].name);cell.addClass(static.weekdays[i].holiday?'holiday':'');thead_row.appendChild(cell);}
return thead;},createTBody:function(){var tbody=document.createElement('TBODY');var day_of_week=Date.getWeekday(1,self.month,self.year);var days_in_month=self.months[self.month-1].days;var row=document.createElement('TR');tbody.appendChild(row);for(var i=1;i<day_of_week;i++){var cell=document.createElement('TD');row.appendChild(cell);}
var i=1;for(;i<=days_in_month;i++){if((i+day_of_week-1)%7==1){row=document.createElement('TR');tbody.appendChild(row);}
var date=new Date(self.year,self.month-1,i);var cell=self.createCell(date);row.appendChild(cell);}
i=(days_in_month+day_of_week-1)%7;if(!i){i=7;}
for(;i<7;i++){var cell=document.createElement('TD');row.appendChild(cell);}
return tbody;},createCell:function(date){var cell=document.createElement('TD');cell.data={date:date};if(date.getDate()==self.today.getDate()&&date.getMonth()==self.today.getMonth()&&date.getFullYear()==self.today.getFullYear()){cell.addClass('today');}
cell.onmouseover=function(){cell.addClass('over');};cell.onmouseout=function(){cell.removeClass('over');};cell.innerHTML=date.getDate();return cell;},setDate:function(year,month){if(year instanceof Date){month=year.getMonth()+1;year=year.getFullYear();}
var table=self.buildMonth(year,month);if(self.table.parentNode){self.table.replace(table);}else{self.table=null;}
self.table=table;}});Mohawk.UI.Calendar.weekdays=[{name:LNG.mo,holiday:false},{name:LNG.tu,holiday:false},{name:LNG.we,holiday:false},{name:LNG.th,holiday:false},{name:LNG.fr,holiday:false},{name:LNG.sa,holiday:true},{name:LNG.su,holiday:true}];window.WeekPick=Mohawk.UI.Calendar.extend({buildMonth:function(year,month){var table=parent.buildMonth(year,month);table.addClass('calendar','rounded','shadowed');document._toHideOnClick.push(self);return table;},createCaption:function(year,month){var caption=document.createElement('CAPTION');caption.setHTML(self.months[self.month-1].name+' '+self.year);var prev=document.createElement('a');prev.addClass('prev');prev.setHTML('&larr;');prev.href='#prev-month';prev.onclick=function(){var month=self.month;var year=self.year;if(month==1){month=12;year--;}else{month--;}
self.setDate(year,month);return false;};var next=document.createElement('a');next.addClass('next');next.setHTML('&rarr;');next.href='#next-month';next.onclick=function(){var month=self.month;var year=self.year;if(month==12){month=1;year++;}else{month++;}
self.setDate(year,month);return false;};caption.appendChild(prev);caption.appendChild(next);return caption;},createCell:function(date){var cell=parent.createCell(date);cell.onclick=function(){Goals.Table.moveTo(date.addDay(1-(date.getDay()||7)));self.hide();};return cell;},hide:function(){self.table.remove();}});window.GOALS_STATS="<div class=\"weekly\">"+"\n    <p><strong>{%LNG.week}</strong>: {%this_week}</p>"+"\n    <p>{%LNG.past}: {%last_week}</p>"+"\n    <p>{%LNG.plan}:"+"\n    {%if week_plan.value !== undefined}"+"\n        <a href=\"#set-plan\" class=\"script\" onclick=\""+"\n            var value = prompt('{%LNG.Input_plan_week}', '{%week_plan.value}');"+"\n            if (value !== null) {"+"\n                {%if goal.type == 'time' || goal.type == 'timer'}"+"\n                value = Goals.Time.toSeconds(value);"+"\n                {%end}"+"\n                Goals.editPlan({%week_plan.id}, {goal: {%week_plan.goal}, value: value});"+"\n            } "+"\n            return false;\""+"\n        >{%if week_plan.value != '' && week_plan.value != null}{%week_plan.value}{%else}set{%end}</a>"+"\n    {%else}"+"\n        <a href=\"#set-plan\" class=\"script\" onclick=\""+"\n            var value = prompt('{%LNG.Input_plan_week}', '');"+"\n            if (value !== null) {"+"\n                {%if goal.type == 'time' || goal.type == 'timer'}"+"\n                value = Goals.Time.toSeconds(value);"+"\n                {%end}"+"\n                Goals.addPlan({goal: {%week_plan.goal}, startdate: '{%week_plan.startdate}', enddate: '{%week_plan.enddate}', value: value});"+"\n            } "+"\n            return false;\""+"\n        >{%LNG.set}</a>"+"\n    {%end}"+"\n    </p>"+"\n</div>"+"\n<div class=\"monthly\">"+"\n    <p><strong>{%LNG.month}</strong>: {%this_month}</p>"+"\n    <p>{%LNG.past}: {%last_month}</p>"+"\n    <p>{%LNG.plan}:"+"\n    {%if month_plan.value !== undefined}"+"\n        <a href=\"#set-plan\" class=\"script\" onclick=\""+"\n            var value = prompt('{%LNG.Input_plan_month}', '{%month_plan.value}'); "+"\n            if (value !== null) {"+"\n                {%if goal.type == 'time' || goal.type == 'timer'}"+"\n                value = Goals.Time.toSeconds(value);"+"\n                {%end}"+"\n                Goals.editPlan({%month_plan.id}, {goal: {%month_plan.goal}, value: value});"+"\n            } "+"\n            return false;\""+"\n        >{%if month_plan.value != '' && month_plan.value != null}{%month_plan.value}{%else}set{%end}</a>"+"\n    {%else}"+"\n        <a href=\"#set-plan\" class=\"script\" onclick=\""+"\n            var value = prompt('{%LNG.Input_plan_month}', '');"+"\n            if (value !== null) {"+"\n                {%if goal.type == 'time' || goal.type == 'timer'}"+"\n                value = Goals.Time.toSeconds(value);"+"\n                {%end}"+"\n                Goals.addPlan({goal: {%month_plan.goal}, startdate: '{%month_plan.startdate}', enddate: '{%month_plan.enddate}', value: value});"+"\n            } "+"\n            return false;\""+"\n        >{%LNG.set}</a>"+"\n    {%end}"+"\n    </p>"+"\n</div>";window.NO_GOALS="<p>{%LNG.Tab_empty}. {%LNG.You_can} <a href=\"#new-goal\" class=\"script\" onclick=\"Goals.Add.setData(); return false;\">{%LNG.add_goal}</a> {%LNG.or} <a href=\"#delete-tab\" class=\"script\" onclick=\"Tabs.remove(ENV.tab); return false;\">{%LNG.delete_this_tab}</a></p>"+"\n";window.GoalsWeek=new Class({day:null,build:function(){var frame=document.createElement('DIV');self.frame=frame;frame.ondragover=self.dragTitle;frame.ondrop=self.dropTitle;frame.ondragout=self.dragReset;frame.addClass('no-goals');var table=document.createElement('TABLE');self.table=table;frame.appendChild(table);var empty=DOM.element('div');empty.addClass('empty');empty.setHTML(Template.transform(NO_GOALS));frame.appendChild(empty);var head=document.createElement('THEAD');table.appendChild(head);var row=document.createElement('TR');head.appendChild(row);var tbody=document.createElement('TBODY');table.appendChild(tbody);var today=(new Date()).clearTime();var day=today.addDay(1-(today.getDay()||7));self.day=day.clone();var prev=false;for(var i=1;i<=7;i++,day=day.addDay()){var cell=self.createHeadCell(day,today);row.appendChild(cell);}
var first=DOM.element('TH');first.addClass('first');row.insertFirst(first);var prev=DOM.element('P');var prev_link=DOM.element('A');prev_link.addClass('script');prev_link.href='#prev';prev_link.setHTML(Format.dateRange(self.day.addDay(-7),self.day.addDay(-1),'&mdash;'));prev_link.onclick=function(){self.moveTo(self.day.addDay(-7));return false;};prev.setHTML('&larr;&nbsp;');prev.appendChild(prev_link);first.appendChild(prev);self.prev_link=prev_link;var last=DOM.element('TH');last.addClass('last');row.appendChild(last);var next=DOM.element('P');var next_link=DOM.element('A');next_link.href='#next';next_link.addClass('script');next_link.setHTML(Format.dateRange(self.day.addDay(7),self.day.addDay(13),'&mdash;'));next_link.onclick=function(){self.moveTo(self.day.addDay(7));return false;};next.setHTML('&nbsp;&rarr;');next.insertFirst(next_link);last.appendChild(next);self.next_link=next_link;var cal=DOM.element('IMG');cal.addClass('open-calendar');cal.src=URL.img+'site/calendar.png';cal.onclick=function(event){event=DOM.event(event);var calendar=self.calendar;if(!calendar){calendar=new WeekPick();calendar.today=new Date();self.calendar=calendar;}
if(calendar.table.parentNode&&calendar.table.parentNode.parentNode){calendar.hide();}else{last.appendChild(calendar.table);calendar.setDate(self.day.getFullYear(),self.day.getMonth()+1);}
DOM.stopEvent(event);};last.appendChild(cal);},moveTo:function(day){var today=new Date();var head=self.table.tHead.firstTag('TR').childNodes;var prev=false;self.day=day;for(var i=1;i<head.length-1;i++,day=day.addDay()){if(prev&&prev.getDate()==day.getDate()){day=new Date(day.valueOf()+3600*1000);}
var cell=self.createHeadCell(day,today);head[i].replace(cell);prev=new Date(day.valueOf());}
self.prev_link.setHTML(Format.dateRange(self.day.addDay(-7),self.day.addDay(-1),'&mdash;'));self.next_link.setHTML(Format.dateRange(self.day.addDay(7),self.day.addDay(13),'&mdash;'));self.setData();},setData:function(){var goals=self.table.tBodies[0].getElementsByTagName('tr');for(i=0;i<goals.length;i++){Goals.Table.editGoal(goals[i].data);}},createRow:function(data){var row=DOM.element('TR');row.id='goal-'+data.id;row.data=data;if(data.user==ENV.UID){row.addClass('own');}
var title=self.createTitleCell(data);row.appendChild(title);var head=self.table.tHead.firstTag('TR').childNodes;for(var i=1;i<head.length-1;i++){var col=head[i];var cell=self.createDataCell(row,col);row.appendChild(cell);}
var last=self.createLastCell(data);row.appendChild(last);return row;},createChart:function(data,container){container.setHTML('');var max,min=0,neg=false,values=[];var day=self.day.addDay(-21);for(var i=0;i<28;i++,day=day.addDay()){var date=Format.date(day,'Y-m-d');var value=Goals.getData(data.id,date).value;if(value===undefined||value===''){continue;}
value=parseFloat(value);if(data.type=='boolean'&&value===0){value=-1;}
if(max==undefined||max<value){max=value;}
if(min==undefined||min>value){min=value;}
if(value<0){neg=true;}
values.push(value);}
var log=(max-min)>1000;var scale=function(x){return x>0?Math.log(x):(x<0?-Math.log(-x):0);};if(log){max=scale(max);min=scale(min);}
var zero=max-min>0?-min/(max-min)*100:'0';foreach(values,function(i,val){if(log){val=scale(val);}
var col=DOM.element('SPAN');var height,bottom;if(max-min==0||val==0){height=1;bottom=0;}else{if(val>0){height=val/(max-min)*100;bottom=-min/(max-min)*100;}else{height=Math.abs(val)/(max-min)*100;bottom=(val-min)/(max-min)*100;col.addClass('neg');}}
col.style.height=height+'%';col.style.bottom=bottom+'%';col.style.left=i*2+'px';container.appendChild(col);});var axis=DOM.element('DIV');axis.addClass('axis');axis.style.bottom=zero+'%';container.appendChild(axis);},aggregate:function(data,container){function _aggregate(start,length,no_unit){var id=data.id;var max,min,sum=0,count=0,last=0;var end=start.addDay(length-1);var result=0;if(data.type=='boolean'){for(var day=start;day.le(end);day=day.addDay()){var date=Format.date(day,'Y-m-d');var value=Goals.getData(id,date).value;if(value===1){sum++;count++;}else if(value===0){count++;}}
result=count?sum/count:0;}else{for(var day=start;day.le(end);day=day.addDay()){var date=Format.date(day,'Y-m-d');var value=Goals.getData(id,date).value;if(value==undefined||value===''){continue;}
value=parseFloat(value);if(isNaN(value)){continue;}
if(max==undefined||max<value){max=value;}
if(min==undefined||min>value){min=value;}
sum+=value;count+=1;last=value;}
switch(data.aggregate){case'sum':result=sum;break;case'avg':result=sum/count;break;case'max':result=max||0;break;case'min':result=min||0;break;default:result=last;}}
if(result!=0){result=Math.round(result,1);if(data.type=='time'||data.type=='timer'){result=self.formatTime(result,'{%h}:{%m}');}
result=result.toString();if(result.length&&data.unit!==null&&data.unit.length&&!no_unit){if(data.prepend=='yes'){result='<small>'+data.unit+'</small> <b>'+result+'</b>';}else{result='<b>'+result+'</b> <small>'+data.unit+'</small>';}}else{result='<b>'+result+'</b>';}}else{if(result===0){result='<b>'+result+'</b>';}}
return result;}
var this_month_start=self.day.addDay(-self.day.getDate()+1);var today=(new Date()).clearTime();if(today.isBetween(self.day,self.day.addDay(6))){this_month_start=today.addDay(-today.getDate()+1);}
var last_month_start=this_month_start.addDay(-this_month_start.getDate());last_month_start=last_month_start.addDay(-last_month_start.getDate()+1);var last_week_start=self.day.addDay(-7);var this_month=_aggregate(this_month_start,this_month_start.getDaysInMonth(),true);var last_month=_aggregate(last_month_start,last_month_start.getDaysInMonth(),true);var this_week=_aggregate(self.day,7,true);var last_week=_aggregate(last_week_start,7,true);var week_start=self.day,week_end=self.day.addDay(6);var this_month_end=this_month_start.addDay(this_month_start.getDaysInMonth()-1);var week_plan={startdate:week_start.getId(),enddate:week_end.getId(),goal:data.id};var month_plan={startdate:this_month_start.getId(),enddate:this_month_end.getId(),goal:data.id};var plans=Data.plan[data.id];if(plans!=undefined){foreach(plans,function(i,plan){if(week_start.getId()==plan.startdate&&week_end.getId()==plan.enddate){week_plan.id=plan.id;if(data.type=='time'||data.type=='timer'){week_plan.value=self.formatTime(plan.value,'{%h}:{%m}');}else{week_plan.value=plan.value;}}
if(this_month_start.getId()==plan.startdate&&this_month_end.getId()==plan.enddate){month_plan.id=plan.id;month_plan.value=plan.value;if(data.type=='time'||data.type=='timer'){month_plan.value=self.formatTime(plan.value,'{%h}:{%m}');}else{month_plan.value=plan.value;}}});}
if(this_week||last_week||this_month||last_month||week_plan||month_plan){Template.assign('goal',data);Template.assign('this_week',this_week);Template.assign('last_week',last_week);Template.assign('this_month',this_month);Template.assign('last_month',last_month);Template.assign('week_plan',week_plan);Template.assign('month_plan',month_plan);container.setHTML(Template.transform(GOALS_STATS));}else{container.setHTML('');}},setPlan:function(row){var goal=row.data;var plans=Data.plan[goal.id];if(plans==undefined){return;}
var cells=row.getElementsByTagName('TD');var today=(new Date).clearTime();for(var i=0;i<cells.length;i++){var cell=cells[i];var day=cell.col.data.date;var day_plan=false;foreach(plans,function(i,plan){var start=Date.fromString(plan.startdate);var end=Date.fromString(plan.enddate);plan.period=end.daysFrom(start)+1;if(day.isBetween(start,end)&&(!day_plan||day_plan.period>plan.period)){day_plan=plan;return true;}});if(!day_plan){cell.plan='';cell.showPlan();continue;}
cell.plan=day_plan.value;if(goal.aggregate=='sum'||goal.aggregate=='avg'){if(day.lt(today)){cell.plan='';}else{var value=0,sum=0,start=Date.fromString(day_plan.startdate),end=Date.fromString(day_plan.enddate);for(var d=start;d.le(today);d=d.addDay()){value=parseFloat(Goals.getData(goal.id,d.getId()).value);if(isNaN(value)){value=0;}
sum+=value;}
var days_left=end.daysFrom(today);if(goal.aggregate=='sum'){cell.plan=(day_plan.value-sum)/days_left;}else{cell.plan=(day_plan.value*day_plan.period-sum)/days_left;}}
if(goal.type=='counter'){cell.plan=Math.ceil(cell.plan);if(cell.plan<0){cell.plan=0;}}else{cell.plan=Math.round(cell.plan,1);}}else{cell.plan=day_plan.value;}
cell.showPlan();}},createTitleCell:function(data){var cell=DOM.element('TH');cell.addClass('title');var wrap=DOM.element('DIV');wrap.addClass('wrap');cell.appendChild(wrap);var title=DOM.element('H2');if(!data.user||data.user==ENV.UID){var str_title=data.title||'???';var size=18;var max_len=12;if(str_title.length>max_len){size=Math.floor(max_len/str_title.length*size);if(size<12){size=12;}}
title.style.fontSize=size+'px';title.setHTML(htmlspecialchars(str_title));title.onclick=function(){Goals.Edit.setData(cell.parentNode.data);};}else{DOM.element('img',{src:URL.img+'site/compared-with.png',appendTo:title});DOM.element('a',{href:URL.home+'users/'+data.user_data.login+'/goals/',html:data.user_data.name,appendTo:title});}
wrap.appendChild(title);var drag=DOM.element('IMG');drag.src=URL.img+'site/move.gif';drag.addClass('drag');drag.ondragstart=function(){return false;};drag.Timeline=self;wrap.appendChild(drag);drag.onmousedown=function(event){event=DOM.event(event);if(event.button!=BTN_LEFT){return;}
self.clone=self.createClone(cell);var tabs=[self.frame];for(var i=0;i<Goals.Tabs.element.childNodes.length;i++){tabs.push(Goals.Tabs.element.childNodes[i]);};Dragdrop.setTarget.apply(Dragdrop,tabs);Dragdrop.pick(event,[self.clone]);return false;};return cell;},createLastCell:function(data){var cell=DOM.element('TH');cell.addClass('last');var total=DOM.element('DIV');total.addClass('total');cell.appendChild(total);self.aggregate(data,total);var chart=DOM.element('DIV');chart.addClass('chart');chart.onclick=function(){Goals.Edit.showChart(data);};cell.appendChild(chart);return cell;},createClone:function(cell){var clone=DOM.element('DIV');self.frame.appendChild(clone);clone.setHTML(cell.getElementsByTagName('H2')[0].innerHTML);clone.style.position='absolute';clone.style.left=cell.offsetLeft+'px';clone.style.top=cell.offsetTop+(cell.offsetHeight-clone.offsetHeight)/2+'px';clone.style.zIndex=10;clone.addClass('clone','rounded','draggable');clone.proto=cell;clone.ondrop=function(){clone.purge();};return clone;},dragTitle:function(event){event=DOM.event(event);event.preventDefault();var self=Goals.Table;var table=self.table;var y=event.cursor().y-self.frame.coordinates().y;var x=event.cursor().x-self.frame.offsetLeft;if(x>self.table.tHead.firstTag('TR').firstChild.offsetWidth){self.dragReset();return;}
var titles=self.table.tBodies[0].getElementsByClassName('title');var node=null;var first=false;if(y<titles[0].offsetTop+titles[0].offsetHeight/2){node=titles[0];first=true;}
for(var i=0;i<titles.length;i++){if(y>titles[i].offsetTop+titles[i].offsetHeight/2){node=titles[i];}
titles[i].removeClass('after','before');}
if(node){node.addClass(first?'before':'after');}
self.node=node;self.first=first;},dropTitle:function(event){event=DOM.event(event);var self=Goals.Table;var dragged_row=self.clone.proto.ancestorTag('TR');var marker_row=self.node.ancestorTag('TR');if(dragged_row!=marker_row){if(self.first){dragged_row.parentNode.insertFirst(dragged_row);}else{dragged_row.parentNode.insertAfter(dragged_row,marker_row);}}
Goals.sort();self.dragReset();},dragReset:function(){var self=Goals.Table;if(self.node){self.node.removeClass('after','before');}
self.sorting=false;self.node=null;self.before=null;},createHeadCell:function(day,today){var cell=document.createElement('TD');cell.data={date:day};cell.id=self.getId(day);var date=Format.date(day,ENV.language=='ru'?'j F':'F j');var week=Format.date(day,'D');var is_today=day.getFullYear()==today.getFullYear()&&day.getMonth()==today.getMonth()&&day.getDate()==today.getDate();cell.setHTML('<b>'+week+'</b><br />'+date);if(is_today){cell.addClass('today');}
var w=day.getDay();if(w==0||w==6){cell.addClass('weekend');}
return cell;},createDataCell:function(row,col){var id=row.data.id;var date=Format.date(col.data.date,'Y-m-d');var value=Goals.getData(id,date).value;var cell=DOM.element('TD');cell.id=self.getDataCellId(id,date);cell.row=row;cell.col=col;cell.onmousedown=function(){return false;};cell.onselect=DOM.stopEvent;if(col.hasClass('today')){cell.addClass('today');}
var wrap=DOM.element('DIV');cell.appendChild(wrap);wrap.addClass('wrap');cell.wrap=wrap;var comment=DOM.element('DIV');comment.addClass('comment');wrap.appendChild(comment);comment.onclick=function(event){event=DOM.event(event);event.stopPropagation();Goals.Comment.set(cell);};var data=Goals.getData(id,date);if(data.text){cell.addClass('commented');}
cell.showPlan=function(){};switch(row.data.type){case'numeric':var number=DOM.element('DIV');number.addClass('number');wrap.appendChild(number);cell.number=number;cell.onmousedown=DOM.stopEvent;cell.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();Goals.Number.set(cell);};cell.addUnit=function(value){var number=cell.number;var size=18;if(value.length>6){var size=Math.floor(7/value.length*18);if(size<8){size=8;}}
number.style.fontSize=size+'px';if(value<0){number.addClass('neg');}else{number.removeClass('neg');}
var unit=number.firstTag('SPAN');if(value.length&&cell.row.data.unit&&cell.row.data.unit.length){if(!unit){unit=DOM.element('SPAN');unit.addClass('unit');if(cell.row.data.prepend=='yes'){number.addClass('left');number.insertFirst(unit);}else{number.appendChild(unit);}}
unit.setHTML(htmlspecialchars(cell.row.data.unit));}else{if(unit){unit.purge();}}};cell.setValue=function(value){var value=value!=undefined?value.toString():'';cell.value=value;cell.number.setHTML(value);if(value===''){cell.showPlan();return;}else{cell.number.removeClass('plan');}
cell.addUnit(value);};cell.showPlan=function(){if(cell.value!=undefined&&cell.value!==''){return;}
var plan=cell.plan?cell.plan.toString():'';cell.number.setHTML(plan);cell.number.addClass('plan');cell.addUnit(plan);};cell.setValue(value);break;case'counter':var zero_enabled=false;cell.zero=function(){while(cell.getElementsByClassName('item').length){cell.getElementsByClassName('item')[0].purge();}
var img=DOM.element('IMG');img.addClass('zero');img.src=Data.icons[cell.row.data.icon_zero];img.onclick=function(event){event=DOM.event(event);event.stopPropagation();img.remove();cell.value='';Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{value:cell.value});};wrap.insertFirst(img);cell.value=0;};cell.increment=function(){if(cell.value===''&&zero_enabled){cell.zero();return;}
while(cell.getElementsByClassName('zero').length){cell.getElementsByClassName('zero')[0].purge();}
if(cell.value<=50){var img=DOM.element('IMG');img.addClass('item');img.src=Data.icons[cell.row.data.icon_item];img.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();img.remove();cell.value--;if(!cell.value&&zero_enabled){cell.zero();}
cell.showPlan();Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{value:cell.value});};wrap.appendChild(img);}
cell.value++;cell.showPlan();};cell.setValue=function(value){while(cell.getElementsByClassName('zero').length){cell.getElementsByClassName('zero')[0].purge();}
while(cell.getElementsByClassName('item').length){cell.getElementsByClassName('item')[0].purge();}
if(value==undefined||value===''){cell.value='';return;}
value=parseInt(value);if(zero_enabled){cell.zero();}
cell.value=0;for(var i=0;i<value;i++){cell.increment();}
cell.showPlan();};cell.showPlan=function(){while(cell.getElementsByClassName('plan').length){cell.getElementsByClassName('plan')[0].purge();}
for(var i=0;i<cell.plan-cell.value;i++){if(i>=50){break;}
var img=DOM.element('IMG');img.src=Data.icons[cell.row.data.icon_item];img.addClass('plan');img.setOpacity(0.2);img.appendTo(wrap);};};cell.onclick=function(){if(cell.row.data.user!=ENV.UID){return;}
cell.increment();Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{value:cell.value});};cell.setValue(value);break;case'boolean':cell.setValue=function(val){if(val===1||val===0){if(!cell.img){cell.img=DOM.element('IMG');wrap.appendChild(cell.img);}
if(val){cell.img.src=Data.icons[row.data.icon_true];}else{cell.img.src=Data.icons[row.data.icon_false];}
cell.value=val;}else{if(cell.img){cell.img.purge();cell.img=null;}
cell.value='';}};cell.iterate=function(){if(cell.value===1){cell.setValue(0);}else if(cell.value===0){cell.setValue('');}else{cell.setValue(1);}
Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{value:cell.value});};cell.onclick=function(){if(cell.row.data.user!=ENV.UID){return;}
cell.iterate();};cell.setValue(parseInt(value));break;case'time':var time=DOM.element('DIV');time.addClass('time');wrap.appendChild(time);cell.time=time;cell.onmousedown=DOM.stopEvent;cell.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();Goals.Time.set(cell);};cell.setValue=function(val){cell.value=val;var html='<span class="hours">{%h}</span>'
+'<span class="tick">:</span>'
+'<span class="mins">{%m}</span>'
+'<span class="secs">{%s}</span>';cell.time.setHTML(self.formatTime(val,html));};cell.showPlan=function(){if(cell.value!=undefined&&cell.value!==''){return;}
if(cell.plan==undefined||cell.plan===''){return;}
var plan=cell.plan?cell.plan.toString():'';var html='<span class="hours">{%h}</span>'
+'<span class="tick">:</span>'
+'<span class="mins">{%m}</span>'
+'<span class="secs">{%s}</span>';cell.time.setHTML(self.formatTime(plan,html));cell.time.addClass('plan');};cell.setValue(value);break;case'timer':var start=DOM.element('IMG');start.src=URL.img+'site/timer-start.png';start.addClass('timer','timer-start');wrap.appendChild(start);cell.start=start;var stop=DOM.element('IMG');stop.src=URL.img+'site/timer-pause.png';stop.addClass('timer','timer-stop','hidden');wrap.appendChild(stop);cell.stop=stop;var time=DOM.element('DIV');time.addClass('time');wrap.appendChild(time);cell.time=time;cell.onmousedown=DOM.stopEvent;cell.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();Goals.Time.set(cell);};cell.startTimer=function(start_time){if(!start_time){start_time=cell.timer_start||new Date();}
cell.timer_start=start_time;cell.timer_id=0;cell.addClass('active');cell.start.addClass('hidden');cell.stop.removeClass('hidden');var cell_value=cell.value||0;var timer_f=function(){if(!cell.hasClass('active')){return;}
var now=new Date();cell.setValue(cell_value+(now.valueOf()-cell.timer_start.valueOf())/1000);cell.timer_id=setTimeout(timer_f,100);};timer_f();};start.onmousedown=DOM.stopEvent;start.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();cell.startTimer();var start_time=Format.date(cell.timer_start,'Y-m-d H:i:s');Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{start:start_time});};cell.stopTimer=function(){cell.removeClass('active');cell.start.removeClass('hidden');cell.stop.addClass('hidden');clearTimeout(cell.timer_id);cell.timer_start=false;};stop.onmousedown=DOM.stopEvent;stop.onclick=function(event){if(cell.row.data.user!=ENV.UID){return;}
event=DOM.event(event);event.stopPropagation();cell.stopTimer();Goals.save(id,Format.date(cell.col.data.date,'Y-m-d'),{value:cell.value,start:null});};cell.setValue=function(val){cell.value=val;var html='<span class="hours">{%h}</span>'
+'<span class="tick">:</span>'
+'<span class="mins">{%m}</span>'
+'<span class="secs">{%s}</span>';cell.time.setHTML(self.formatTime(val,html)||'&nbsp;');cell.time.removeClass('plan');};cell.showPlan=function(){if(cell.value!=undefined&&cell.value!==''){return;}
if(cell.plan==undefined||cell.plan===''){return;}
var plan=cell.plan?cell.plan.toString():'';var html='<span class="hours">{%h}</span>'
+'<span class="tick">:</span>'
+'<span class="mins">{%m}</span>'
+'<span class="secs">{%s}</span>';cell.time.setHTML(self.formatTime(plan,html));cell.time.addClass('plan');};cell.setValue(value);if(data.start){cell.startTimer(Date.fromString(data.start));}
break;default:}
wrap.addClass(row.data.type);return cell;},formatTime:function(val,template){val=parseFloat(val);if(isNaN(val)){return'';}
var hours=Math.floor(val/3600);val-=hours*3600;var mins=Math.floor(val/60);var secs=Math.floor(val-mins*60);hours=hours.toString().pad(2,'0');mins=mins.toString().pad(2,'0');secs=secs.toString().pad(2,'0');Template.assign('h',hours);Template.assign('m',mins);Template.assign('s',secs);return Template.transform(template);},getId:function(date){return'day-'+(date instanceof Date?Format.date(date,'Y-m-d'):date);},getCell:function(date){return ID(self.getId(date));},getRowId:function(id){return'goal-'+id;},getRow:function(id){return ID(self.getRowId(id));},getDataCellId:function(id,date){return self.getRowId(id)+'-'+self.getId(date);},getDataCell:function(id,date){return ID(self.getDataCellId(id,date));},compareGoals:function(goal1,goal2){return parseInt(goal1.data.position)<parseInt(goal2.data.position);},placeGoal:function(row){if(self.compareGoals instanceof Function){var before=null;for(var i=0;i<self.table.tBodies[0].childNodes.length;i++){var child=self.table.tBodies[0].childNodes[i];if(child==row){continue;}
if(self.compareGoals(row,child)){before=child;break;}}
self.table.tBodies[0].insertBefore(row,before);}else{self.table.tBodies[0].appendChild(row,child);}},addGoal:function(data){var row=self.createRow(data);self.placeGoal(row);self.createChart(data,row.getElementsByClassName('chart')[0]);self.setPlan(row);self.frame.removeClass('no-goals');},editGoal:function(data){var row=self.createRow(data);self.table.tBodies[0].replaceChild(row,ID('goal-'+data.id));self.createChart(data,row.getElementsByClassName('chart')[0]);self.setPlan(row);},removeGoal:function(id){var row=ID('goal-'+id);Effects.vanish(row,function(){row.purge();if(!self.table.tBodies[0].childNodes.length){self.frame.addClass('no-goals');}});},removeGoals:function(){self.table.tBodies[0].purgeChildren();self.frame.addClass('no-goals');}});window.GoalsComment=new Class({element:null,__construct:function(){var element=DOM.element('DIV');element.id='goals-comment';element.addClass('rounded');element.onclick=DOM.stopEvent;self.element=element;var corner1=DOM.element('SPAN');corner1.addClass('corner-border');element.appendChild(corner1);var corner2=DOM.element('SPAN');corner2.addClass('corner-bg');element.appendChild(corner2);var close=DOM.element('IMG');close.src=URL.img+'site/ok.png';close.onclick=function(){self.hide();};close.addClass('close');element.appendChild(close);var textarea=FormsInterface.createInput('textarea','text','');element.appendChild(textarea);self.textarea=textarea;var text='Enter your comment here';textarea.onclick=DOM.stopEvent;textarea.onmousedown=DOM.stopEvent;textarea.onchange=function(){var date=Format.date(self.cell.col.data.date,'Y-m-d');Goals.save(self.cell.row.data.id,date,{text:this.value});};document._toHideOnClick.push(self);},set:function(cell){document.body.appendChild(self.element);var date=Format.date(cell.col.data.date,'Y-m-d');self.textarea.value=Goals.getData(cell.row.data.id,date).text||'';self.cell=cell;self.element.adjoinTo(cell,'bottom',true);self.element.alignTo(cell,'left',true);self.element.addClass('left','top');self.textarea.focus();Goals.Number.hide();},hide:function(){self.element.remove();}});Mohawk.UI.SortableList=Mohawk.UI.OrderedList.extend({node_margin:new Pixel(0,0),marker_size:{width:16,height:16},marker_class:'marker',orientation:'vertical',target:null,__construct:function(id,data){parent.__construct(id,data);self.EVENT_SORTED=self.id+'-sorted';self.EVENT_MOVED=self.id+'-moved';self.element.ondragover=function(event){event=DOM.event(event);var marker=this.object.findMarker(event);if(marker===false){this.object.removeMarker();}else{if(marker.after===true){this.object.setMarkerAfter(marker.node);}else{this.object.setMarkerBefore(marker.node);}}};self.element.ondragout=function(event){this.object.removeMarker();};self.element.ondrop=function(event){var self=this.object;var node=Dragdrop.events[0].element.proto;var moved=node.parentNode!=self.element;var marker=self.findMarker(event);if(marker){if(marker.after===true){self.element.insertBefore(node,marker.node.nextSibling);}else{self.element.insertBefore(node,marker.node);}
if(moved){Observer.fire(self.EVENT_MOVED,node,self.element);}else{Observer.fire(self.EVENT_SORTED,self.element.childNodes);}}
self.removeMarker();return marker;};},createNode:function(data){var node=parent.createNode(data);node.onmousedown=function(event){event=DOM.event(event);if(event.button!=BTN_LEFT){return;}
var clone=self.createClone(node);Dragdrop.setTarget(self.element);self.element.appendChild(clone);Dragdrop.pick(event,[clone]);return false;};return node;},createClone:function(node){var clone=node.cloneNode(true);clone.addClass(Dragdrop.css_class);clone.ondrop=function(){this.remove();};clone.onrelease=function(event){this.remove();};if(!self.movable){if(self.orientation=='vertical'){clone.dragX=false;}else{clone.dragY=false;}}
clone.style.position='absolute';clone.style.left=node.offsetLeft-self.node_margin.x+'px';clone.style.top=node.offsetTop-self.node_margin.y+'px';clone.style.width=node.offsetWidth+'px';clone.style.height=node.offsetHeight+'px';clone.setOpacity(0.75);clone.cloned=true;clone.proto=node;return clone;},findMarker:function(event){event=Mohawk.DOM.event(event);var marker=true;var last=false;var prev=false;var cur=event.cursor();for(var i=0;i<self.element.childNodes.length;i++){var child=self.element.childNodes[i];if(!child.cloned){last=child;var coord=child.coordinates();if(self.orientation=='vertical'){if(cur.y>coord.y-child.offsetHeight/2){prev=child;}else{return prev?{node:prev,after:false}:false;}}else{if(cur.x>coord.x-child.offsetWidth/2){prev=child;}else{return prev?{node:prev,after:false}:false;}}}}
if(self.orientation=='vertical'){return{node:last,after:cur.y>last.coordinates().y};}else{return{node:last,after:cur.x>last.coordinates().x};}},createMarker:function(x,y){if(!self.marker){var marker=document.createElement('DIV');marker.addClass(self.marker_class);marker.style.position='absolute';document.body.appendChild(marker);Dragdrop.bringToFront(marker);self.marker=marker;}
self.marker.style.left=x+'px';self.marker.style.top=y+'px';},setMarkerBefore:function(node){var x=node.coordinates().x-self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y-self.marker_size.height/2;self.createMarker(x,y);},setMarkerAfter:function(node){if(self.orientation=='vertical'){var x=node.coordinates().x+self.node_margin.x-self.marker_size.width/2;var y=node.coordinates().y+node.offsetHeight-self.marker_size.height/2;}else{var x=node.coordinates().x+self.node_margin.x+node.offsetWidth-self.marker_size.width/2;var y=node.coordinates().y-self.marker_size.height/2;}
self.createMarker(x,y);},removeMarker:function(){if(self.marker){self.marker.remove();self.marker=null;}}});window.GoalsTabs=Mohawk.UI.SortableList.extend({orientation:'horizontal',marker_class:'tabs-marker',marker_size:{width:16,height:16},editing:null,createNode:function(data){var node=parent.createNode(data);node.ondragover=function(){this.addClass('dragover');};node.ondragout=function(){this.removeClass('dragover');};node.ondrop=function(){Goals.edit(Goals.Table.clone.proto.parentNode.data.id,{tab:this.data.id});this.removeClass('dragover');};node.purgeChildren();if(ENV.user.valid){var btn_move=DOM.element('IMG');btn_move.src=URL.img+'site/move.png';btn_move.addClass('btn','move','default');btn_move.onmousedown=node.onmousedown;btn_move.appendTo(node);var title=DOM.element('A');title.href=URL['this']+'#tab-'+node.data.id;title.addClass('default');title.setHTML(data.title);title.appendTo(node);var btn_edit=DOM.element('IMG');btn_edit.src=URL.img+'site/edit.gif';btn_edit.addClass('btn','edit','default');btn_edit.appendTo(node);btn_edit.onclick=function(){self.hide();node.addClass('mode-editing');node.input.value=node.data.title;node.input.focus();self.editing=node;};var input=DOM.element('input',{type:'text'});input.id=self.id+'-input';input.addClass('editing');input.onkeypress=function(event){event=DOM.event(event);if(event.key()==13){Tabs.edit(node.data.id,{title:input.value});}};node.input=input;node.appendChild(input);var enter=DOM.element('IMG');enter.src=URL.img+'site/enter.png';enter.onclick=function(){Tabs.edit(node.data.id,{title:input.value});};enter.addClass('enter','editing');node.appendChild(enter);var trash=DOM.element('IMG');trash.src=URL.img+'site/trash.png';trash.onclick=function(){Tabs.remove(node.data.id);};trash.addClass('trash','editing');}else{var title=DOM.element('A');title.href=URL['home']+'premium/';title.addClass('disabled');title.setHTML(data.title);title.appendTo(node);title.onclick=show_premium;}
node.onmousedown=DOM.stopEvent;node.onclick=DOM.stopEvent;return node;},hide:function(){if(self.editing){self.editing.removeClass('mode-editing');self.editing=null;}},compareNodes:function(node1,node2){return node1.data.position<=node2.data.position;},select:function(node){if(self.current){self.current.removeClass('current');}
if(node){node.addClass('current');}
self.current=node;},unselect:function(){self.select(null);}});window.Shadow=new Singletone({element:null,__construct:function(){var shadow=document.createElement('DIV');shadow.addClass('hidden');shadow.id='shadow';self.element=shadow;},init:function(){document.body.appendChild(self.element);},hide:function(){self.element.addClass('hidden');},show:function(){self.element.removeClass('hidden');self.element.style.height=(document.body.scrollHeight||document.documentElement.scrollHeight)+'px';window.scrollTo(0,0);Dragdrop.bringToFront(self.element);}});window.AnchorObserver=new Singletone({timeout:10,current:'',events:{},__construct:function(){self.events={};self.timeout=500;},add:function(pattern,action){self.events[pattern]=action;},start:function(){self.current=window.location.hash.substring(1)
self.fire();self.test();},test:function(){var hash=window.location.hash.substring(1);if(hash!=self.current){self.current=hash;self.fire();}
setTimeout(function(){self.test.apply(self);},self.timeout);},fire:function(){foreach(self.events,function(pattern,event){var m=RegExp(pattern).exec(self.current);if(m){m.shift();event.apply(null,m);return false;}});}});Mohawk.Loader.extendLanguage({"Site_Title":"42Goals","Site_title":"42goals","SITE_TITLE":"42GOALS","site_title":"42goals","Site_Slogan":"A Simple Tool<Br \/> For Tracking Daily Goals","Site_slogan":"A simple tool<br \/> for tracking daily goals","SITE_SLOGAN":"A SIMPLE TOOL<BR \/> FOR TRACKING DAILY GOALS","site_slogan":"a simple tool<br \/> for tracking daily goals","Home_Title":"42Goals &mdash; A Simple Tool For Tracking Daily Goals","Home_title":"42goals &mdash; a simple tool for tracking daily goals","HOME_TITLE":"42GOALS &MDASH; A SIMPLE TOOL FOR TRACKING DAILY GOALS","home_title":"42goals &mdash; a simple tool for tracking daily goals","Goals":"Goals","GOALS":"GOALS","goals":"goals","Archive":"Archive","ARCHIVE":"ARCHIVE","archive":"archive","Settings":"Settings","SETTINGS":"SETTINGS","settings":"settings","Registration":"Registration","REGISTRATION":"REGISTRATION","registration":"registration","Password_Recovery":"Password Recovery","Password_recovery":"Password recovery","PASSWORD_RECOVERY":"PASSWORD RECOVERY","password_recovery":"password recovery","Email_Confirmation":"Email Confirmation","Email_confirmation":"Email confirmation","EMAIL_CONFIRMATION":"EMAIL CONFIRMATION","email_confirmation":"email confirmation","Desktop_Version":"Desktop Version","Desktop_version":"Desktop version","DESKTOP_VERSION":"DESKTOP VERSION","desktop_version":"desktop version","Welcome_Back":"Welcome Back","Welcome_back":"Welcome back","WELCOME_BACK":"WELCOME BACK","welcome_back":"welcome back","Remember_Me":"Remember Me","Remember_me":"Remember me","REMEMBER_ME":"REMEMBER ME","remember_me":"remember me","Sign_In":"Sign In","Sign_in":"Sign in","SIGN_IN":"SIGN IN","sign_in":"sign in","Sign_Out":"Sign Out","Sign_out":"Sign out","SIGN_OUT":"SIGN OUT","sign_out":"sign out","Forgot_Password":"Forgot Password?","Forgot_password":"Forgot password?","FORGOT_PASSWORD":"FORGOT PASSWORD?","forgot_password":"forgot password?","No_Confirmation":"No Confirmation Email?","No_confirmation":"No confirmation email?","NO_CONFIRMATION":"NO CONFIRMATION EMAIL?","no_confirmation":"no confirmation email?","Signed_As":"You Are Signed In As","Signed_as":"You are signed in as","SIGNED_AS":"YOU ARE SIGNED IN AS","signed_as":"you are signed in as","Go_To_Goals":"Go To Your Goals","Go_to_goals":"Go to your goals","GO_TO_GOALS":"GO TO YOUR GOALS","go_to_goals":"go to your goals","No_Account":"No Account","No_account":"No account","NO_ACCOUNT":"NO ACCOUNT","no_account":"no account","Get_One":"Get One","Get_one":"Get one","GET_ONE":"GET ONE","get_one":"get one","For_Free":"For Free","For_free":"For free","FOR_FREE":"FOR FREE","for_free":"for free","Our_Blog":"Our Blog","Our_blog":"Our blog","OUR_BLOG":"OUR BLOG","our_blog":"our blog","Follow_Us":"Follow Us On Twitter","Follow_us":"Follow us on Twitter","FOLLOW_US":"FOLLOW US ON TWITTER","follow_us":"Follow us on Twitter","On_Facebook":"On Facebook","ON_FACEBOOK":"ON FACEBOOK","on_facebook":"on facebook","on_Facebook":"on Facebook","People_Like_This":"People Like This","People_like_this":"People like this","PEOPLE_LIKE_THIS":"PEOPLE LIKE THIS","people_like_this":"people like this","Register":"Register","REGISTER":"REGISTER","register":"register","About_Us":"About Us","About_us":"About us","ABOUT_US":"ABOUT US","about_us":"about us","Donate":"Donate","DONATE":"DONATE","donate":"donate","Api":"Api","API":"API","api":"api","Privacy_Policy":"Privacy Policy","Privacy_policy":"Privacy policy","PRIVACY_POLICY":"PRIVACY POLICY","privacy_policy":"privacy policy","Mobile_Version":"Mobile Version","Mobile_version":"Mobile version","MOBILE_VERSION":"MOBILE VERSION","mobile_version":"mobile version","Blog":"Blog","BLOG":"BLOG","blog":"blog","Premium":"Premium","PREMIUM":"PREMIUM","premium":"premium","Feedback":"Feedback","FEEDBACK":"FEEDBACK","feedback":"feedback","Templates":"Templates","TEMPLATES":"TEMPLATES","templates":"templates","Interface":"Interface","INTERFACE":"INTERFACE","interface":"interface","Statistics":"Statistics","STATISTICS":"STATISTICS","statistics":"statistics","No_Charges":"No Charges","No_charges":"No charges","NO_CHARGES":"NO CHARGES","no_charges":"no charges","More":"More","MORE":"MORE","more":"more","Demo":"Demo","DEMO":"DEMO","demo":"demo","Corporate":"Corporate version","CORPORATE":"CORPORATE VERSION","corporate":"corporate version","Posts":"Posts","POSTS":"POSTS","posts":"posts","Communities":"Communities","COMMUNITIES":"COMMUNITIES","communities":"communities","Users":"Users","USERS":"USERS","users":"users","Profile":"Profile","PROFILE":"PROFILE","profile":"profile","Compare":"Compare","COMPARE":"COMPARE","compare":"compare","Plans_And_Pricing":"Plans & Pricing","Plans_and_Pricing":"Plans & Pricing","PLANS_AND_PRICING":"PLANS & PRICING","plans_and_pricing":"plans & pricing","User_Guide":"User Guide","USER_GUIDE":"USER GUIDE","user_guide":"user guide","Owner":"42goals","OWNER":"42GOALS","owner":"42goals","Submit":"Submit","SUBMIT":"SUBMIT","submit":"submit","Submitting":"Submitting","SUBMITTING":"SUBMITTING","submitting":"submitting","Done":"Done","DONE":"DONE","done":"done","Error":"Error occurred","ERROR":"ERROR OCCURRED","error":"error occurred","Cancel":"Cancel","CANCEL":"CANCEL","cancel":"cancel","Del":"Delete","DEL":"DELETE","del":"delete","Building_Interface":"Building Interface","Building_interface":"Building interface","BUILDING_INTERFACE":"BUILDING INTERFACE","building_interface":"building interface","Almost_There":"Almost There...","Almost_there":"Almost there...","ALMOST_THERE":"ALMOST THERE...","almost_there":"almost there...","Need_Premium":"To Use This Feature You Need A Premium Account","Need_premium":"To use this feature you need a premium account","NEED_PREMIUM":"TO USE THIS FEATURE YOU NEED A PREMIUM ACCOUNT","need_premium":"To use this feature you need a premium account","Know_More":"Know More","Know_more":"Know more","KNOW_MORE":"KNOW MORE","know_more":"know more","No_Thanks":"No, Thanks","No_thanks":"No, thanks","NO_THANKS":"NO, THANKS","no_thanks":"no, thanks","Site_Keywords":"Track Goals, Daily Goals, Habits, Productivity, Self-Motivation, Personal Management, Time Tracking","Site_keywords":"Track goals, daily goals, habits, productivity, self-motivation, personal management, time tracking","SITE_KEYWORDS":"TRACK GOALS, DAILY GOALS, HABITS, PRODUCTIVITY, SELF-MOTIVATION, PERSONAL MANAGEMENT, TIME TRACKING","site_keywords":"track goals, daily goals, habits, productivity, self-motivation, personal management, time tracking","Site_Description":"42Goals - A Simple Tool For Tracking Daily Goals","Site_description":"42goals - a simple tool for tracking daily goals","SITE_DESCRIPTION":"42GOALS - A SIMPLE TOOL FOR TRACKING DAILY GOALS","site_description":"42goals - a simple tool for tracking daily goals","Title_403":"Authorization is required","TITLE_403":"AUTHORIZATION IS REQUIRED","title_403":"Authorization is required","Title_404":"Page is not found","TITLE_404":"PAGE IS NOT FOUND","title_404":"Page is not found","Error_403":"You need to authorize to access this page","ERROR_403":"YOU NEED TO AUTHORIZE TO ACCESS THIS PAGE","error_403":"You need to authorize to access this page","Error_404":"Unfortunately, a page with such an address is not found","ERROR_404":"UNFORTUNATELY, A PAGE WITH SUCH AN ADDRESS IS NOT FOUND","error_404":"Unfortunately, a page with such an address is not found"})
document.addLoader(function(){if(document.body.id!='goals-page'){return;}
window.Goals=new GoalsApi;Shadow.init();Goals.Tabs=new GoalsTabs('goals-tabs',Data.tabs);document._toHideOnClick.push(Goals.Tabs);ID('goals-tabs').replace(Goals.Tabs.element);if(Goals.Tabs.getNode(ENV.tab)){Goals.Tabs.select(Goals.Tabs.getNode(ENV.tab));}
window.Tabs=new TabsApi;Observer.add('tab-added',function(item){Data.tabs.push(item);Goals.Tabs.addNode(item);});Observer.add('tab-edited',function(item){var id=-1;foreach(Data.tabs,function(i,tab){if(tab.id==item.id){id=i;return false;}});if(id>0){Data.tabs[id]=item;}else{Data.tabs.push(item);}
Goals.Tabs.hide();Goals.Tabs.editNode(Goals.Tabs.getNode(item.id),item);});Observer.add('tab-removed',function(id){Goals.Tabs.removeNode(Goals.Tabs.getNode(id));window.location.hash='';});Observer.add(Goals.Tabs.EVENT_SORTED,function(){Tabs.sort();});Goals.Add=new GoalsPageAdd;Goals.Edit=new GoalsPageEdit;Goals.Table=new GoalsWeek;Goals.Chart=new GoalsChart;Goals.Comment=new GoalsComment;Goals.Number=new GoalsNumber;Goals.Time=new GoalsTime;Goals.Table.build();ID('frame').replace(Goals.Table.frame);Goals.Table.frame.id='frame';Goals.Table.table.id='data';AnchorObserver.add('(?:(?:tab-(\\d+))|(all-goals))?',function(id,all_goals){var tab=null;if(!!all_goals||!ENV.user.valid){ENV.tab=0;}else if(!!id){ENV.tab=id;tab=Goals.Tabs.getNode(id);if(!tab){return;}}else{tab=Goals.Tabs.element.firstChild;if(tab){ENV.tab=tab.data.id;}else{ENV.tab=0;}}
Progress.load(LNG.Loading_tab);if(tab){Goals.Tabs.select(tab);ID('all-goals').removeClass('selected');}else{Goals.Tabs.unselect();ID('all-goals').addClass('selected');}
Goals.Table.removeGoals();foreach(Data.goals,function(i,goal){if(!ENV.tab||goal.tab==ENV.tab){Goals.Table.addGoal(goal);}});Progress.done(LNG.Done,true);});AnchorObserver.start();Observer.add('goal-added',function(item){Data.goals.push(item);Goals.Table.addGoal(item);Goals.Add.hide();});Observer.add('goal-edited',function(item){var ind=-1;foreach(Data.goals,function(i,goal){if(goal.id==item.id){ind=i;return false;}});var moved=ENV.tab&&item.tab!==undefined&&item.tab!=ENV.tab;var archived=!!item.archived;if(!archived){if(ind>=0){Data.goals[ind]=item;}else{Data.goals.push(item);}}
if(moved||archived){Goals.Table.removeGoal(item.id);}else{Goals.Table.editGoal(item);}
if(archived){Data.goals.splice(ind,1);}
Goals.Edit.hide();});Observer.add('goals-sorted',function(item){foreach(Data.goals,function(i,goal){foreach(item,function(j,data){if(goal.id==data.id){Data.goals[i].position=data.position;return false;}});});});Observer.add('goal-removed',function(item){var ind=-1;foreach(Data.goals,function(i,goal){if(goal.id==item.id){ind=i;return false;}});Data.goals.splice(ind,1);Goals.Table.removeGoal(item);Goals.Edit.hide();});Observer.add('form-submitted',function(data){if(!data.id){data.position=Goals.Table.table.tBodies[0].childNodes.length;Goals.add(data);}else{Goals.edit(data.id,data);}});Observer.add(Goals.Add.EVENT_SET,function(){ID('goals-table').addClass('hidden');Goals.Edit.hide(true);});Observer.add(Goals.Edit.EVENT_SET,function(){ID('goals-table').addClass('hidden');Goals.Add.hide(true);});Observer.add(Goals.Add.EVENT_HIDDEN,function(){ID('goals-table').removeClass('hidden');});Observer.add(Goals.Edit.EVENT_HIDDEN,function(){ID('goals-table').removeClass('hidden');});});
document.addLoader(function(){if(document.body.id!='report-page'){return;}
Goals={getData:function(id,date){if(date in Data.data){return{value:parseFloat(Data.data[date].value)};}else{return{value:undefined};}}};graph=new Singletone({draw:function(id,type,group,period,w,h){self.goal=Object.clone(Data.goal);self.setAggregate();self.group=group;self.setPeriod(period);var data=[];if(group=='year'){var grouped=self.getBooleanData();data=[['All time',[grouped[0].value,grouped[1].value],'All time']];}else{var grouped=self.getGroupedData();if(type=='pie'){foreach(grouped,function(i,val){data.push([val.extended,[val.value,1-val.value],val.title]);});}else{foreach(grouped,function(i,val){data.push([val.extended,val.value,val.title]);});}}
if(type=='pie'){chart.pie(id,data,w,h);}else if(type=='bar'){chart.bar(id,data,w,h);}else if(type=='line'){chart.line(id,data,w,h);}},draw_barline:function(id,w,h){self.goal=Object.clone(Data.goal);self.setAggregate();var data={bar:[],line:[]};self.group='month';self.setPeriod('year');var grouped=self.getGroupedData();foreach(grouped,function(i,val){data.bar.push([val.extended,val.value,val.title]);});self.group='day';self.setPeriod('year');var grouped=self.getGroupedData();foreach(grouped,function(i,val){data.line.push([val.extended,val.value,val.title,val.month]);});chart.barline(id,data,w,h);},draw_stacked_area:function(id,w,h){self.goal=Object.clone(Data.goal);self.setAggregate();var data=[];self.group='day';foreach([7,8],function(i,m){self.start=Date.fromString('2010-'+m.toString().pad(2,'0')+'-01');self.end=self.start.addDay(self.start.getDaysInMonth()-1);var grouped=self.getGroupedData();var data2=[];foreach(grouped,function(j,val){data2.push([val.extended,val.value,val.title,val.month]);});data.push(data2);});chart.stacked_area(id,data,w,h);},setPeriod:function(period){var earliest=Date.fromString(Object.keys(Data.data).sort()[0]);var start;var end=Date.fromString(Data.today).addDay(7);var today=new Date();if(end.gt(today)){end=today;}
switch(period){case'week':start=end.addDay(-7);break;default:case'month':start=end.addDay(-31);break;case'quarter':start=end.addDay(-122);break;case'year':start=end.addDay(-366);break;}
if(start.lt(earliest)){start=earliest;}
self.start=start;self.end=end;},setAggregate:function(){var aggregate=function(){};if(self.goal.type=='boolean'){self.goal.aggregate='boolean';}
switch(self.goal.aggregate){default:case'sum':aggregate=function(array){var sum=0;for(var i=0;i<array.length;i++){sum+=array[i];}
return sum;};break;case'min':aggregate=function(array){var min;for(var i=0;i<array.length;i++){if(min==undefined||min>array[i]){min=array[i];}}
return min;};break;case'max':aggregate=function(array){var max=undefined;for(var i=0;i<array.length;i++){if(max==undefined||max<array[i]){max=array[i];}}
return max;};break;case'avg':aggregate=function(array){var sum=0;for(var i=0;i<array.length;i++){sum+=array[i];}
return sum/i;};break;case'boolean':aggregate=function(array){var yes=0;var no=0;for(var i=0;i<array.length;i++){if(array[i]===1){yes++;}else if(array[i]===0){no++;}}
return(yes+no>0)?yes/(yes+no):0;};break;}
self.aggregate=aggregate;},getGroupedData:function(){switch(self.group){default:case'day':return self.groupByDay();case'week':return self.groupByWeek();case'weekday':return self.groupByWeekDay();case'month':return self.groupByMonth();}},getBooleanData:function(){var values=[{extended:'no',title:'no',value:0,plan:'-'},{extended:'yes',title:'yes',value:0,plan:'-'}];for(var day=self.start;day.le(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,Format.date(day,'Y-m-d')).value;if(value===1){values[1].value++;}else if(value===0){values[0].value++;}}
return values;},getAccumulatedData:function(){var grouped=[];var plans=[];if(!self.goal.day_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var plan={};plan.start=Date.fromString(row.startdate);plan.end=Date.fromString(row.enddate);plan.period=plan.end.daysFrom(plan.start)+1;if(self.goal.aggregate=='sum'){plan.value=row.value+' in '+plan.period+'days';}else{plan.value=row.value;}
plans.push(plan);});}
self.goal.day_plans=plans;}else{plans=self.goal.day_plans;}
var value=0,min,max;for(var day=self.start;day.le(self.end);day=day.addDay()){var actual=Goals.getData(self.goal.id,Format.date(day,'Y-m-d')).value;if(self.goal.aggregate==''){value=actual||value;}else{value+=actual||0;}
if((min===undefined||min<actual)&&actual!==''){min=actual;}
if((max===undefined||max>actual)&&actual!==''){max=actual;}
var row={};row.value=value;row.title=Format.date(day,'m/j');row.extended=Format.date(day,'l, F j');var day_plan=false;foreach(plans,function(i,plan){if(day.isBetween(plan.start,plan.end)&&(!day_plan||day_plan.period>plan.period)){day_plan=plan;return true;}});row.plan=day_plan?day_plan.value:'-';grouped.push(row);}
self.min=min;self.max=max;return grouped;},groupByDay:function(){var grouped=[];var plans=[];if(!self.goal.day_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var plan={};plan.start=Date.fromString(row.startdate);plan.end=Date.fromString(row.enddate);plan.period=plan.end.daysFrom(plan.start)+1;if(self.goal.aggregate=='sum'){plan.value=row.value+' in '+plan.period+'days';}else{plan.value=row.value;}
plans.push(plan);});}
self.goal.day_plans=plans;}else{plans=self.goal.day_plans;}
var min,max;self.start=self.start.addDay(1-self.start.getDate());self.end.setDate(self.end.getDaysInMonth());for(var day=self.start;day.le(self.end);day=day.addDay()){var row={};var day_id=day.getId();var actual=Goals.getData(self.goal.id,day_id).value;row.value=actual||0;row.title=Format.date(day,'j');row.month=Format.date(day,'m');row.extended=Format.date(day,'l, F j');if((min===undefined||min<actual)&&actual!==''){min=actual;}
if((max===undefined||max>actual)&&actual!==''){max=actual;}
var day_plan=false;foreach(plans,function(i,plan){if(day.isBetween(plan.start,plan.end)&&(!day_plan||day_plan.period>plan.period)){day_plan=plan;return true;}});row.plan=day_plan?day_plan.value:'-';grouped.push(row);}
self.min=min;self.max=max;return grouped;},groupByWeekDay:function(){var grouped=[{value:[],title:'Sun',extended:'Sunday','plan':''},{value:[],title:'Mon',extended:'Monday','plan':''},{value:[],title:'Tue',extended:'Tueday','plan':''},{value:[],title:'Wed',extended:'Wednesday','plan':''},{value:[],title:'Thu',extended:'Thursday','plan':''},{value:[],title:'Fri',extended:'Friday','plan':''},{value:[],title:'Sat',extended:'Saturday','plan':''}];for(var day=self.start;day.le(self.end);day=day.addDay()){grouped[day.getDay()].value.push(Goals.getData(self.goal.id,day.getId()).value||0);}
for(var i=0;i<grouped.length;i++){grouped[i].value=self.aggregate(grouped[i].value);}
grouped.push(grouped.shift());return grouped;},groupByWeek:function(){var plans=[];if(!self.goal.week_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var period=Date.fromString(row.enddate).daysFrom(Date.fromString(row.startdate))+1;if(period!=7){return;}
var plan={};plan.startdate=row.startdate;plan.value=row.value;plans.push(plan);});}
self.goal.week_plans=plans;}else{plans=self.goal.week_plans;}
var grouped=[];var week_start=self.start;var values=[];var prev_month=null;for(var day=self.start,week=day.getWeek();day.le(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,day.getId()).value||0;if(day.getWeek(1)!=week){var row={};row.value=self.aggregate(values);var month=Format.date(week_start,'M');row.title=month!=prev_month?month:'';prev_month=month;row.extended=Format.dateRange(week_start,day.addDay(-1),' &ndash; ');var week_plan=false;foreach(plans,function(i,plan){if(week_start.getId()==plan.startdate){week_plan=plan;return true;}});row.plan=week_plan?week_plan.value:'-';grouped.push(row);week=day.getWeek(1);week_start=day;values=[];}else{values.push(value);}}
if(values.length){var row={};row.value=self.aggregate(values);var month=Format.date(week_start,'M');row.title=month!=prev_month?month:'';row.extended=Format.dateRange(week_start,day.addDay(-1),' &ndash; ');var week_plan=false;foreach(plans,function(i,plan){if(week_start.getId()==plan.startdate){week_plan=plan;return true;}});row.plan=week_plan?week_plan.value:'-';grouped.push(row);}
return grouped;},groupByMonth:function(){var plans=[];if(!self.goal.week_plans){if(Data.plan[self.goal.id]){foreach(Data.plan[self.goal.id],function(i,row){var start=Date.fromString(row.startdate);if(start.getDate()!=1){return;}
var period=Date.fromString(row.enddate).daysFrom(start)+1;if(period!=start.getDaysInMonth()){return;}
var plan={};plan.month=start.getMonth();plan.value=row.value;plans.push(plan);});}
self.goal.week_plans=plans;}else{plans=self.goal.week_plans;}
var grouped=[];var values=[];for(var day=self.start,month=day.getMonth();day.lt(self.end);day=day.addDay()){var value=Goals.getData(self.goal.id,day.getId()).value||0;if(day.getMonth()!=month){var row={};row.value=self.aggregate(values);row.title=Format.date(day.addDay(-1),'M');row.extended=Format.date(day.addDay(-1),'F');var month_plan=false;foreach(plans,function(i,plan){if(month==plan.month){month_plan=plan;return true;}});row.plan=month_plan?month_plan.value:'-';grouped.push(row);month=day.getMonth();values=[];}else{values.push(value);}}
if(values.length){var row={};row.value=self.aggregate(values);row.title=Format.date(day.addDay(-1),'M');row.extended=Format.date(day.addDay(-1),'F');var month_plan=false;foreach(plans,function(i,plan){if(month==plan.month){month_plan=plan;return true;}});row.plan=month_plan?month_plan.value:'-';grouped.push(row);}
return grouped;}});chart={pie:function(id,data,w,h){var vis=new pv.Panel().canvas(id).width(w).height(h);var pie=vis.add(pv.Wedge).data([]).bottom(w/2).left(w/2).angle(function(d){return d*2*Math.PI});var r=1,p=0,q=w/2/data.length,g=1;foreach(data,function(i,val){p=r;r+=q;var t=1,a=0;pie.add(pv.Wedge).data(pv.normalize(val[1])).innerRadius(p).outerRadius(r-g).title(function(d){return d}).add(pv.Label).left(w/2).bottom((r+p)/2+w/2-10).textAngle(0).textStyle('#fff').text(function(d){if(t){t=0;return val[0];}else{return'';}});});vis.root.render();},line:function(id,data,w,h){var max,min;var n=0;foreach(data,function(i,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});min=Math.min(0,min);var
x=pv.Scale.ordinal(data).splitBanded(0,w,4/5),y=pv.Scale.linear(min,max).range(0,h-100);var vis=new pv.Panel().canvas(id).width(w).height(h).bottom(20).left(30).right(5).top(5);vis.add(pv.Rule).data(y.ticks()).visible(function(){return!(this.index%2)}).bottom(function(d){return Math.round(y(d))-.5}).strokeStyle("#eee").anchor("left").add(pv.Label).text(function(d){return d.toFixed(1)});vis.add(pv.Line).data(data).left(function(d){return x(d[0])}).bottom(function(d){return y(d[1])}).lineWidth(1).add(pv.Dot).size(1);vis.render();},bar:function(id,data,w,h){var max,min;var n=0;foreach(data,function(i,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});min=Math.min(0,min);var
x=pv.Scale.linear(min,max).range(0,w);y=pv.Scale.ordinal(data).splitBanded(0,h,4/5);var vis=new pv.Panel().canvas(id).width(w).height(h).bottom(20).left(30).right(5).top(5);var bar=vis.add(pv.Bar).data(data).height(y.range().band).left(0).top(function(d){return y(d[0])}).width(function(d){return x(d[1])}).title(function(d){return d[1]});bar.anchor('left').add(pv.Label).textStyle("#666").data(data).textBaseline('middle').textAlign('right').textMargin(5).text(function(d){return d[2]});vis.add(pv.Rule).data(x.ticks()).left(function(d){return Math.round(x(d))-0.5}).bottom(0).strokeStyle(function(d){return d==0?'#666':'none'}).add(pv.Rule).height(5).strokeStyle("#666").anchor("right").add(pv.Label).text(function(d){return Math.round(d*100)+'%'}).textStyle("#666");vis.render();},column:function(id,data,w,h){var max,min;var n=0;foreach(data,function(i,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});min=Math.min(0,min);var
x=pv.Scale.ordinal(data).splitBanded(0,w,4/5),y=pv.Scale.linear(min,max).range(0,h-100);var vis=new pv.Panel().canvas(id).width(w).height(h).bottom(20).left(30).right(5).top(5);var bar=vis.add(pv.Bar).data(data).left(function(d){return x(d[0])}).width(x.range().band).bottom(function(d){var bh=y(d[1]);return(d[1]>=0?y(min):-bh)}).height(function(d){var bh=y(d[1])-y(min);return Math.abs(bh)}).title(function(d){return d[1]});bar.anchor('bottom').add(pv.Label).textStyle("#666").data(data).textBaseline('top').textAlign('center').textMargin(5).text(function(d){return d[2]})
vis.add(pv.Rule).data(y.ticks()).bottom(function(d){return Math.round(y(d))-0.5}).strokeStyle(function(d){return d==0?'#666':'none'}).add(pv.Rule).width(5).strokeStyle("#666").anchor("left").add(pv.Label).text(function(d){return Math.round(d*100)+'%'}).textStyle("#666");vis.render();},barline:function(id,data,w,h){var bar_data=data.bar;var line_data=data.line;var vis=new pv.Panel().canvas(id).width(w).height(h).bottom(20).left(30).right(5).top(5);var data=bar_data;var max,min;var n=0;foreach(data,function(i,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});min=Math.min(0,min);var
x2=pv.Scale.ordinal(data).splitBanded(0,w,4/5),y2=pv.Scale.linear(min,max).range(0,h-100);var bar=vis.add(pv.Bar).data(data).left(function(d){return x2(d[0])}).width(x2.range().band).bottom(function(d){var bh=y2(d[1]);return(d[1]>=0?y2(min):-bh)}).height(function(d){var bh=y2(d[1])-y2(min);return Math.abs(bh)}).title(function(d){return d[1]});bar.anchor('bottom').add(pv.Label).textStyle("#666").data(data).textBaseline('top').textAlign('center').textMargin(5).text(function(d){return d[2]});var data=line_data;var max=undefined,min=undefined;var n=0;foreach(data,function(i,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});min=Math.min(0,min);max*=2;var
x=pv.Scale.ordinal(data).splitBanded(0,w,8/9),y=pv.Scale.linear(min,max).range(0,h-100);vis.add(pv.Line).data(data).left(function(d){return x(d[0])}).bottom(function(d){return y(d[1])}).fillStyle("rgb(121,173,210)").lineWidth(2).interpolate('basis').strokeStyle('#eee');vis.render();},stacked_area:function(id,data,w,h){var vis=new pv.Panel().canvas(id).width(w).height(h).bottom(20).left(30).right(5).top(5);var max=undefined,min=undefined;var n=0;foreach(data,function(i,col){foreach(col,function(j,row){var value=row[1];if(max===undefined||max<value){max=value;}
if(min===undefined||min>value){min=value;}});});min=Math.min(0,min);var
x=pv.Scale.linear(1,31).range(0,w),y=pv.Scale.linear(min,max).range(0,h);vis.add(pv.Rule).data(x.ticks()).visible(function(d){return d}).left(x).bottom(-5).height(5).anchor("bottom").add(pv.Label).text(x.tickFormat);var colors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];foreach(data,function(i,row){vis.add(pv.Line).data(row).left(function(d){return x(d[2])}).bottom(function(d){if(d===undefined){return 0}else{return y(d[1])}}).strokeStyle(function(){return colors[i]}).interpolate('basis');});vis.add(pv.Rule).data(y.ticks(3)).bottom(y).strokeStyle(function(d){return(d?"rgba(128,128,128,.2)":"#000")}).anchor("left").add(pv.Label).text(y.tickFormat);vis.render();}};graph.draw_barline('graph1',500,250);graph.draw_stacked_area('graph2',200,100);graph.draw('graph3','bar','weekday','year',200,200);});
window.FormProcessor=new Class({api:false,method:false,form:false,submit:function(form){self.form=form;var req=new Ajax(self.api||form.action,self.method||Ajax.METHOD_POST);req.responseHandler=function(req){self.responseHandler.apply(self,[req]);};req.send(form.getData());self.doAfterSubmit(form);return false;},doAfterSubmit:function(){Progress.load(LNG.Submitting||'Submitting');},responseHandler:function(req){if(req.data.error){self.errorHandler.apply(self,[req]);}else{self.successHandler.apply(self,[req]);}},successHandler:function(req){Progress.done(LNG.Done||'Done',true);},errorHandler:function(req){Progress.done(LNG.Error||'Error',true);}});window.CommonFormProcessor=FormProcessor.extend({template:false,doAfterSubmit:function(){parent.doAfterSubmit();foreach(self.form.getElementsByClassName('error'),function(){this.remove();});},successHandler:function(req){parent.successHandler(req);if(self.template){Template.assign('data',req.data.item);var div=document.createElement('DIV');div.id=self.form.id;div.className='answer';div.innerHTML=Template.transform(self.template);self.form.parentNode.replaceChild(div,self.form);}},errorHandler:function(req){parent.errorHandler(req);var error=req.data.error;foreach(error,function(name){var input=self.form['data['+name+']'];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});if(error.captcha&&ID('captcha')){var img=ID('captcha');var d=new Date;var uid=''+d.getHours()+d.getMinutes()+d.getSeconds()+d.getMilliseconds();img.src=img.src.replace(new RegExp('(\\?\\d+)?$'),'?'+uid);}}});window.REGISTRATION_SUCCESS="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Спасибо, {%data.name}! Ваша регистрация завершена."+"\n    <br />После подтверждения вашего адреса эл. почты, вы можете войти в свой аккаунт."+"\n    <br />Проверьте свою почту: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>"+"\n{%elseif ENV.language == 'fr'}"+"\n    Merci, {%data.name}! Votre inscription est terminée."+"\n    <br />Après confirmation de votre e-mail, vous pouvez accéder à votre compte."+"\n    <br />Vérifiez votre email: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>"+"\n{%else}"+"\n    Thank you, {%data.name}! Your registration is completed."+"\n    <br />After confirming your email, you can enter your account."+"\n    <br />Check your email: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>"+"\n{%end}"+"\n</p>";window.REGISTRATION_EMAIL="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Мы переслали письмо с подтверждением на ваш адрес: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>."+"\n    Если вы на нашли его во входящих письмах, проверьте папку СПАМ."+"\n{%elseif ENV.language == 'fr'}"+"\n    Nous avons renvoyé une lettre de confirmation de votre email: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>."+"\n    Si vous avez ne l'avez pas dans votre boîte de réception, vérifiez le dossier SPAM."+"\n{%else}"+"\n    We have resent you a confirmation letter to your email: <a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>."+"\n    If you have do not have it in your INBOX, check the SPAM folder."+"\n{%end}"+"\n</p>";window.RECOVERY_SUCCESS="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Мы выслали письмо с инструкциями по восстановлению пароля на ваш адрес."+"\n    <br />Проверьте эл. почту: {%if ENV.user}<a href=\"{%ENV.user.email|email_provider}\">{%ENV.user.email|email_provider}{%else}<a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>{%end}"+"\n{%elseif ENV.language == 'fr'}"+"\n    Nous vous avons envoyé un e-mail avec des instructions pour votre récupération de mot de passe."+"\n    <br />Vérifiez votre e-mail: {%if ENV.user}<a href=\"{%ENV.user.email|email_provider}\">{%ENV.user.email|email_provider}{%else}<a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>{%end}"+"\n{%else}"+"\n    We have sent you an email with instruction for your password recovery."+"\n    <br />Check your email: {%if ENV.user}<a href=\"{%ENV.user.email|email_provider}\">{%ENV.user.email|email_provider}{%else}<a href=\"{%data.email|email_provider}\">{%data.email|email_provider}</a>{%end}"+"\n{%end}"+"\n</p>";Mohawk.Loader.extendLanguage({"Name":"Name","NAME":"NAME","name":"name","Email":"Email","EMAIL":"EMAIL","email":"email","Login":"Username","LOGIN":"USERNAME","login":"username","Password":"Password","PASSWORD":"PASSWORD","password":"password","Language":"Language","LANGUAGE":"LANGUAGE","language":"language","Error_Empty_Name":"Fill Your Name","Error_empty_name":"Fill your name","ERROR_EMPTY_NAME":"FILL YOUR NAME","error_empty_name":"fill your name","Error_Empty_Email":"Fill Your Email","Error_empty_email":"Fill your email","ERROR_EMPTY_EMAIL":"FILL YOUR EMAIL","error_empty_email":"fill your email","Error_Empty_Login":"Fill Your Username","Error_empty_login":"Fill your username","ERROR_EMPTY_LOGIN":"FILL YOUR USERNAME","error_empty_login":"fill your username","Error_Invalid_Email":"Invalid Email","Error_invalid_email":"Invalid email","ERROR_INVALID_EMAIL":"INVALID EMAIL","error_invalid_email":"invalid email","Error_Not_Unique_Email":"This Email Is Already Registered","Error_not_unique_email":"This email is already registered","ERROR_NOT_UNIQUE_EMAIL":"THIS EMAIL IS ALREADY REGISTERED","error_not_unique_email":"this email is already registered","Error_Not_Unique_Login":"This Username Is Already Registered","Error_not_unique_login":"This username is already registered","ERROR_NOT_UNIQUE_LOGIN":"THIS USERNAME IS ALREADY REGISTERED","error_not_unique_login":"this username is already registered","Error_Empty_Password":"Fill Password","Error_empty_password":"Fill password","ERROR_EMPTY_PASSWORD":"FILL PASSWORD","error_empty_password":"fill password","Error_Wrong_Password2":"Passwords Do Not Match","Error_wrong_password2":"Passwords do not match","ERROR_WRONG_PASSWORD2":"PASSWORDS DO NOT MATCH","error_wrong_password2":"passwords do not match"})
Mohawk.Loader.extendLanguage({"Activation":"42goals account activation","ACTIVATION":"42GOALS ACCOUNT ACTIVATION","activation":"42goals account activation","Recovery":"Password recovery","RECOVERY":"PASSWORD RECOVERY","recovery":"password recovery","Confirm_Password":"Once More","Confirm_password":"Once more","CONFIRM_PASSWORD":"ONCE MORE","confirm_password":"once more","Control_Digits":"Control Digits","Control_digits":"Control digits","CONTROL_DIGITS":"CONTROL DIGITS","control_digits":"control digits","Name_Hint":"Input Your Real Name, So We Would Know How To Address You","Name_hint":"Input your real name, so we would know how to address you","NAME_HINT":"INPUT YOUR REAL NAME, SO WE WOULD KNOW HOW TO ADDRESS YOU","name_hint":"input your real name, so we would know how to address you","Email_Hint":"Please, Input Your Real Email, We Will Not Spam You","Email_hint":"Please, input your real email, we will not spam you","EMAIL_HINT":"PLEASE, INPUT YOUR REAL EMAIL, WE WILL NOT SPAM YOU","email_hint":"please, input your real email, we will not spam you","Login_Hint":"5&ndash;25 Alphanumeric Characters","Login_hint":"5&ndash;25 alphanumeric characters","LOGIN_HINT":"5&NDASH;25 ALPHANUMERIC CHARACTERS","login_hint":"5&ndash;25 alphanumeric characters","Password_Hint":"Please, Choose A Strong Password","Password_hint":"Please, choose a strong password","PASSWORD_HINT":"PLEASE, CHOOSE A STRONG PASSWORD","password_hint":"please, choose a strong password","Password2_Hint":"Repeat Your Password For Confirmation","Password2_hint":"Repeat your password for confirmation","PASSWORD2_HINT":"REPEAT YOUR PASSWORD FOR CONFIRMATION","password2_hint":"repeat your password for confirmation","Captcha_Hint":"Input Digits You See On The Picture","Captcha_hint":"Input digits you see on the picture","CAPTCHA_HINT":"INPUT DIGITS YOU SEE ON THE PICTURE","captcha_hint":"input digits you see on the picture","Email_Recovery_Hint":"The Email You Have Used For Registration","Email_recovery_hint":"The email you have used for registration","EMAIL_RECOVERY_HINT":"THE EMAIL YOU HAVE USED FOR REGISTRATION","email_recovery_hint":"the email you have used for registration","Reset_Password":"Reset Password","Reset_password":"Reset password","RESET_PASSWORD":"RESET PASSWORD","reset_password":"reset password","Error_Wrong_Captcha":"Invalid Control Digits","Error_wrong_captcha":"Invalid control digits","ERROR_WRONG_CAPTCHA":"INVALID CONTROL DIGITS","error_wrong_captcha":"invalid control digits","Error_Wrong_Email":"There Is No User With Such Email","Error_wrong_email":"There is no user with such email","ERROR_WRONG_EMAIL":"THERE IS NO USER WITH SUCH EMAIL","error_wrong_email":"there is no user with such email","Error_Active_Email":"Your Account Is Already Active","Error_active_email":"Your account is already active","ERROR_ACTIVE_EMAIL":"YOUR ACCOUNT IS ALREADY ACTIVE","error_active_email":"your account is already active","Error_Inactive_Email":"This Email Is Not Active","Error_inactive_email":"This email is not active","ERROR_INACTIVE_EMAIL":"THIS EMAIL IS NOT ACTIVE","error_inactive_email":"this email is not active"})
window.email_provider=function(email){return'http://'+email.substr(email.indexOf('@')+1);};document.addLoader(function(){if(document.body.id!='registration-page'){return;}
window.Registration=new(CommonFormProcessor.extend({template:REGISTRATION_SUCCESS,setLoginExample:function(input){var value=input.value.toLowerCase();value=value.replace(/\W/g,'');ID('login-example').setHTML(value);}}));});document.addLoader(function(){if(document.body.id!='recovery-page'){return;}
window.Recovery=new(CommonFormProcessor.extend({template:RECOVERY_SUCCESS}));});document.addLoader(function(){if(document.body.id!='confirmation-page'){return;}
window.Confirmation=new(CommonFormProcessor.extend({method:Ajax.METHOD_PUT,template:REGISTRATION_EMAIL}));});
window.DELETE_ACCOUNT="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Ваш аккаунт удален и все информация стерта."+"\n    Вы можете перейти на <a href=\"{%URL.home}\">главную страницу</a>."+"\n{%elseif ENV.language == 'fr'}"+"\n    Votre compte a été supprimé et toutes les informations ont été effacées!"+"\n    Vous pouvez procédez à la page <a href=\"{%URL.home}\">d'accueil</a>.    "+"\n{%else}"+"\n    Your account has been deleted and all the information has been erased! "+"\n    You may proceed to the <a href=\"{%URL.home}\">home page</a>."+"\n{%end}"+"\n</p>"+"\n    ";Mohawk.Loader.extendLanguage({"personal_info":"personal info","account_type":"account type","account_expire":"account expires","change_email":"change email","change_password":"change password","confirm_changes":"confirm the changes with your current password","delete_account":"delete account","delete_account_forever":"delete my account forever","save":"save","name_hint":"input your real name, so we would know how to address you","new_email_hint":"we will send you a confirmation email to your new address","new_password_hint":"input your new password","repeat_password":"repeat your new password for confirmation","accept_deleting_account":"i understand that this operation has NO undo and there will be no futher notice","receive_emails_hint":"check to receive email notifications","current_email":"current email","old_password":"current password","new_password":"new password","confirm_password":"confirm password","new_email":"new email","receive_emails":"receive emails","unsubscribe_success":"You have successfully unsubscribed from our emails.","unsubscribe_error":"An error has occurred.","error_wrong_password":"wrong password","error_invalid_password1":"invalid password","error_invalid_new_email":"invalid email","error_not_unique_new_email":"this email is already registered"})
document.addLoader(function(){if(document.body.id!='settings-page'){return;}
window.Settings=new(CommonFormProcessor.extend({template:false,successHandler:function(req){try{var new_data=req.data.item;foreach(new_data,function(key){ENV.user[key]=this;});}catch(e){Console.describe(e);}
parent.successHandler(req);}}));});document.addLoader(function(){if(document.body.id!='delete-page'){return;}
window.DeleteAccount=new(CommonFormProcessor.extend({method:Ajax.METHOD_DELETE,template:DELETE_ACCOUNT}));});
window.Carousel=Mohawk.UI.List.extend({element_width:null,element_height:400,node_width:400,node_height:330,current:0,__construct:function(id,structure){parent.__construct(id,structure);window.onresize=function(){self.setPositions();};window.onload=function(){self.setPositions();};self.EVENT_TURNED=id+'-turned';},setPositions:function(){var theta=0;var step=Math.PI/2/(self.element.childNodes.length-2);self.cells=[];var len=self.element.childNodes.length;for(var i=0;i<len;i++){self.cells.push(theta);var child=self.element.childNodes[i];self.setPosition(child,child.angle!=undefined?child.angle:theta);if(child.cell==undefined){child.cell=i;}
theta+=step;}},setPosition:function(node,angle){angle=(Math.PI*2+angle)%(Math.PI*2);var max_x=self.element_width||self.element.offsetWidth-24;var max_y=self.element_height||self.element.offsetHeight;var r_w=max_x;var r_h=400;var w=self.node_width;var h=self.node_height;var max_a=Math.PI/4;var scale=angle<max_a?angle/max_a:2-angle/max_a;w*=scale;h*=scale;var x=(r_w-w)/2*Math.sin(angle);var y=(r_h-h)/2*Math.cos(angle);x+=max_x/2;y+=max_y/2;x-=w/2;y-=h/2;node.style.left=x+'px';node.style.top=y+'px';node.style.width=w+'px';node.style.height=h+'px';node.firstChild.style.width=w+'px';node.firstChild.style.height=h+'px';self.setShadow(node.firstChild,w/25);node.style.zIndex=Math.round(scale*10);node.angle=angle;},setShadow:function(node,width){var style='0px '+Math.round(width/2)+'px '+Math.round(width)+'px rgba(0, 0, 0, 0.3)';node.style.mozBoxShadow=style;node.style.boxShadow=style;node.style.webkitBoxShadow=style;},setNode:function(node){var current=0;for(var i=0;i<self.element.childNodes.length;i++){if(node===self.element.childNodes[i]){current=i;break;}}
if(!node.cell){return;}
var clockwise=node.angle<=Math.PI;var gap=clockwise?node.cell:self.element.childNodes.length-node.cell;var n=0;var _turn=function(){self.turn(clockwise,function(){n++;if(n==gap){self.current=current;node.addClass('current');Observer.fire(self.EVENT_TURNED,node);}else{_turn();}});};_turn();},turn:function(clockwise,finalize){var frames=180;var steps_num=frames/self.element.childNodes.length;var len=self.element.childNodes.length;var gap=clockwise?-1:1;var steps=[];for(var i=0;i<len;i++){var child=self.element.childNodes[i];var next_num=(i+gap+len)%len;var next=self.element.childNodes[next_num];child.nextCell=next.cell;var step;if(clockwise){if(child.cell>next.cell){step=child.angle-next.angle;}else{step=child.angle-next.angle+2*Math.PI;}}else{if(child.cell<next.cell){step=child.angle-next.angle;}else{step=child.angle-next.angle-2*Math.PI;}}
step/=steps_num;steps.push(step);}
var t=0;self.element.addClass('moving');_turn=function(){t+=1;for(var i=0;i<len;i++){var child=self.element.childNodes[i];self.setPosition(child,child.angle-steps[i]);}
if(t<steps_num-1){setTimeout(_turn,1);}else{self.element.removeClass('moving');for(var i=0;i<len;i++){var child=self.element.childNodes[i];var next_cell=self.element.childNodes[child.nextCell].cell;self.setPosition(child,self.cells[child.nextCell]);child.cell=child.nextCell;child.removeClass('current');}
finalize();}};_turn();},createNode:function(data){var node=parent.createNode(data);node.onclick=function(){if(self.element.hasClass('moving')){return;}
if(!node.cell){return;}
self.setNode(node);};return node;}});window.POPUP_IMAGE="<img src=\"{%URL.img}site/chart-close.png\" onclick=\"Popup.close()\" alt=\"x\" class=\"close\" />"+"\n<div id=\"popup-image\"></div>";document.addLoader(function(){if(document.body.id!='home-page'){return;}
window.Popup=new Singletone({__construct:function(){self.container=DOM.element('div',{id:'popup-image-container',html:Template.transform(POPUP_IMAGE)});self.img_container=self.container.getElementById('popup-image');foreach(ID('features').getElementsByClassName('screenshot'),function(){this.onclick=function(){self.open(this);};});self.loading=DOM.element('img',{src:URL.img+'site/loading24.gif',className:'loading'});},open:function(img){self.img_container.setChild(DOM.element('img',{src:img.src.replace(/\.png/,'-big.png'),onload:function(){self.loading.remove();Shadow.show();self.container.appendTo(ID('wrapper'));Dragdrop.bringToFront(self.container);Effects.appear(this);},onerror:function(){self.loading.remove();}}));self.loading.appendTo(img.parentNode);},close:function(){self.container.remove();Shadow.hide();}});Shadow.init();});
window.DemoApi=GoalsApi.extend({add:function(data){try{if(!data.title){self.showErrors(Goals.Add,{title:LNG.Error_empty_title});return;}
data.id=Data.goals.length+2;data.user=ENV.UID;data=self.handleIcons(data);Observer.fire('goal-added',data);}catch(e){}},edit:function(id,data){try{if(data.title!==undefined&&!data.title){self.showErrors(Goals.Edit,{title:LNG.Error_empty_title});return;}
data=self.handleIcons(data);data.id=id;data.user=ENV.UID;Observer.fire('goal-edited',data);}catch(e){}},handleIcons:function(data){var id=Object.keys(Data.icons).sort(function(a,b){return a*1-b*1;}).pop()*1;foreach(['icon_item','icon_yes','icon_no'],function(i,type){if(data[type]&&data[type].toString().match(/^http:\/\//)){id++;Data.icons[id]=data[type];data[type]=id;}});return data;},remove:function(id){Observer.fire('goal-removed',id);},archive:function(id){self.edit(id,{archived:Data.today});},restore:function(id){self.edit(id,{archived:null});},sort:function(){},save:function(id,date,data){data.goal=id;data.date=date;self.setData(id,date,data);var row=ID('goal-'+id);Goals.Table.createChart(row.data,row.getElementsByClassName('chart')[0]);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);Goals.Table.setPlan(row);},addPlan:function(data){self.setPlan(data);self.Table.setPlan(ID('goal-'+data.goal));var row=ID('goal-'+data.goal);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);Observer.fire('plan-added-'+data.id,data.id);},editPlan:function(id,data){data.id=id;self.setPlan(data);var row=ID('goal-'+data.goal);Goals.Table.aggregate(row.data,row.getElementsByClassName('total')[0]);self.Table.setPlan(row);},removePlan:function(id,goal){self.unsetPlan(goal,id);self.Table.setPlan(ID('goal-'+goal));}});window.DemoTabsApi=new Class({add:function(data){Observer.fire('tab-added',data);},edit:function(id,data){data.id=id;Observer.fire('tab-edited',data);},remove:function(id){Observer.fire('tab-removed',id);},create:function(){var data={};data.id=Math.rand(1e10,1e12);data.title=prompt(LNG.Input_new_tab_name);data.position=parseInt(Goals.Tabs.element.lastChild?Goals.Tabs.element.lastChild.data.position:0)+1;if(data.title===null||!data.title.length){return;}
self.add(data);},sort:function(){}});document.addLoader(function(){if(document.body.id!='demo-page'){return;}
window.Goals=new DemoApi;Shadow.init();if(ENV.user){ENV.user.valid=true;}else{ENV.user={valid:true};}
Goals.Tabs=new GoalsTabs('goals-tabs',Data.tabs);document._toHideOnClick.push(Goals.Tabs);ID('goals-tabs').replace(Goals.Tabs.element);if(Goals.Tabs.getNode(ENV.tab)){Goals.Tabs.select(Goals.Tabs.getNode(ENV.tab));}
window.Tabs=new DemoTabsApi;Observer.add('tab-added',function(item){Data.tabs.push(item);Goals.Tabs.addNode(item);});Observer.add('tab-edited',function(item){var id=-1;foreach(Data.tabs,function(i,tab){if(tab.id==item.id){id=i;return false;}});if(id>0){Data.tabs[id]=item;}else{Data.tabs.push(item);}
Goals.Tabs.hide();Goals.Tabs.editNode(Goals.Tabs.getNode(item.id),item);});Observer.add('tab-removed',function(id){Goals.Tabs.removeNode(Goals.Tabs.getNode(id));window.location.hash='';});Observer.add(Goals.Tabs.EVENT_SORTED,function(){Tabs.sort();});Goals.Add=new GoalsPageAdd;Goals.Edit=new GoalsPageEdit;Goals.Table=new GoalsWeek;Goals.Chart=new GoalsChart;Goals.Comment=new GoalsComment;Goals.Number=new GoalsNumber;Goals.Time=new GoalsTime;Goals.Table.build();ID('frame').replace(Goals.Table.frame);Goals.Table.frame.id='frame';Goals.Table.table.id='data';AnchorObserver.add('(?:(?:tab-(\\d+))|(all-goals))?',function(id,all_goals){var tab=null;if(all_goals||!ENV.user.valid){ENV.tab=0;}else if(id){ENV.tab=id;tab=Goals.Tabs.getNode(id);if(!tab){ENV.tab=0;}}else{tab=Goals.Tabs.element.firstChild;if(tab){ENV.tab=tab.data.id;}else{ENV.tab=0;}}
Progress.load('Loading tab');if(tab){Goals.Tabs.select(tab);ID('all-goals').removeClass('selected');}else{Goals.Tabs.unselect();ID('all-goals').addClass('selected');}
Goals.Table.removeGoals();foreach(Data.goals,function(i,goal){if(!ENV.tab||goal.tab==ENV.tab){Goals.Table.addGoal(goal);}});Progress.done('Done',true);});AnchorObserver.start();Observer.add('goal-added',function(item){Data.goals.push(item);Goals.Table.addGoal(item);Goals.Add.hide();});Observer.add('goal-edited',function(item){var ind=-1;foreach(Data.goals,function(i,goal){if(goal.id==item.id){ind=i;return false;}});var moved=item.tab!==undefined&&item.tab!=ENV.tab;var archived=!!item.archived;if(!archived){if(ind>=0){foreach(item,function(i,value){Data.goals[ind][i]=item[i];});}else{Data.goals.push(item);}}
if(moved||archived){Goals.Table.removeGoal(item.id);}else{Goals.Table.editGoal(item);}
if(archived){Data.goals.splice(ind,1);}
Goals.Edit.hide();});Observer.add('goals-sorted',function(item){foreach(Data.goals,function(i,goal){foreach(item,function(j,data){if(goal.id==data.id){Data.goals[i].position=data.position;return false;}});});});Observer.add('goal-removed',function(id){var ind=-1;foreach(Data.goals,function(i,goal){if(goal.id==id){ind=i;return false;}});Data.goals.splice(ind,1);Goals.Table.removeGoal(id);Goals.Edit.hide();});Observer.add('form-submitted',function(data){if(!data.id){data.position=Goals.Table.table.tBodies[0].childNodes.length;Goals.add(data);}else{Goals.edit(data.id,data);}});Observer.add(Goals.Add.EVENT_SET,function(){ID('goals-table').addClass('hidden');Goals.Edit.hide(true);});Observer.add(Goals.Edit.EVENT_SET,function(){ID('goals-table').addClass('hidden');Goals.Add.hide(true);});Observer.add(Goals.Add.EVENT_HIDDEN,function(){ID('goals-table').removeClass('hidden');});Observer.add(Goals.Edit.EVENT_HIDDEN,function(){ID('goals-table').removeClass('hidden');});});
Mohawk.Loader.extendLanguage({"Api":"42goals API","API":"42GOALS API","api":"42goals API","For_Developers":"For Developers","For_developers":"For developers","FOR_DEVELOPERS":"FOR DEVELOPERS","for_developers":"for developers","Title_Hint":"Your App Name","Title_hint":"Your app name","TITLE_HINT":"YOUR APP NAME","title_hint":"your app name","Url_Hint":"Page Where We Redirect User After His Approval, Leave Blank For Desktop Or Mobile Apps","Url_hint":"Page where we redirect user after his approval, leave blank for desktop or mobile apps","URL_HINT":"PAGE WHERE WE REDIRECT USER AFTER HIS APPROVAL, LEAVE BLANK FOR DESKTOP OR MOBILE APPS","url_hint":"page where we redirect user after his approval, leave blank for desktop or mobile apps","Description_Hint":"What Does Your App Do?","Description_hint":"What does your app do?","DESCRIPTION_HINT":"WHAT DOES YOUR APP DO?","description_hint":"what does your app do?"})
window.APP_ADDED="{%if ENV.language == 'en'}"+"\n<p>"+"\n    Your app is added! Use the tokens below for OAuth workflow:"+"\n    <br />App key: {%data.appkey}"+"\n    <br />secret: {%data.secret}"+"\n</p>"+"\n<p>"+"\n    <br />Don't worry, they will be written here next time in case if you forget them. "+"\n    <br />Nevertheless keep them in a safe place!"+"\n</p>"+"\n{%end}";document.addLoader(function(){if(document.body.id!='apps-page'){return;}
window.Apps=new(CommonFormProcessor.extend({successHandler:function(req){if(req.data.item.appkey){self.template=APP_ADDED;}
parent.successHandler(req);}}));});
Mohawk.Loader.extendLanguage({"Authorization":"Authorization","AUTHORIZATION":"AUTHORIZATION","authorization":"authorization","Remember_Me":"Remember Me","Remember_me":"Remember me","REMEMBER_ME":"REMEMBER ME","remember_me":"remember me","Log_In":"Login","Log_in":"Login","LOG_IN":"LOGIN","log_in":"login","Logout":"Logout","LOGOUT":"LOGOUT","logout":"logout","Logging_In":"Logging In","Logging_in":"Logging in","LOGGING_IN":"LOGGING IN","logging_in":"logging in","Logged_In":"Logged In, Redirecting","Logged_in":"Logged in, redirecting","LOGGED_IN":"LOGGED IN, REDIRECTING","logged_in":"logged in, redirecting","Error_Login":"Wrong Username Or Password","Error_login":"Wrong username or password","ERROR_LOGIN":"WRONG USERNAME OR PASSWORD","error_login":"wrong username or password","Logging_Out":"Logging Out","Logging_out":"Logging out","LOGGING_OUT":"LOGGING OUT","logging_out":"logging out","Logged_Out":"Redirecting","Logged_out":"Redirecting","LOGGED_OUT":"REDIRECTING","logged_out":"redirecting","Confirm_Logout":"Log Out?","Confirm_logout":"Log out?","CONFIRM_LOGOUT":"LOG OUT?","confirm_logout":"Log out?"})
window.Authorization=new Class({login:function(form){var req=new Mohawk.Ajax(URL.home+'api/login/',Mohawk.Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.ok){Progress.load(LNG.Logged_in);if(req.data.remember){window.location=URL.sso+'setcookie/'+req.data.sid+'/?redirect='+escape(URL.host+form.getData().redirect);}else{window.location=URL.sso+'setsession/'+req.data.sid+'/?redirect='+escape(URL.host+form.getData().redirect);}}else{Progress.done(LNG.Error_login);}};req.send(form.getData());Progress.load(LNG.Logging_in);},logout:function(sid){if(ENV.SID){var url=URL.sso+'deletecookie/'+ENV.SID+'/?redirect='+escape(window.location);window.location=URL.home+'api/login/deletecookie/'+ENV.SID+'/?redirect='+escape(url);}else{var req=new Mohawk.Ajax(URL.home+'api/login/',Mohawk.Ajax.METHOD_DELETE);req.responseHandler=function(req){Progress.load(LNG.Logged_out);window.location.reload();};req.send();Progress.load(LNG.Logging_out);}}});window.Auth=new Authorization;
window.ArchiveList=Mohawk.UI.List.extend({__construct:function(id,children){parent.__construct(id,children);self.EVENT_EMPTY=self.id+'-empty';self.EVENT_NOTEMPTY=self.id+'-notempty';},createNode:function(data){var node=parent.createNode(data);node.purgeChildren();var date=DOM.element('small');date.setHTML(Format.date(Date.fromString(data.archived),'M d, Y'));date.appendTo(node);var title=DOM.element('span');title.setHTML('&mdash; '+data.title);title.appendTo(node);var btn_restore=DOM.element('img',{src:URL.img+'site/restore.png',className:['btn','restore'],onclick:function(){Goals.restore(data.id);},appendTo:node});var btn_remove=DOM.element('img',{src:URL.img+'site/trash.png',className:['btn','remove'],onclick:function(){Goals.remove(data.id);},appendTo:node});return node;},addNode:function(data){var node=parent.addNode(data);Observer.fire(self.EVENT_NOTEMPTY);return node;},removeNode:function(node){var result=parent.removeNode(node);if(!self.element.childNodes.length){Observer.fire(self.EVENT_EMPTY);}
return result;}});document.addLoader(function(){if(document.body.id!='archive-page'){return;}
window.Goals=new GoalsApi;Goals.Archive=new ArchiveList('archive-list',[]);ID('archive-list').replace(Goals.Archive.element);Observer.add('goal-removed',function(id){var node=Goals.Archive.getNode(id);Goals.Archive.removeNode(node);});Observer.add('goal-edited',function(item){var node=Goals.Archive.getNode(item.id);Goals.Archive.removeNode(node);});Observer.add(Goals.Archive.EVENT_EMPTY,function(){ID('archive-empty').removeClass('hidden');});Observer.add(Goals.Archive.EVENT_NOTEMPTY,function(){ID('archive-empty').addClass('hidden');});Goals.Archive.setChildren(Data.goals);});
window.PostsApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/posts/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){Observer.fire('post-added',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Posts.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/posts/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){Observer.fire('post-edited',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Posts.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},showErrors:function(form,error){foreach(error,function(name){var input=form.element[name];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/posts/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('post-removed',item);Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Deleting);}});window.PostsForm=new Class({element:null,__construct:function(){self.element=self.createForm();document.body.appendChild(self.element);self.element.addClass('hidden');},createForm:function(){var form=document.createElement('FORM');form.object=self;window.POSTS_FORM="<fieldset>"+"\n    <img id=\"goals-form-close\" src=\"{%URL.img}site/close.png\" onclick=\"Posts.Form.hide(); return false;\" />"+"\n    <input type=\"hidden\" name=\"id\" />"+"\n    <ul class=\"fields\">"+"\n<!--        <li>-->"+"\n<!--            <label class=\"block\">Approved?</label>-->"+"\n<!--            <input type=\"radio\" id=\"approved-no\" name=\"approved\" value=\"no\" />-->"+"\n<!--            <label for=\"approved-no\">no</label>-->"+"\n<!--            &nbsp;-->"+"\n<!--            &nbsp;-->"+"\n<!--            <input type=\"radio\" id=\"approved-yes\" name=\"approved\" value=\"yes\" />-->"+"\n<!--            <label for=\"approved-yes\">yes</label>-->"+"\n<!--        </li>-->"+"\n        <li>"+"\n            <label class=\"block\">Title</label>"+"\n            <input name=\"title\" class=\"text\" onchange=\"if (!this.form.name.value) {var name = this.value.toLowerCase(); name = name.replace(/[^a-z0-9-_]+/ig, '_'); this.form.name.value = name;}\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Name</label>"+"\n            <input name=\"name\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Date</label>"+"\n            <input name=\"date\" class=\"text\" />"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Template</label>"+"\n            <select name=\"template\">"+"\n                <option value=\"0\"></option>"+"\n                {%for category in Data.categories}"+"\n                <optgroup label=\"{%category.title}\">"+"\n                    {%for template in Data.templates}"+"\n                        {%if template.category == category.id}"+"\n                    <option value=\"{%template.id}\">{%template.title}</option>"+"\n                        {%end}"+"\n                    {%end}"+"\n                </optgroup>"+"\n                {%end}"+"\n            </select>"+"\n        </li>"+"\n        <li>"+"\n            <label class=\"block\">Text</label>"+"\n            <textarea name=\"text\"></textarea>"+"\n        </li>"+"\n    </ul>"+"\n    <div class=\"buttons\">"+"\n        <button type=\"submit\">Save</button>"+"\n        or"+"\n        <a href=\"#cancel\" class=\"script\" onclick=\"Posts.Form.hide(); return false;\">cancel</a>"+"\n        &nbsp;&nbsp;&nbsp;"+"\n        You may also <a href=\"#delete\" class=\"script\" onclick=\"Posts.remove(Posts.Form.element.id.value); return false;\">delete</a> this post"+"\n    </div>"+"\n</fieldset>";form.setHTML(Template.transform(POSTS_FORM));form.id='posts-form';form.onmousedown=DOM.stopEvent;form.onsubmit=function(){self.save.apply(self,[form]);return false;};return form;},save:function(form){foreach(form.getElementsByClassName('error'),function(){this.remove();});var data=form.getData();Observer.fire('form-submitted',data);},set:function(data){self.element.removeClass('hidden');Shadow.show();Dragdrop.bringToFront(self.element);self.element.setData({'id':''});self.element.reset();if(data){self.element.replaceClass('adding','editing');self.element.setData(data);}else{self.element.replaceClass('editing','adding');self.element.setData({date:(new Date()).getId()});}},hide:function(){Shadow.hide();self.element.addClass('hidden');}});window.PostsList=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.setHTML('');var title=DOM.element('A');title.href='#'+data.id;title.addClass('script');title.setHTML(data.title);node.appendChild(title);title.onclick=function(){Posts.Form.set(data);};return node;}});document.addLoader(function(){if(document.body.id!='posts-admin'){return;}
window.Posts=new PostsApi;Shadow.init();Posts.Form=new PostsForm;Posts.List=new PostsList('posts-list',Data.posts);ID('posts-list').replace(Posts.List.element);Observer.add('post-added',function(item){Data.posts.push(item);Posts.List.addNode(item);Posts.Form.hide();});Observer.add('post-edited',function(item){var ind=-1;foreach(Data.posts,function(i,post){if(post.id==item.id){ind=i;return false;}});if(ind>=0){Data.posts[ind]=item;}else{Data.posts.push(item);}
var moved=ENV.category&&item.category!==undefined&&item.category!=ENV.category;if(moved){Posts.List.removeNode(Posts.List.getNode(item.id));}else{Posts.List.editNode(Posts.List.getNode(item.id),item);}
Posts.Form.hide();});Observer.add('post-removed',function(item){Posts.List.removeNode(Posts.List.getNode(item));Posts.Form.hide();});Observer.add('form-submitted',function(data){if(!data.id){Posts.add(data);}else{Posts.edit(data.id,data);}});});
window.ChartsApi=new Class({add:function(data){var req=new Ajax(URL.home+'api/charts/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.item){Observer.fire('chart-added',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Charts.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},edit:function(id,data){var req=new Ajax(URL.home+'api/charts/'+id+'/',Ajax.METHOD_PUT);req.responseHandler=function(req){if(req.data.item){Observer.fire('chart-edited',req.data.item);Progress.done(LNG.Saved,true);}else{self.showErrors(Charts.Form,req.data.error);Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send({data:data});Progress.load(LNG.Saving);},showErrors:function(form,error){foreach(error,function(name){var input=form.element[name];if(!input){return true;}
var error=input.nextTag('B');if(!error){error=document.createElement('B');error.addClass('error');input.parentNode.insertAfter(error,input);}
error.innerHTML=this;});},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/charts/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){if(req.data.item){var item=req.data.item;Observer.fire('chart-removed',item);Progress.done(LNG.Deleted,true);}else{Progress.done(LNG.Error);}};req.errorHandler=function(req){Progress.done(LNG.Error);};req.send();Progress.load(LNG.Deleting);}});window.CHART_CONSTRUCTOR="<img src=\"{%URL.img}site/chart-close.png\" onclick=\"Me.Constructor.hide()\" alt=\"x\" class=\"close\" />"+"\n"+"\n<div id=\"chart-constructor\">"+"\n    <dl>"+"\n        <dt class=\"first\"><span>1. {%LNG.Choose_goal_and_type}:</span></dt>"+"\n        <dt class=\"second\"><span>2. {%LNG.Choose_period_and_group}:</span></dt>"+"\n        <dt class=\"third\"><span>3. {%LNG.Additional_options}:</span></dt>"+"\n        <dd class=\"first\">"+"\n            <div>"+"\n                <select id=\"chart-goal\" onchange=\"Me.Constructor.draw()\">"+"\n                    {%for goal in Data.goals}"+"\n                        {%if goal}"+"\n                    <option value=\"{%goal.id}\">{%goal.title}</option>"+"\n                        {%end}"+"\n                    {%end}"+"\n                </select>"+"\n                <br /><br />"+"\n                <div id=\"chart-type\"></div>"+"\n            </div>"+"\n        </dd>"+"\n        <dd class=\"second\">"+"\n            <div>"+"\n                <b>{%LNG.Period}:</b> "+"\n                <div id=\"chart-period\"></div>"+"\n                <br /><br />"+"\n                <b>{%LNG.Group_by}:</b>"+"\n                <div id=\"chart-groupby\"></div>"+"\n            </div>"+"\n        </dd>"+"\n        <dd class=\"third\">"+"\n            <div>"+"\n                <ul id=\"chart-advanced\">"+"\n                    <li>"+"\n                        <input type=\"checkbox\" class=\"checkbox\" id=\"chart-accumulate\" onclick=\"Me.Constructor.draw()\" />"+"\n                        <label for=\"chart-accumulate\">{%LNG.accumulate_values}</label>"+"\n                    </li>"+"\n                    <li>    "+"\n                        <input type=\"checkbox\" class=\"checkbox\" id=\"chart-fill-empty\" onclick=\"Me.Constructor.draw()\" />"+"\n                        <label for=\"chart-fill-empty\">{%LNG.fill_empty_values}</label>"+"\n                    </li>"+"\n                    <li>     "+"\n                        <input type=\"checkbox\" class=\"checkbox\" id=\"chart-interpolate\" onclick=\"Me.Constructor.draw()\" />"+"\n                        <label for=\"chart-interpolate\">{%LNG.interpolate_line}</label>"+"\n                    </li>"+"\n                </ul>"+"\n            </div>"+"\n        </dd>"+"\n    </dl>"+"\n</div>"+"\n"+"\n<div id=\"chart-canvas-container\">"+"\n    <div id=\"chart-canvas\"></div>"+"\n    <input type=\"text\" id=\"chart-title\" value=\"{%LNG.Set_title}\" />"+"\n</div>"+"\n"+"\n<div class=\"buttons\">"+"\n    <button class=\"button\" type=\"button\" onclick=\"Me.Constructor.apply()\"><span><span>{%LNG.Save_chart}</span></span></button>"+"\n</div>";window.ChartConstructor=new Class({__construct:function(){self.container=DOM.element('div',{id:'chart-constructor-container',html:Template.transform(CHART_CONSTRUCTOR)});self.Period=new ChartPeriodList('chart-period');self.container.getElementById('chart-period').replace(self.Period.element);self.GroupBy=new ChartGroupList('chart-groupby');self.container.getElementById('chart-groupby').replace(self.GroupBy.element);self.Type=new ChartTypeList('chart-type');self.container.getElementById('chart-type').replace(self.Type.element);Observer.add(self.Type.EVENT_SELECTED,function(){var type=self.Type.selected[0].data.id;switch(type){case'pie':self.GroupBy.element.parentNode.addClass('hidden');ID('chart-advanced').parentNode.addClass('hidden');break;default:self.GroupBy.element.parentNode.removeClass('hidden');ID('chart-advanced').parentNode.removeClass('hidden');break;}
self.draw();});Observer.add(self.Period.EVENT_SELECTED,function(){self.draw();});Observer.add(self.GroupBy.EVENT_SELECTED,function(){self.draw();});},set:function(element){Shadow.show();document.body.appendChild(self.container);Dragdrop.bringToFront(self.container);self.element=element;self.canvas=ID('chart-canvas');self.canvas.style.width=(element.data.size=='wide'?'662':'320')+'px';self.canvas.style.height='240px';if(element.data.chart){ID('chart-goal').value=element.data.chart.goal;ID('chart-title').value=element.data.chart.title;self.GroupBy.setSelected(element.data.chart.groupby);self.Period.setSelected(element.data.chart.period);self.Type.setSelected(element.data.chart.type);ID('chart-accumulate').checked=element.data.chart.accumulate;ID('chart-interpolate').checked=element.data.chart.interpolate;ID('chart-fill-empty').checked=element.data.chart.fill_empty;}
self.draw();},hide:function(){Shadow.hide();self.container.remove();},draw:function(){self.goal=ChartData.getGoalById(ID('chart-goal').value);self.group=self.GroupBy.getSelected()||'day';self.period=self.Period.getSelected()||'week';ChartData.setGoal(self.goal);ChartData.setGroup(self.group);ChartData.setPeriod(self.period);self.accumulate=ID('chart-accumulate').checked;self.interpolate=ID('chart-interpolate').checked;self.fill_empty=ID('chart-fill-empty').checked;ChartData.take_last_value=self.fill_empty;self.type=self.Type.getSelected()||'column';var data;if(self.type=='pie'){data=ChartData.getBooleanData();}else{data=self.accumulate?ChartData.getAccumulatedData():ChartData.getGroupedData()}
Me.Chart.set({canvas:self.canvas.id,width:self.canvas.offsetWidth,height:self.canvas.offsetHeight,type:self.type,interpolate:self.interpolate,data:data});Me.Chart.draw();},apply:function(){var data={goal:self.goal.id,title:ID('chart-title').value==LNG.Set_title?self.goal.title:ID('chart-title').value,position:self.element.data.id,type:self.type,period:self.period,groupby:self.group,accumulate:self.accumulate?1:0,interpolate:self.interpolate?1:0,fill_empty:self.fill_empty?1:0};if(self.element.data.chart){Charts.edit(self.element.data.chart.id,data);}else{Charts.add(data);}
self.hide();}});window.MeLayout=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.setHTML('');if(data.size){node.addClass(data.size);}
if(!data.chart){node.addClass('empty');}
node.clear=function(){node.data.chart=null;node.canvas.setHTML('');node.header.setHTML('');node.addClass('empty');};node.canvas=DOM.element('div',{id:node.id+'-canvas',className:'canvas',appendTo:node});node.header=DOM.element('h2',{html:data.chart?data.chart.title:'',appendTo:node});node.btn_add=DOM.element('a',{href:'#add',html:'Add chart',className:'add',appendTo:node,onclick:function(){Me.Constructor.set(node);return false;}});node.toolbar=DOM.element('div',{className:'toolbar',appendTo:node});node.btn_edit=DOM.element('img',{src:URL.img+'site/chart-edit.png',className:'edit',appendTo:node.toolbar,onclick:function(){Me.Constructor.set(node);return false;}});node.btn_remove=DOM.element('img',{src:URL.img+'site/chart-delete.png',className:'remove',appendTo:node.toolbar,onclick:function(event){event=DOM.event(event);Charts.remove(data.chart.id);event.stopPropagation();return false;}});return node;}});window.MeGoals=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.setHTML('');node.addClass(data.privacy);var btn_private=DOM.element('img',{src:URL.img+'site/btn-private.png',appendTo:node,className:['btn','private'],onclick:function(){node.replaceClass('private','loading');Goals.edit(node.data.id,{privacy:'public'});}});var btn_public=DOM.element('img',{src:URL.img+'site/btn-public.png',appendTo:node,className:['btn','public'],onclick:function(){node.replaceClass('public','loading');Goals.edit(data.id,{privacy:'private'});}});var progress=DOM.element('img',{src:URL.img+'site/loading24.gif',appendTo:node,className:['btn','progress']});var title=DOM.element('h2',{html:data.title,appendTo:node});return node;}});window.WYSIWYG="<div class=\"toolbar\">"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.switchMode()\" title=\"Switch WYSIWYG/HTML mode\"><img src=\"{%URL.img}wysiwyg/mode.png\" alt=\"mode\" /></button>"+"\n"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.bold()\" title=\"Bold\"><img src=\"{%URL.img}wysiwyg/b.png\" alt=\"B\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.italic()\" title=\"Italic\"><img src=\"{%URL.img}wysiwyg/i.png\" alt=\"I\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.removeFormat()\" title=\"Clear\"><img src=\"{%URL.img}wysiwyg/clear.png\" alt=\"clear\" /></button>"+"\n    "+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.insertList('ordered')\" title=\"Insert numbered list\"><img src=\"{%URL.img}wysiwyg/ol.png\" alt=\"OL\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.insertList('unordered')\" title=\"Insert bullet list\"><img src=\"{%URL.img}wysiwyg/ul.png\" alt=\"UL\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.insertLink()\" title=\"Insert link\"><img src=\"{%URL.img}wysiwyg/a.png\" alt=\"A\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.removeLink()\" title=\"Remove link\"><img src=\"{%URL.img}wysiwyg/-a.png\" alt=\"unlink\" /></button>"+"\n    <button class=\"btn\" type=\"button\" onclick=\"this.wg.insertImage()\" title=\"Insert image\"><img src=\"{%URL.img}wysiwyg/img.png\" alt=\"img\" /></button>"+"\n</div>"+"\n<div class=\"editor\"></div>"+"\n<div class=\"textarea\"></div>";window.Wysiwyg=new Class({id:0,mode:'',tidy:true,element:null,editor:null,textarea:null,doc:null,win:null,__construct:function(){self.id=Math.rand(1e15,1e16);},set:function(textarea){var element=DOM.element('div',{className:'wysiwyg',html:Template.transform(WYSIWYG)});self.element=element;textarea.collapse();textarea.parentNode.insertAfter(element,textarea);var editor=DOM.element('iframe',{frameBorder:1,src:URL.public+'html/wysiwyg.html'});if(IE){editor.contentEditable=true;}
editor.object=self;editor.addEvent('load',function(){var frame=window.event?window.event.srcElement:this;var win=frame.contentWindow;var doc=win.document;if(frame.offsetLeft){doc.designMode='On';if(FF){doc.execCommand('styleWithCSS',false,false);}}else{if(!FF){doc.designMode='On';}else{doc.onfocus=function(){doc.designMode='On';if(FF){doc.execCommand('styleWithCSS',false,false);}
delete(doc.onfocus);}}}
frame.object.win=win;frame.object.doc=doc;var body=doc.body||doc.documentElement?doc.documentElement.getElementsByTagName('BODY')[0]:null;if(body){if(!doc.body){doc.body=body;}
body.innerHTML=frame.object.textarea.value;}
doc.frame=frame;frame.object.switchHTML();DOM.enchaseNode(doc);win.frame=frame;if(WEBKIT){win.onblur=function(){this.frame.object.setText();};}else{doc.addEvent('blur',function(){this.frame.object.setText();});}
frame.object.init();});self.editor=editor;self.textarea=textarea;element.getElementsByClassName('textarea')[0].appendChild(textarea);element.getElementsByClassName('editor')[0].appendChild(editor);foreach(['BUTTON','SELECT','INPUT'],function(){var buttons=element.getElementsByTagName(this);for(var i=0;i<buttons.length;i++){buttons[i].wg=self;}});},init:function(){self.doc.onpaste=function(event){setTimeout(function(){self.doc.body.innerHTML=self.toHtml(self.doc.body,null,null,true);},1);};},test:function(){self.doc.body.innerHTML='abc';},range:function(){var range,selection;self.win.focus();if(!IE&&self.win.getSelection){selection=self.win.getSelection()
range=selection.getRangeAt(0);}else if(self.doc.selection){selection=self.doc.selection;range=selection.createRange();}
range.sel=selection;return range;},selection:function(){if(self.win.getSelection){var range=self.win.getSelection().getRangeAt(0);var start=range.startContainer;var end=range.endContainer;var root=range.commonAncestorContainer;start=self.getTag(start);end=self.getTag(end);root=start==end?start:root;return{range:range,root:root,start:start,end:end};}else if(self.doc.selection){range=self.doc.selection.createRange();if(!range.duplicate){return null;}
var r1=range.duplicate();var r2=range.duplicate();r1.collapse(true);r2.moveToElementText(r1.parentElement());r2.setEndPoint('EndToStart',r1);start=r1.parentElement();r1=range.duplicate();r2=range.duplicate();r2.collapse(false);r1.moveToElementText(r2.parentElement());r1.setEndPoint('StartToEnd',r2);end=r2.parentElement();root=range.parentElement();if(start==end){root=start;}
return{range:range,root:root,start:start,end:end};}else{return null;}},pasteNode:function(node){var sel,range;if(typeof self.win.getSelection!="undefined"){sel=self.win.getSelection();if(sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0);range.deleteContents();range.insertNode(node);range.setEndAfter(node);range.setStartAfter(node);sel.removeAllRanges();sel.addRange(range);range.selectNode(node);}}else if(typeof self.doc.selection!="undefined"){sel=self.doc.selection;if(sel.createRange){range=sel.createRange();range.pasteHTML(node.outerHTML);range.select();}}},getTag:function(node){while(node&&!node.tagName){node=node.parentNode;}
return node;},bold:function(){self.doc.execCommand('Bold',false,null);},italic:function(){self.doc.execCommand('Italic',false,null);},underline:function(){self.doc.execCommand('Underline',false,null);},wrap:function(range,tag){if(range.pasteHTML){range.pasteHTML('<'+tag+'>'+range.htmlText+'</'+tag+'>');}else if(range.insertNode){var fragment=range.cloneContents();range.deleteContents();var node=self.doc.createElement(tag);node.appendChild(fragment);range.insertNode(node);}else{Console.error('wrap is not supported');}},changeTag:function(node,tag){Console.log('change tag to: '+tag);var clone=self.doc.createElement(tag);clone.innerHTML=node.innerHTML;node.parentNode.replaceChild(clone,node);},paragraph:function(tag){var sel=self.selection();var root_tag=sel.root.tagName?sel.root.tagName.toLowerCase():false;switch(tag){case'p':case'h1':case'h2':case'h3':case'h4':if(root_tag==tag){break;}
if(Array.find(['p','h1','h2','h3','h4','h5','h6'],root_tag)!==false){self.changeTag(sel.root,tag);break;}
self.wrap(sel.range,'p');break;}},align:function(align){var cmd='';switch(align){case'left':cmd='JustifyLeft';break;case'right':cmd='JustifyRight';break;case'center':cmd='JustifyCenter';break;case'justify':cmd='JustifyFull';break;default:cmd='JustifyNone';}
self.doc.execCommand(cmd,false,null);},removeFormat:function(){self.doc.execCommand('RemoveFormat',false,null);},insertList:function(type){self.doc.execCommand(type=='ordered'?'InsertOrderedList':'InsertUnorderedList',false,null);},insertLink:function(){var url=prompt('Enter the URL','');self.doc.execCommand('CreateLink',false,url);},insertImage:function(){var url=prompt('Enter the image URL','');var range=self.range();var img=self.doc.createElement('img');img.src=url;if(range.insertNode){range.insertNode(img);}else{range.pasteHTML(img.outerHTML);}
return false;},removeLink:function(){self.doc.execCommand('Unlink',false,null);},switchText:function(){self.mode=Wysiwyg.MODE_TEXT;self.setText();self.textarea.display();self.editor.collapse();},switchHTML:function(){self.mode=Wysiwyg.MODE_HTML;self.setHTML();self.textarea.collapse();self.editor.display();},setText:function(){if(self.tidy){self.textarea.value=self.toHtml(self.doc.body,null,null,true);}else{self.textarea.value=self.doc.body.innerHTML;}},setHTML:function(){if(self.doc.body){var html=self.textarea.value;self.doc.body.innerHTML=html;}},switchMode:function(){if(self.mode!=Wysiwyg.MODE_HTML){self.switchHTML();}else{self.switchText();}},allowed_tags:{h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},p:{},b:{},strong:{},i:{},em:{},s:{},del:{},a:{href:true},img:{src:true,alt:true},ul:{},ol:{},li:{},div:{_replace_by:'p'}},toHtml:function(node,padding,pad_with,exclude_name,first){if(!padding){padding='\n';}
if(!pad_with){pad_with='\t';}
switch(node.nodeType){case Mohawk.DOM.TEXT_NODE:case Mohawk.DOM.CDATA_SECTION_NODE:var value=XML.escape(node.nodeValue);value=XML.clean(value);return value;case Mohawk.DOM.ELEMENT_NODE:var tag=node.nodeName.toLowerCase();var str='';if(!(tag in self.allowed_tags)){exclude_name=true;}else{if('_replace_by'in self.allowed_tags[tag]){tag=self.allowed_tags[tag]._replace_by;}}
if(!exclude_name){var str=(!first&&Array.find(XML.inline_elements,tag)===false?padding:'')+'<'+tag;for(var i=0;i<node.attributes.length;i++){if(!(node.attributes[i].nodeName in self.allowed_tags[tag])){continue;}
var value=XML.escape(node.attributes[i].nodeValue.toString());str+=' '+node.attributes[i].nodeName+'="'+value+'"';}
if(!node.childNodes.length&&Array.find(XML.empty_elements,tag)!==false){str+=' />';}else{str+='>';}}
var padding_closing='';if(tag=='pre'){str+=node.innerHTML;}else{node.normalize();var padding_children=!exclude_name?padding+pad_with:padding;var first_child=true;for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];var value=self.toHtml(child,padding_children,pad_with,false,exclude_name&&first_child);str+=value;if(value){first_child=false;}
if(Array.find([Mohawk.DOM.TEXT_NODE,Mohawk.DOM.CDATA_SECTION_NODE],child.nodeType)===false&&child.nodeName&&Array.find(XML.inline_elements,child.nodeName.toLowerCase())===false){padding_closing=padding;}}}
if(node.childNodes.length||Array.find(XML.empty_elements,tag)===false){str+=!exclude_name?(padding_closing+'</'+tag+'>'):'';}
return str;case Mohawk.DOM.DOCUMENT_NODE:return self.toHtml(node.documentElement,padding,pad_with,exclude_name,not_first);default:return'XML: unsupported type of node '+node.nodeType;}}});Wysiwyg.MODE_TEXT='text';Wysiwyg.MODE_HTML='html';Wysiwyg.replace=function(textarea){var wg=new Wysiwyg;wg.set(textarea);return wg;};window.Uploader=new Class({id:'',frame:null,input:null,__construct:function(element){self.frame=DOM.element('iframe',{id:element.id,src:URL.home+'system/upload/',className:'file-upload-frame',allowTransparency:true,scrolling:'no',frameBorder:0});self.frame.addEvent('load',self.onload);self.frame.object=self;element.replace(self.frame);},onload:function(){var frame=window.event?window.event.srcElement:this;var win=frame.contentWindow;if(win.data){frame.object.onUpload(win.data);}},onUpload:function(){}});window.POST_ADDED="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Ваш пост добавлен!"+"\n    <br />Вы можете <a href=\"{%URL.home}{%data.path}\">просмотреть</a> или <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">редактировать</a> его."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Вернуться</a> к вашим постам."+"\n{%elseif ENV.language == 'fr'}"+"\n    Votre billet a été ajoutée!"+"\n    <br />Vous pouvez le <a href=\"{%URL.home}{%data.path}\">voir</a> ou <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">modifier</a>."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Retourner</a> à vos billets."+"\n{%else}"+"\n    Your post has been added!"+"\n    <br />You can <a href=\"{%URL.home}{%data.path}\">view</a> or <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">edit</a> it."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Go back</a> to your posts."+"\n{%end}"+"\n</p>"+"\n";window.POST_EDITED="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Ваш пост отредактирован"+"\n    <br />Вы можете <a href=\"{%URL.home}{%data.path}\">перейти к его просмотру</a> или <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">продолжить редактирование</a>."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Вернуться</a> к вашим постам."+"\n{%elseif ENV.language == 'fr'}"+"\n    Votre billet a été modifié!"+"\n    <br />Vous pouvez le<a href=\"{%URL.home}{%data.path}\">voir</a> ou <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">continuer à modifier</a>."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Вернуться</a> к вашим постам."+"\n{%else}"+"\n    Your post has been edited!"+"\n    <br />You can <a href=\"{%URL.home}{%data.path}\">view</a> or <a href=\"{%URL.home}users/{%ENV.user.login}/posts/{%data.id}/edit/\">continue editing</a> it."+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Go back</a> to your posts."+"\n{%end}"+"\n</p>"+"\n";window.POST_REMOVED="<p>"+"\n{%if ENV.language == 'ru'}"+"\n    Ваш пост удален!"+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Вернуться</a> к вашим постам."+"\n{else%if ENV.language == 'fr'}"+"\n    Votre billet a été supprimé!"+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Retourner</a> à vos billets."+"\n{%else}"+"\n    Your post has been deleted!"+"\n    <br /><a href=\"{%URL.home}users/{%ENV.user.login}/posts/\">Go back</a> to your posts."+"\n{%end}"+"\n</p>"+"\n";document.addLoader(function(){window.Me={};if(ID('profile-form')){Me.Profile={init:function(){var form=ID('profile-form');var inputs=[form.getElementsByTagName('input')];inputs[1]=form.getElementsByTagName('textarea');for(var k=0;k<inputs.length;k++){for(var i=0;i<inputs[k].length;i++){var input=inputs[k][i];input.onfocus=function(){if(this.value==this.title){this.value='';this.removeClass('empty');}};input.onblur=function(){if(this.value==''){this.value=this.title;this.addClass('empty');}};input.onchange=function(){Me.Profile.save(this);};if(input.value==''){input.value=input.title;input.addClass('empty');}}}},save:function(element){var req=new Ajax(URL.home+'api/settings/info/',Ajax.METHOD_POST);req.responseHandler=function(req){var item=req.data.item;if(!item){Progress.done('Error');Console.log(req.data.error);}else{Progress.done('Done',true);}};var data={};data[element.name]=element.value;req.send({data:data});},setPublic:function(value){var req=new Ajax(URL.home+'api/settings/info/',Ajax.METHOD_POST);var container=ID('profile-publicity');container.addClass('loading');req.responseHandler=function(req){var item=req.data.item;if(!item){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading');if(item['public']=='1'){container.addClass('public');container.removeClass('private');}else{container.addClass('private');container.removeClass('public');}
Progress.done('Done',true);}};var data={'public':value};req.send({data:data});}};Me.Profile.init();}
if(ID('profile-picture-uploader')){Me.Uploader=new Uploader(ID('profile-picture-uploader'));Me.Uploader.onUpload=function(data){if(!data||!data.file){Progress.done('Error');return;}
var req=new Ajax(URL.home+'api/settings/picture/',Ajax.METHOD_POST);req.responseHandler=function(req){var item=req.data.item;if(!item){Progress.done('Error: '+req.data.error);}else{var container=ID('profile-picture');container.removeClass('empty');var img=DOM.element('img',{src:URL.userpics+item.picture});if(container.firstTag('img')){container.replaceChild(img,container.firstTag('img'));}else{container.insertFirst(img);}
Progress.done('Done',true);}};req.send({tmp_name:data.file.tmp_name,real_name:data.file.name});};}
window.Connection=new Singletone({request:function(id,element){self.setStatus(true,id,element);},remove:function(id,element){self.setStatus(false,id,element);},setStatus:function(value,id,element){var req=new Ajax(URL.home+'api/connections/'+id+'/',value?Ajax.METHOD_POST:Ajax.METHOD_DELETE);var container=element?element.ancestorTag('div'):ID('connection-status');container.removeClass('loading','none','requested','accepted');container.addClass('loading');req.responseHandler=function(req){if(req.data.status===undefined){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading','none','requested','accepted');if(req.data.status=='1'){container.addClass('requested');}else{container.addClass('none');}
Progress.done('Done',true);}};req.send();}});window.Notifications=new Singletone({read:function(element){var m=element.id.match(/notification-(\d+)/);var id=m[1];var req=new Ajax(URL.home+'api/notifications/'+id+'/',Ajax.METHOD_POST);req.responseHandler=function(){window.location=element.href;Progress.done(LNG.Done,true);};req.send();Progress.load(LNG.Loading);return false;},readAll:function(){var req=new Ajax(URL.home+'api/notifications/readall/',Ajax.METHOD_POST);req.responseHandler=function(req){if(req.data.ok){var container=ID('notifications');if(container){ID('notifications').remove(Effects.vanish);}}
Progress.done(LNG.Done,true);};req.send();Progress.load(LNG.Loading);return false;}});if(IE&&!IE8){var menu=ID('userbox-menu');if(menu){var name=ID('userbox-name');menu.appendTo(document.body);menu.alignTo(name,'left',true);menu.adjoinTo(name,'bottom',true);menu.style.width=name.offsetWidth+32+'px';menu.style.marginTop='1px';menu.style.marginLeft='-1px';name.onmouseover=function(){menu.style.display='block';};name.onmouseout=function(){menu.style.display='none';};menu.onmouseover=function(){menu.style.display='block';name.parentNode.addClass('over');};menu.onmouseout=function(){menu.style.display='none';name.parentNode.removeClass('over');};}
var list=ID('notifications-list');if(list){var indicator=ID('notifications-indicator');list.appendTo(document.body);list.adjoinTo(indicator,'bottom',true);list.style.marginTop='1px';list.style.marginLeft='1px';indicator.onmouseover=function(){list.style.display='block';list.alignTo(indicator,'right',true);};indicator.onmouseout=function(){list.style.display='none';};list.onmouseover=function(){list.style.display='block';indicator.parentNode.addClass('over');};list.onmouseout=function(){list.style.display='none';indicator.parentNode.removeClass('over');};}}
function profile_url(){var container=ID('profile-url');if(!container||container.tagName!='SPAN'){return;}
var url=container.title;if(!url.match(/http:\/\//)){url='http://'+url;}
container.replace(DOM.element('a',{href:url,html:container.innerHTML}));}
profile_url();});document.addLoader(function(){if(document.body.id!='me-index-page'){return;}
window.Charts=new ChartsApi;window.Goals=new GoalsApi;Shadow.init();Me.Constructor=new ChartConstructor;Data.layout=[{id:1},{id:2},{id:3,size:'wide'}];Data.layout_chart={};Data.chart_layout={};foreach(Data.layout,function(i,layout){foreach(Data.charts,function(j,chart){if(layout.id==chart.position){chart.accumulate*=1;chart.interpolate*=1;chart.fill_empty*=1;Data.layout[i].chart=chart;Data.layout_chart[layout.id]=chart.id;Data.chart_layout[chart.id]=layout.id;}});});Me.Layout=new MeLayout('me-layout',Data.layout);ID('me-layout').replace(Me.Layout.element);Me.Chart=ChartFactory.factory(ENV.chart_type);Observer.add('chart-added',function(item){Data.chart_layout[item.id]=item.position;Data.layout_chart[item.position]=item.id;var node=Me.Layout.getNode(item.position);item.accumulate*=1;item.interpolate*=1;item.fill_empty*=1;node.data.chart=item;node.removeClass('empty');draw_node_chart(node);});Observer.add('chart-edited',function(item){var node=Me.Layout.getNode(item.position);item.accumulate*=1;item.interpolate*=1;item.fill_empty*=1;node.data.chart=item;node.header.setHTML(item.title||'');node.removeClass('empty');draw_node_chart(node);});Observer.add('chart-removed',function(id){var layout=Data.chart_layout[id];var node=Me.Layout.getNode(layout);node.clear();delete(Data.chart_layout[id]);delete(Data.layout_chart[layout]);});function draw_node_chart(node){var chart=node.data.chart;if(chart){ChartData.setGoalId(chart.goal);ChartData.setGroup(chart.groupby);ChartData.setPeriod(chart.period);var data;if(chart.type=='pie'){data=ChartData.getBooleanData();}else{data=chart.accumulate?ChartData.getAccumulatedData():ChartData.getGroupedData();}
var w=node.data.size=='wide'?662:320;var h=240;Me.Chart.set({canvas:node.canvas.id,width:w,height:h,type:chart.type,interpolate:chart.interpolate,data:data});Me.Chart.draw();}}
foreach(Me.Layout.element.childNodes,function(i,node){draw_node_chart(node);});});document.addLoader(function(){if(document.body.id!='me-goals-page'){return;}
window.Goals=new GoalsApi;Me.Goals=new MeGoals('me-goals-list',Data.goals);ID('me-goals-list').replace(Me.Goals.element);Observer.add('goal-edited',function(item){var node=Me.Goals.getNode(item.id);node.replaceClass('loading',item.privacy);});});document.addLoader(function(){if(document.body.id!='me-posts-add'){return;}
window.Posts=new(CommonFormProcessor.extend({template:POST_ADDED,Wg:Wysiwyg.replace(ID('post-text')),Form:ID('me-post-form'),submit:function(form){self.Wg.setText();parent.submit(form);},fetch:function(form){var req=new Ajax(URL.home+'api/fetch-link/');req.responseHandler=function(req){var item=req.data.item;if(!item){item={title:'',body:''};}
self.Form.setData({title:item.title,text:item.body},'data');self.Wg.setHTML();ID('post-fetch').addClass('hidden');ID('post-title').ancestorTag('li').removeClass('hidden');ID('post-text').ancestorTag('li').removeClass('hidden');ID('post-save').removeClass('hidden');Progress.done(LNG.Done,true);};var data=form.getData();req.send({url:data['data[url]']});Progress.load(LNG.Submitting);},setType:function(type){switch(type){case'link':ID('post-url').ancestorTag('li').removeClass('hidden');ID('post-fetch').removeClass('hidden');ID('post-title').ancestorTag('li').addClass('hidden');ID('post-text').ancestorTag('li').addClass('hidden');ID('post-save').addClass('hidden');break;default:case'post':ID('post-url').ancestorTag('li').addClass('hidden');ID('post-fetch').addClass('hidden');ID('post-title').ancestorTag('li').removeClass('hidden');ID('post-text').ancestorTag('li').removeClass('hidden');ID('post-save').removeClass('hidden');break;}}}));});document.addLoader(function(){if(document.body.id!='me-posts-edit'){return;}
window.Wg=Wysiwyg.replace(ID('post-text'));window.Posts=new(CommonFormProcessor.extend({template:POST_EDITED,method:Ajax.METHOD_PUT,submit:function(form){Wg.setText();parent.submit(form);}}));window.PostsRemove=new(CommonFormProcessor.extend({template:POST_REMOVED,method:Ajax.METHOD_DELETE,submit:function(form){if(!confirm('Delete?')){return false;}
parent.submit(form);return false;}}));});
Mohawk.Loader.extendLanguage({"Ninja_Detected":"Ninja Is Detected","Ninja_detected":"Ninja is detected","NINJA_DETECTED":"NINJA IS DETECTED","ninja_detected":"ninja is detected","Upload_Picture":"Upload Picture","Upload_picture":"Upload picture","UPLOAD_PICTURE":"UPLOAD PICTURE","upload_picture":"upload picture","Profile_Name_Hint":"Your Name","Profile_name_hint":"Your name","PROFILE_NAME_HINT":"YOUR NAME","profile_name_hint":"your name","Profile_Location_Hint":"Where In The World Are You?","Profile_location_hint":"Where in the world are you?","PROFILE_LOCATION_HINT":"WHERE IN THE WORLD ARE YOU?","profile_location_hint":"where in the world are you?","Profile_Url_Hint":"Your Homepage Or A Blog Url","Profile_url_hint":"Your homepage or a blog URL","PROFILE_URL_HINT":"YOUR HOMEPAGE OR A BLOG URL","profile_url_hint":"your homepage or a blog URL","Profile_Bio_Hint":"Few Words About Yourself","Profile_bio_hint":"Few words about yourself","PROFILE_BIO_HINT":"FEW WORDS ABOUT YOURSELF","profile_bio_hint":"few words about yourself","Profile_Is_Private":"Your Profile Is Private","Profile_is_private":"Your profile is private","PROFILE_IS_PRIVATE":"YOUR PROFILE IS PRIVATE","profile_is_private":"your profile is private","Profile_Is_Public":"Your Profile Is Public","Profile_is_public":"Your profile is public","PROFILE_IS_PUBLIC":"YOUR PROFILE IS PUBLIC","profile_is_public":"your profile is public","Picture_Upload_Help":"Choose A File From Your Computer: Jpeg Or Png Format, 2Mb Max","Picture_upload_help":"Choose a file from your computer: JPEG or PNG format, 2Mb max","PICTURE_UPLOAD_HELP":"CHOOSE A FILE FROM YOUR COMPUTER: JPEG OR PNG FORMAT, 2MB MAX","picture_upload_help":"Choose a file from your computer: JPEG or PNG format, 2Mb max","Friends":"Friends","FRIENDS":"FRIENDS","friends":"friends","Your_Friends":"Your Friends","Your_friends":"Your friends","YOUR_FRIENDS":"YOUR FRIENDS","your_friends":"your friends","Find_Friends":"Find Friends","Find_friends":"Find friends","FIND_FRIENDS":"FIND FRIENDS","find_friends":"find friends","Requests_In":"Requests To You","Requests_in":"Requests to you","REQUESTS_IN":"REQUESTS TO YOU","requests_in":"requests to you","Requests_Out":"Requests You Have Sent","Requests_out":"Requests you have sent","REQUESTS_OUT":"REQUESTS YOU HAVE SENT","requests_out":"requests you have sent","People_Near_You":"People Near You","People_near_you":"People near you","PEOPLE_NEAR_YOU":"PEOPLE NEAR YOU","people_near_you":"people near you","Recent_Users":"Recent Users","Recent_users":"Recent users","RECENT_USERS":"RECENT USERS","recent_users":"recent users","Similar_To_You":"Similar To You","Similar_to_you":"Similar to you","SIMILAR_TO_YOU":"SIMILAR TO YOU","similar_to_you":"similar to you","Add_Friend":"Add Friend","Add_friend":"Add friend","ADD_FRIEND":"ADD FRIEND","add_friend":"add friend","Remove_Friend":"Remove Friend","Remove_friend":"Remove friend","REMOVE_FRIEND":"REMOVE FRIEND","remove_friend":"remove friend","Cancel_Request":"Cancel Request","Cancel_request":"Cancel request","CANCEL_REQUEST":"CANCEL REQUEST","cancel_request":"cancel request","All_Users":"All Users","All_users":"All users","ALL_USERS":"ALL USERS","all_users":"all users","By_Location":"By Location","By_location":"By location","BY_LOCATION":"BY LOCATION","by_location":"by location","Search":"Search","SEARCH":"SEARCH","search":"search","Search_Results":"Search Results","Search_results":"Search results","SEARCH_RESULTS":"SEARCH RESULTS","search_results":"search results","Compare_What":"What","Compare_what":"What","COMPARE_WHAT":"WHAT","compare_what":"what","Compare_With":"With","Compare_with":"With","COMPARE_WITH":"WITH","compare_with":"with","Compare_Comment":"Comment","Compare_comment":"Comment","COMPARE_COMMENT":"COMMENT","compare_comment":"comment","Send_Request":"Send Request","Send_request":"Send request","SEND_REQUEST":"SEND REQUEST","send_request":"send request","Invited_Compares":"Invited Compares","Invited_compares":"Invited compares","INVITED_COMPARES":"INVITED COMPARES","invited_compares":"invited compares","Your_Compares":"Your Compares","Your_compares":"Your compares","YOUR_COMPARES":"YOUR COMPARES","your_compares":"your compares","Accept":"Accept","ACCEPT":"ACCEPT","accept":"accept","Reject":"Reject","REJECT":"REJECT","reject":"reject","Accepted":"Accepted","ACCEPTED":"ACCEPTED","accepted":"accepted","Rejected":"Rejected","REJECTED":"REJECTED","rejected":"rejected","Not_Accepted":"Not Accepted","Not_accepted":"Not accepted","NOT_ACCEPTED":"NOT ACCEPTED","not_accepted":"not accepted","Waiting_For_Response":"Waiting For Response","Waiting_for_response":"Waiting for response","WAITING_FOR_RESPONSE":"WAITING FOR RESPONSE","waiting_for_response":"waiting for response","Choose_Goal":"Choose Goal","Choose_goal":"Choose goal","CHOOSE_GOAL":"CHOOSE GOAL","choose_goal":"choose goal","Create_New_Goal":"Create A New Goal","Create_new_goal":"Create a new goal","CREATE_NEW_GOAL":"CREATE A NEW GOAL","create_new_goal":"create a new goal","Badges":"Badges","BADGES":"BADGES","badges":"badges","Premium_User":"Premium User","Premium_user":"Premium user","PREMIUM_USER":"PREMIUM USER","premium_user":"premium user","Free_Account_User":"Free Account User","Free_account_user":"Free account user","FREE_ACCOUNT_USER":"FREE ACCOUNT USER","free_account_user":"free account user","Mark_All_As_Read":"Mark All As Read","Mark_all_as_read":"Mark all as read","MARK_ALL_AS_READ":"MARK ALL AS READ","mark_all_as_read":"mark all as read"})
window.OWNED_COMPARISON="<div class=\"left\">"+"\n    <h3>"+"\n        <img src=\"{%if ENV.user.thumbnail}{%URL.userpics}{%ENV.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" />"+"\n        <a href=\"{%URL.home}users/{%ENV.user.login}/\">{%ENV.user.name}</a>"+"\n    </h3>"+"\n    <h4>{%owner.goal.title}</h4>"+"\n    {%if comparison.comment}<blockquote>&laquo;{%comparison.comment|htmlspecialchars}&raquo;</blockquote>{%end}"+"\n    <div class=\"buttons\">"+"\n        <button type=\"button\" class=\"button\" onclick=\"Comparisons.remove({%comparison.id})\"><span><span>{%LNG.Del}</span></span></button>"+"\n    </div>"+"\n</div>"+"\n<div class=\"right\">"+"\n    <ul>"+"\n        {%for item in others}"+"\n        <li>"+"\n            <h3>"+"\n                <img src=\"{%if item.user.thumbnail}{%URL.userpics}{%item.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" />"+"\n                <a href=\"{%URL.home}users/{%item.user.login}/\">{%item.user.name}</a>"+"\n            </h3>"+"\n            <h4>"+"\n                {%if item.status == 'requested'}"+"\n                    <i>{%LNG.Waiting_for_response}</i>"+"\n                {%elseif item.status == 'rejected'}"+"\n                    <i>{%LNG.Not_accepted}</i>"+"\n                {%else}"+"\n                    {%item.goal.title}"+"\n                {%end}"+"\n            </h4>"+"\n        </li>"+"\n        {%end}"+"\n    </ul>"+"\n</div>";window.INVITED_COMPARISON="<form>"+"\n    <input type=\"hidden\" name=\"id\" value=\"{%current.id}\" />"+"\n    <input type=\"hidden\" name=\"comparison\" value=\"{%comparison.id}\" />"+"\n    <div class=\"left\">"+"\n        <h3>"+"\n            <img src=\"{%if owner.user.thumbnail}{%URL.userpics}{%owner.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" />"+"\n            <a href=\"{%URL.home}users/{%owner.user.login}/\">{%owner.user.name}</a>"+"\n        </h3>"+"\n        <h4>{%owner.goal.title}</h4>"+"\n        {%if comparison.comment}<blockquote>&laquo;{%comparison.comment|htmlspecialchars}&raquo;</blockquote>{%end}"+"\n    </div>"+"\n    <div class=\"right\">"+"\n    {%if current.status == 'requested'}"+"\n        <ul class=\"fields\">"+"\n            <li>"+"\n                <input type=\"radio\" id=\"choose-goal-{%current.id}\" name=\"create_new\" value=\"0\" checked=\"checked\" />"+"\n                <label class=\"inline\" for=\"choose-goal-{%current.id}\">{%LNG.choose_goal}:</label>"+"\n                    <select name=\"goal\">"+"\n                    {%for goal in Data.goals}"+"\n                        <option value=\"{%goal.id}\">{%goal.title}</option>"+"\n                    {%end}"+"\n                    </select>"+"\n            </li>"+"\n            <li>"+"\n                <input type=\"radio\" id=\"create-goal-{%current.id}\" name=\"create_new\" value=\"1\" />"+"\n                <label class=\"inline\" for=\"create-goal-{%current.id}\">{%LNG.create_new_goal} \"{%owner.goal.title}\"</label>"+"\n            </li>"+"\n        </ul>"+"\n        <div class=\"buttons\">"+"\n            <button type=\"button\" class=\"button\" onclick=\"Comparisons.accept(this.form)\"><span><span>{%LNG.Accept}</span></span></button>"+"\n            <span>or</span>"+"\n            <button type=\"button\" class=\"button\" onclick=\"Comparisons.reject(this.form)\"><span><span>{%LNG.Reject}</span></span></button>"+"\n        </div>"+"\n    {%else}"+"\n        <h3>"+"\n            <img src=\"{%if current.user.thumbnail}{%URL.userpics}{%current.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" />"+"\n            <a href=\"{%URL.home}users/{%current.user.login}/\">{%current.user.name}</a>"+"\n        </h3>"+"\n        <h4>"+"\n            {%if current.status == 'rejected'}"+"\n                <i>{%LNG.Rejected}</i>"+"\n            {%elseif current.status == 'accepted'}"+"\n                {%if current.goal.title == '?'} "+"\n                <i>{%LNG.Accepted}</i>"+"\n                {%else}"+"\n                {%current.goal.title}"+"\n                {%end}"+"\n            {%end}"+"\n        </h4>"+"\n        {%if current.status == 'accepted'}"+"\n        <div class=\"buttons\">"+"\n            <button type=\"button\" class=\"button\" onclick=\"Comparisons.reject(this.form)\"><span><span>{%LNG.Del}</span></span></button>"+"\n        </div>"+"\n        {%end}"+"\n    </div>"+"\n    {%end}"+"\n</form>";document.addLoader(function(){if(document.body.id!='me-compares-page'){return;}
var ComparesList=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.purgeChildren();var is_owner=data.user==ENV.UID;var owner=null,current=null,others=[];foreach(data.items,function(i,item){var item=Object.clone(item);if(item.user==ENV.UID){item.user=ENV.user;item.user.id=ENV.UID;}else{item.user=item.user in Data.friends?Data.friends[item.user]:{id:item.user,name:'?'};}
item.goal=item.goal_info||(item.goal in Data.goals?Data.goals[item.goal]:{id:item.goal,title:'?'});if(item.user.id==data.user){owner=item;if(is_owner){current==item;}}else if(item.user.id==ENV.UID){current=item;}else{others.push(item);}});Template.assign('comparison',{id:data.id,user:data.user,comment:data.comment});Template.assign('owner',owner);Template.assign('current',current);Template.assign('others',others);if(is_owner){node.setHTML(Template.transform(OWNED_COMPARISON));}else{node.setHTML(Template.transform(INVITED_COMPARISON));}
return node;}});if(ID('owned-compares')){window.OwnedCompares=new ComparesList('owned-compares',Object.values(Data.owned_compares));OwnedCompares.element.addClass('compare-list');ID('owned-compares').replace(OwnedCompares.element);}
if(ID('invited-compares')){window.InvitedCompares=new ComparesList('invited-compares',Object.values(Data.invited_compares));InvitedCompares.element.addClass('compare-list');ID('invited-compares').replace(InvitedCompares.element);}
window.Comparisons=new Singletone({submit:function(form){var req=new Ajax(URL.home+'api/comparisons/',Ajax.METHOD_POST);var data=form.getData();req.responseHandler=function(req){var item=req.data.item;OwnedCompares.addNode(item);Progress.done(LNG.Done,true);form.reset();};req.send(data);Progress.load(LNG.Submitting);},remove:function(id){if(!confirm(LNG.Confirm_delete)){return;}
var req=new Ajax(URL.home+'api/comparisons/'+id+'/',Ajax.METHOD_DELETE);req.responseHandler=function(req){var item=req.data.item;OwnedCompares.removeNode(OwnedCompares.getNode(item));Progress.done(LNG.Done,true);};req.send();Progress.load(LNG.Deleting);},accept:function(form){var data=form.getData();var req=new Ajax(URL.home+'api/comparisons/accept/'+data.id+'/',Ajax.METHOD_POST);req.responseHandler=function(req){var item=req.data.item;var node=InvitedCompares.getNode(data.comparison);var node_data=node.data;foreach(node_data.items,function(i,item){if(item.user==ENV.UID){item.status='accepted';}});InvitedCompares.editNode(node,node_data);Progress.done(LNG.Done,true);};req.send(data);Progress.load(LNG.Submitting);},reject:function(form){var data=form.getData();var req=new Ajax(URL.home+'api/comparisons/reject/'+data.id+'/',Ajax.METHOD_POST);req.responseHandler=function(req){OwnedCompares.removeNode(InvitedCompares.getNode(data.comparison));Progress.done(LNG.Done,true);};req.send(data);Progress.load(LNG.Submitting);}});});
window.ProfileLayout=Mohawk.UI.List.extend({createNode:function(data){var node=parent.createNode(data);node.setHTML('');if(data.size){node.addClass(data.size);}
node.addClass('static');node.canvas=DOM.element('div',{id:node.id+'-canvas',className:'canvas',appendTo:node});node.header=DOM.element('h2',{html:data.chart?data.chart.title:'',appendTo:node});return node;}});window.ProfileGoals=new Class({__construct:function(id,goals){self.table=DOM.element('table',{id:id});self.head=DOM.element('thead',{appendTo:self.table});self.headRow=DOM.element('tr',{appendTo:self.head});self.tbody=DOM.element('tbody',{appendTo:self.table});var today=Date.fromString(Data.today);var day=Date.fromString(Data.start||Data.today);self.day=day.clone();var th=DOM.element('th',{appendTo:self.headRow});if(ENV.UID==ENV.current_user.id){DOM.element('img',{src:URL.img+'site/chart-edit.png',appendTo:th,onclick:function(){Observer.fire('profile-goals-edit-click');}});}
for(var i=1;i<=7;i++,day=day.addDay()){var cell=self.createHeadCell(day,today);self.headRow.appendChild(cell);}
foreach(goals,function(i,goal){var row=self.createRow(goal);self.tbody.appendChild(row);});},createHeadCell:function(day,today){var cell=document.createElement('TD');cell.data={date:day};cell.id=day.getId();var date=Format.date(day,ENV.language=='ru'?'j M':'M j');var week=Format.date(day,'D');var is_today=day.getFullYear()==today.getFullYear()&&day.getMonth()==today.getMonth()&&day.getDate()==today.getDate();cell.setHTML('<b>'+week+'</b><br />'+date);if(is_today){cell.addClass('today');}
var w=day.getDay();if(w==0||w==6){cell.addClass('weekend');}
return cell;},createRow:function(data){var row=DOM.element('tr',{id:'goal-'+data.id});if(data.privacy!='public'&&data.user==ENV.UID){row.addClass('hidden');}
row.data=data;var title=DOM.element('th',{html:data.title,appendTo:row});if(data.user!=ENV.current_user.id){title.setHTML('');DOM.element('img',{src:URL.img+'site/compared-with.png',appendTo:title});if(data.user_data){DOM.element('a',{href:URL.home+'users/'+data.user_data.login+'/goals/',html:data.user_data.name||'?',appendTo:title});}else{DOM.element('i',{html:'?',appendTo:title});}}
var head=self.headRow.childNodes;for(var i=1;i<head.length;i++){var col=head[i];var cell=self.createDataCell(row,col);row.appendChild(cell);}
return row;},createDataCell:function(row,col){var id=row.data.id;var date=Format.date(col.data.date,'Y-m-d');var data=self.getData(id,date);var value=data.value||0;var cell=DOM.element('td',{id:id+'-'+date});if(col.hasClass('today')){cell.addClass('today');}
cell.row=row;cell.col=col;switch(row.data.type){case'numeric':var number=DOM.element('DIV',{className:'number',appendTo:cell,html:data.value});break;case'counter':for(var i=0;i<data.value;i++){if(i>20){break;}
var img=DOM.element('img',{className:'item',src:Data.icons[cell.row.data.icon_item],appendTo:cell});}
break;case'boolean':if(data.value==='1'||data.value==='0'){var img=DOM.element('img',{src:data.value==='1'?Data.icons[row.data.icon_true]:Data.icons[row.data.icon_false],appendTo:cell});}
break;case'time':case'timer':var time=DOM.element('div',{className:'time',appendTo:cell});var html='<span class="hours">{%h}</span>'
+'<span class="tick">:</span>'
+'<span class="mins">{%m}</span>'
+'<span class="secs">{%s}</span>';time.setHTML(self.formatTime(data.value,html));break;default:}
cell.addClass(row.data.type);return cell;},formatTime:function(val,template){val=parseFloat(val);if(isNaN(val)){return'';}
var hours=Math.floor(val/3600);val-=hours*3600;var mins=Math.floor(val/60);var secs=Math.floor(val-mins*60);hours=hours.toString().pad(2,'0');mins=mins.toString().pad(2,'0');secs=secs.toString().pad(2,'0');Template.assign('h',hours);Template.assign('m',mins);Template.assign('s',secs);return Template.transform(template);},getData:function(id,date){var data={value:''};if(id in Data.data){if(date in Data.data[id]){data=Data.data[id][date];}}
return data;}});Mohawk.Loader.extendLanguage({"Edit_Post":"Edit Post","Edit_post":"Edit post","EDIT_POST":"EDIT POST","edit_post":"edit post","Add_Post":"Write A Post","Add_post":"Write a post","ADD_POST":"WRITE A POST","add_post":"write a post","Comments":"Comments","COMMENTS":"COMMENTS","comments":"comments","Reply":"Reply","REPLY":"REPLY","reply":"reply","Leave_Comment":"Leave A Comment","Leave_comment":"Leave a comment","LEAVE_COMMENT":"LEAVE A COMMENT","leave_comment":"leave a comment","Login_To_Comment":"Log In To Leave A Comment","Login_to_comment":"Log in to leave a comment","LOGIN_TO_COMMENT":"LOG IN TO LEAVE A COMMENT","login_to_comment":"log in to leave a comment","Go_To_Posts":"Go To Your Posts","Go_to_posts":"Go to your posts","GO_TO_POSTS":"GO TO YOUR POSTS","go_to_posts":"go to your posts","Where_To_Publish":"Where To Publish","Where_to_publish":"Where to publish","WHERE_TO_PUBLISH":"WHERE TO PUBLISH","where_to_publish":"where to publish","Personal_Blog":"Personal Blog","Personal_blog":"Personal blog","PERSONAL_BLOG":"PERSONAL BLOG","personal_blog":"personal blog","Text":"Text","TEXT":"TEXT","text":"text","Just_Now":"Just Now","Just_now":"Just now","JUST_NOW":"JUST NOW","just_now":"just now","New_Comment_From":"New Comment From","New_comment_from":"New comment from","NEW_COMMENT_FROM":"NEW COMMENT FROM","new_comment_from":"new comment from","Share_A":"Share A","Share_a":"Share a","SHARE_A":"SHARE A","share_a":"share a","Share_Post":"Post","Share_post":"Post","SHARE_POST":"POST","share_post":"post","Share_Link":"Link","Share_link":"Link","SHARE_LINK":"LINK","share_link":"link","Share_In":"In","Share_in":"In","SHARE_IN":"IN","share_in":"in"})
window.COMMENT_ADDED="<img src=\"{%if ENV.user.thumbnail}{%URL.userpics}{%ENV.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" class=\"userpic\" />"+"\n<div class=\"comment\">"+"\n    <b><a href=\"{%URL.home}users/{%ENV.user.login}/\">{%ENV.user.name}</a></b>"+"\n    <div class=\"text\">{%if data.text}{%data.text|htmlspecialchars}{%end}</div>"+"\n    <div class=\"meta\">"+"\n        <small>{%LNG.just_now}</small>"+"\n        <a href=\"#reply-{%data.id}\" class=\"script\">{%LNG.reply}</a>"+"\n    </div>"+"\n</div>";window.COMMENT_FORM="{%if ENV.UID}"+"\n<fieldset>"+"\n    <input type=\"hidden\" name=\"thread_type\" value=\"{%ENV.thread_type}\" />"+"\n    <input type=\"hidden\" name=\"thread_id\" value=\"{%ENV.thread_id}\" />"+"\n    <input type=\"hidden\" name=\"thread_chk\" value=\"{%ENV.thread_chk}\" />"+"\n    <input type=\"hidden\" name=\"reply_to\" value=\"0\" />"+"\n    <img src=\"{%if ENV.user.thumbnail}{%URL.userpics}{%ENV.user.thumbnail}{%else}{%URL.img}site/no-thumbnail.png{%end}\" />"+"\n    <div class=\"text\"><textarea name=\"text\"></textarea></div>"+"\n    <div class=\"buttons\">"+"\n        <button class=\"button\" type=\"submit\"><span><span>{%LNG.Submit}</span></span></button>"+"\n    </div>"+"\n</fieldset>"+"\n{%end}";document.addLoader(function(){window.Comments=new(CommonFormProcessor.extend({template:COMMENT_ADDED,successHandler:function(req){Progress.done(LNG.Done||'Done',true);if(self.template){Template.assign('data',req.data.item);var li=DOM.element('li',{html:Template.transform(self.template),id:'comment-'+req.data.item.id});self.form.parentNode.replace(li);}
self.form.reset();window.location.hash='comment-'+req.data.item.id;}}));Comments.Form=DOM.element('form',{id:'comment-form',action:URL.home+'api/comments/',method:Ajax.METHOD_POST,onsubmit:function(){Comments.submit(this);return false;},html:Template.transform(COMMENT_FORM)});var set_form=function(id){if(!ENV.UID){return;}
var item=ID('comment-'+id)||ID('comments-list');if(!item){return;}
var list=item.firstTag('ul');if(!list){list=DOM.element('ul',{appendTo:item});}
if(!Comments.Form.parentNode||Comments.Form.parentNode.nodeType!=DOM.ELEMENT_NODE){Comments.Form.appendTo(DOM.element('li'));}
list.appendChild(Comments.Form.parentNode);Comments.Form.setData({reply_to:id});Effects.scrollTo(Comments.Form);};set_form(0);AnchorObserver.add('reply-(\\d+)',set_form);AnchorObserver.start();});document.addLoader(function(){if(document.body.id!='users-page'){return;}
Data.layout=[{id:1},{id:2},{id:3,size:'wide'}];foreach(Data.layout,function(i,layout){foreach(Data.charts,function(j,chart){if(layout.id==chart.position){Data.layout[i].chart=chart;}});});if(Data.charts&&!(Data.charts instanceof Array&&!Data.charts.length)){Me.Layout=new ProfileLayout('me-layout',Data.layout);ID('me-layout').replace(Me.Layout.element);Me.Chart=ChartFactory.factory(ENV.chart_type);foreach(Data.charts,function(i,chart){var node=Me.Layout.getNode(chart.position);node.header.setHTML(chart.title);var w=node.hasClass('wide')?662:320;var h=240;Me.Chart.set({canvas:node.canvas.id,width:w,height:h,type:chart.type,data:Object.values(chart.data),interpolate:chart.interpolate*1});Me.Chart.draw();});};});document.addLoader(function(){if(document.body.id!='users-goals-page'){return;}
Me.editGoals=function(){ID('me-goals-table-wrap').addClass('hidden');ID('me-goals-list-wrap').removeClass('hidden');};Me.doneGoals=function(){ID('me-goals-table-wrap').removeClass('hidden');ID('me-goals-list-wrap').addClass('hidden');};window.GoalsTable=new ProfileGoals('me-goals',Data.goals);var user_goals=[];foreach(Data.goals,function(i,goal){if(goal.user==ENV.UID){user_goals.push(goal);}});window.GoalsList=new MeGoals('me-goals-list',user_goals);ID('me-goals').replace(GoalsTable.table);ID('me-goals-list').replace(GoalsList.element);ID('me-goals-list-wrap').addClass('hidden');Observer.add('profile-goals-edit-click',Me.editGoals);window.Goals=new GoalsApi;Observer.add('goal-edited',function(item){var node=GoalsList.getNode(item.id);node.replaceClass('loading',item.privacy);var row=ID('goal-'+item.id);if(item.privacy=='private'){row.addClass('hidden');}else{row.removeClass('hidden');}});});
document.addLoader(function(){window.Community=new Singletone({join:function(){self.setMembership(true);},leave:function(){self.setMembership(false);},setMembership:function(value){var req=new Ajax(URL.home+'api/communities/'+ENV.community.id+'/'+(value?'join':'leave')+'/',Ajax.METHOD_POST);var container=ID('community-membership');container.addClass('loading');req.responseHandler=function(req){var member=req.data.member;if(!member){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading');if(member=='1'){container.addClass('joined');container.removeClass('not-joined');}else{container.addClass('not-joined');container.removeClass('joined');}
Progress.done('Done',true);}};req.send();},assignAdmin:function(user,element){self.setRole(true,user,element);},removeAdmin:function(user,element){self.setRole(false,user,element);},setRole:function(value,user,element){var req=new Ajax(URL.home+'api/communities/'+ENV.community.id+'/admin/',value?Ajax.METHOD_POST:Ajax.METHOD_DELETE);var container=element.ancestorTag('div');container.removeClass('loading','admin','member');container.addClass('loading');req.responseHandler=function(req){var ok=req.data.ok;if(!ok){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading','admin','member');if(value){container.addClass('admin');}else{container.addClass('member');}
Progress.done('Done',true);}};req.send({user:user});}});});document.addLoader(function(){if(document.body.id!='communities-page'){return;}
window.Community=new Singletone({join:function(){self.setMembership(true);},leave:function(){self.setMembership(false);},setMembership:function(value){var req=new Ajax(URL.home+'api/communities/'+ENV.community.id+'/'+(value?'join':'leave')+'/',Ajax.METHOD_POST);var container=ID('community-membership');container.addClass('loading');req.responseHandler=function(req){var member=req.data.member;if(!member){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading');if(member=='1'){container.addClass('joined');container.removeClass('not-joined');}else{container.addClass('not-joined');container.removeClass('joined');}
Progress.done('Done',true);}};req.send();},makeAdmin:function(user,element){self.setRole(true,user,element);},removeAdmin:function(user,element){self.setRole(false,user,element);},setRole:function(value,user,element){var req=new Ajax(URL.home+'api/communities/'+ENV.community.id+'/admin/',value?Ajax.METHOD_POST:Ajax.METHOD_DELETE);var container=element.ancestorTag('div');container.removeClass('loading','admin','member');container.addClass('loading');req.responseHandler=function(req){var ok=req.data.ok;if(!ok){Progress.done('Error');container.removeClass('loading');Console.log(req.data.error);}else{container.removeClass('loading','admin','member');if(value){container.addClass('admin');}else{container.addClass('member');}
Progress.done('Done',true);}};req.send({user:user});}});});